/**Released Version v3.1.0,BUILD 1329,Time 1666271059423. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.fengmap=i():t.fengmap=i()}(this,function(){return e={},r.m=n=[function(t,i,n){"use strict";n.r(i);var l={LEFT_TOP:1,LEFT_BOTTOM:2,RIGHT_TOP:3,RIGHT_BOTTOM:4};function r(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),t=t||{},this.u=null,this.v=t,this.M=null,this.k=null}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.R()}},{key:"remove",value:function(){this.v.contain.removeChild(this.k)}},{key:"on",value:function(t,i){this.k.onclick=function(){i&&i()},this.k.addEventListener("touchend",function(){i&&i()},!1)}},{key:"checkPosition",value:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto";break;case l.RIGHT_TOP:n.style.right=-(i=i||{x:-10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.left="auto";break;case l.LEFT_BOTTOM:n.style.left=(i=i||{x:10,y:-10}).x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.right="auto";break;case l.RIGHT_BOTTOM:n.style.right=-(i=i||{x:-10,y:-10}).x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.left="auto";break;default:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto"}}}])&&r(t.prototype,n),e&&r(t,e),i}();Object.assign(e.prototype,{R:function(){var t=this,i=document.createElement("div");i.classList.add("fm-compass-container"),void 0!==this.v.backgroundImageSize&&(i.style.width=this.v.backgroundImageSize+"px",i.style.height=this.v.backgroundImageSize+"px"),void 0!==this.v.backgroundImageURL&&(i.style.backgroundImage="url('"+this.v.backgroundImageURL+"')"),void 0===this.v.position&&void 0===this.v.offset||this.checkPosition(this.v.position,this.v.offset,i),this.v.contain?this.v.contain.appendChild(i):(this.v.contain=this.u.getContainer(),this.u.getContainer().appendChild(i));var n=-this.u.getRotation();this.M=document.createElement("div"),this.M.classList.add("fm-compass-element"),this.M.style.transform="rotate("+n+"deg)",this.M.style.msTransform="rotate("+n+"deg)",this.M.style.mozTransform="rotate("+n+"deg)",this.M.style.webkitTransform="rotate("+n+"deg)",this.M.style.oTransform="rotate("+n+"deg)",void 0!==this.v.pointerImageURL&&(this.M.style.backgroundImage="url('"+this.v.pointerImageURL+"')"),void 0!==this.v.pointerImageSize&&(this.M.style.width=this.v.pointerImageSize+"px",this.M.style.height=this.v.pointerImageSize+"px"),i.appendChild(this.M),this.k=i,this.u.on("update",function(){t.O()})},O:function(){var t=-this.u.getRotation();this.M.style.transform="rotate("+t+"deg)",this.M.style.msTransform="rotate("+t+"deg)",this.M.style.mozTransform="rotate("+t+"deg)",this.M.style.webkitTransform="rotate("+t+"deg)",this.M.style.oTransform="rotate("+t+"deg)"}});var s=e;function o(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var c=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}var i,n,e;return i=t,e=[{key:"toColor",value:function(t){if("number"==typeof t)return t;var i=t.split(",");return 3<=i.length?parseInt(i[0])<<16|parseInt(i[1])<<8|parseInt(i[2]):(console.error("color format error",t),0)}},{key:"bindEvent",value:function(t,r,i,s){t.addEventListener(i,function(t){var i=t||window.event,n=i.target||i.srcElement,e=i.currentTarget;for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var i=(this.document||this.ownerDocument).querySelectorAll(t),n=i.length;0<=--n&&i.item(n)!==this;);return-1<n});n!==e;)n.matches(r)&&s.call(n,i),n=n.parentNode})}},{key:"scrollTopAnFun",value:function(){var f,e=!1;return function i(n){var r=n.el,s=n.to,t=n.form,o=(n.time,s<t?"up":"bottom"),u=10,h=(t<s?s-t:s==t?0:t-s)/u,a=0;function c(){if(--f<=0)return f=e=!1,void(r.scrollTop=0==t?0:t);window.setTimeout(function(){var t,i,n,e;!1!==f&&(i=(t={val:u,nbak:h,n:f,elTop:s,VDIRECTIONE:o}).val,n=t.nbak,e=t.n,t=t.elTop,(a="up"==o?t+(n-e)*i:t-(n-e)*i)&&(r.scrollTop=a),c())},u)}!function(){if(e)return f=0,window.setTimeout(function(){var t=Object(n,{to:r.scrollTop});e=!1,i(t)},u+1);e=!0,f=h,c()}()}}},{key:"sleep",value:function(t){for(var i=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-i>t);n++);}},{key:"getClikEventName",value:function(){return window.PointerEvent?"pointerdown":"click"}}],(n=null)&&o(i.prototype,n),e&&o(i,e),t}(),u={FMMap_CONTROL_SMALL:"small",FMMap_CONTROL_NORMAL:"normal"};var h=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=u.FMMap_CONTROL_NORMAL,this.position=l.LEFT_TOP,this.offset={x:10,y:10},this.imgURL="resource/style/wedgets/img/",this.floorButtonCount=5,this.needAllLayerBtn=!0,Object.assign(this,i)};function a(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var f=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),t=t||{},this.u=null,this.S=new h(t),this.S.position||(this.S.position=l.LEFT_TOP),this.T=t.contain,this.S.offset||(this.S.offset={x:10,y:10}),this.A=null,this.j=t.imgURL||"resource/style/wedgets/img/"}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.T||(this.T=this.u.getContainer()),this.init()}},{key:"remove",value:function(){this.T.removeChild(this.A)}},{key:"init",value:function(){var t=this.createPanel();this.A=t;var i=this;this.checkPosition(this.S.position,this.S.offset,t),c.bindEvent(t,"img","mouseover",function(t){this.src=this.dataset.on}),c.bindEvent(t,"img","mouseout",function(t){this.src=this.dataset.leave}),c.bindEvent(t,"div","click",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()}),c.bindEvent(t,"div","touchend",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()})}},{key:"showZoom",value:function(t){this.A.style.display=t?"block":"none"}},{key:"createPanel",value:function(){var t=document.createElement("div");t.setAttribute("class","fm-control-zoom"),t.style.zIndex=20,t.style.position="absolute",t.style.backgroundColor="white",t.style.boxShadow="2px 2px 3px rgba(0,0,0, 0.3)",t.style.borderRadius="2px",t.style.left=0,t.style.top=0,this.T.appendChild(t);return t.innerHTML=this.createInnerHtml("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACVBMVEUAAABmZmYAAABV8S+1AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAATSURBVAjXY2DAC0JDQwMgBF4AAFvvAp8tw46tAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAIElEQVQokWNgGAXUB4zGsrL/ydHIwsDAcI/KjhkFZAMA5XkCUOIdNxMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACVBMVEUAAABmZmYAAABV8S+1AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAXSURBVAjXY2BgZQACXERoaGgAhMCrDgBkQQLbnsbDyQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAOElEQVQokWM0lpVlwAE+QGkBbJJMuHQRAiNBIwsDA8M7HHJ8UBqrPEU2CuGQg8UjVvkhFKr01wgAH8cEixbYBa8AAAAASUVORK5CYII="),t}},{key:"createInnerHtml",value:function(t,i,n,e){return'\n\n            <div data-type="in" style="padding: 14px; cursor: pointer;">\n            <img src='.concat(n," data-leave=").concat(n," data-on=").concat(e,' style="width: 14px; height: 14px;"/>\n             </div>\n            <hr style="height: 1px; border-top: 1px solid rgba(153, 153, 153, 0.45); border-right: none; border-bottom: none; border-left: none; border-image: initial; width: 60%; margin: 0px 20%;">\n            <div data-type="out" style="padding: 14px; cursor: pointer;">\n            <img src=').concat(t," data-leave=").concat(t," data-on=").concat(i,' style="width: 14px; height: 14px;"/>\n            </div>\n        ')}},{key:"checkPosition",value:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=i.x+"px",n.style.top=i.y+"px";break;case l.RIGHT_TOP:n.style.right=-i.x+"px",n.style.top=i.y+"px";break;case l.LEFT_BOTTOM:n.style.left=i.x+"px",n.style.bottom=-i.y+"px";break;case l.RIGHT_BOTTOM:n.style.right=-i.x+"px",n.style.bottom=-i.y+"px"}}}])&&a(t.prototype,n),e&&a(t,e),i}(),v={MODE_3D:2,MODE_2D:4};Object.freeze(v);var y=v;function d(t,i){var n=document.createElement("div"),i='<div class="fm-scroll" id="scroll_'.concat(t+i,'"></div>');return n.innerHTML=i.trim(),n.firstChild}function p(t,i){t&&i?t.appendChild(i):console.error(t,i)}for(var b=[],m=0;m<256;m++)b[m]=(m<16?"0":"")+m.toString(16);var w,g={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(b[255&t]+b[t>>8&255]+b[t>>16&255]+b[t>>24&255]+"-"+b[255&i]+b[i>>8&255]+"-"+b[i>>16&15|64]+b[i>>24&255]+"-"+b[63&n|128]+b[n>>8&255]+"-"+b[n>>16&255]+b[n>>24&255]+b[255&e]+b[e>>8&255]+b[e>>16&255]+b[e>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,e,r){return e+(t-i)*(r-e)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*g.DEG2RAD},radToDeg:function(t){return t*g.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,e,r){var s=Math.cos,o=Math.sin,u=s(n/2),h=o(n/2),a=s((i+e)/2),c=o((i+e)/2),f=s((i-e)/2),n=o((i-e)/2),s=s((e-i)/2),i=o((e-i)/2);"XYX"===r?t.set(u*c,h*f,h*n,u*a):"YZY"===r?t.set(h*n,u*c,h*f,u*a):"ZXZ"===r?t.set(h*f,h*n,u*c,u*a):"XZX"===r?t.set(u*c,h*i,h*s,u*a):"YXY"===r?t.set(h*s,u*c,h*i,u*a):"ZYZ"===r?t.set(h*i,h*s,u*c,u*a):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function M(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var k=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.T=(t=t||{}).contain,this.C=new h(t),this.I=this.C.floorButtonCount,this.u=null,this.L=!1,this.P=!0,this._=10,this.B=null,this.F=null,this.N=[],this.D=null,this.V=null,this.Z=null,this.uuid=null,this.U=null,this.scrollTopAn_=new c.scrollTopAnFun,this.viewModeControl=void 0===t.viewModeControl||t.viewModeControl,this.floorModeControl=void 0===t.floorModeControl||t.floorModeControl,this.timer=null,this.G=t.buildingID,this.Y=void 0===t.showMap||t.showMap,this.hasDOM=!1,this.enable=!0}var t,n,e;return t=i,(n=[{key:"applicationBuilding",value:function(){this.D=this.u.getBuilding(this.G),0!==this.D.getFloorInfos().length&&(this.U=this.D.level,this.T||(this.T=this.u.getContainer()),this.createDOM(),1<this.D.visibleLevels.length?this.setLayerStatus(!0):this.setLayerStatus(!1))}},{key:"buildingIsInZoomRange",value:function(t){var i=this.u.getZoom(),n=t.zoomRange,t=!0;return t=n&&(i<n.minLevel||i>n.maxLevel)?!1:t}},{key:"findBuilding",value:function(){var t=!1,i=this.u.getState(),n=!1,e=!1,r=this.u.focusBuilding;return r?r.buildingID===i.viewBuildingID?(t=!0,this.G!==r.buildingID&&(e=!0),this.G=r.buildingID,n=!0):(i=this.buildingIsInZoomRange(r),r.overviewMode!==fengmap.FMOverviewMode.OUTDOOR&&i&&(t=!0,this.G!==r.buildingID&&(e=!0),this.G=r.buildingID,n=!0)):!0===this.Y&&(t=!0,r=this.u.getMapOptions().buildingID,this.G!==r&&(e=!0),this.G=r,n=!0),!1===t&&(null!==this.G&&(e=!0),this.G=null),{isShowToolbar:n,isBuildingChange:e}}},{key:"addTo",value:function(t){((this.u=t).toolBar=this).initEvent(),this.findBuilding().isShowToolbar&&this.applicationBuilding()}},{key:"switchBuilding",value:function(){this.removeDOM(),this.G=null,this.D=null,this.findBuilding().isShowToolbar&&this.applicationBuilding()}},{key:"remove",value:function(){this.removeEvent(),this.removeDOM(),delete this.u.toolBar}},{key:"removeDOM",value:function(){this.F&&this.T.removeChild(this.F),this.F=null,this.hasDOM=!1}},{key:"removeEvent",value:function(){this.u.off("levelChanged",this.gidchange),this.u.off("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.off("buildingEntered",this.handleBuildingEntered),this.u.off("buildingExited",this.handleBuildingExited),this.u.off("buildingOverviewModeChanged",this.handleBuildingOverviewModeChanged),this.u.off("ViewBuildingChange",this.handleViewBuildingChange),this.u.off("zoom",this.handleCheckZoom)}},{key:"initEvent",value:function(){function t(t){var i;n.enable&&n.D&&(t.buildingID&&t.buildingID!==n.D.buildingID||!t.buildingID&&n.D.buildingID!==n.u.getMapOptions().buildingID||(i=n.D.getFloorInfos().map(function(t){return t.level}),t.level<i[0]||t.level>i[i.length-1]||(n.B.scrollTop=n.getCenterScrolltopById(t.level,i.length),n.setGidStyleByEvent(t.level,"levelChanged"))))}var n=this;this.gidchange=t,this.u.on("levelChanged",t),this.H=function(t){return(n.map?n.map.mapView.container_:document).querySelector(t)},this.handleBuildingEntered=this.handleBuildingEntered.bind(this),this.handleBuildingExited=this.handleBuildingExited.bind(this),this.handleBuildingOverviewModeChanged=this.handleBuildingOverviewModeChanged.bind(this),this.handleLayerChangeStyle=this.handleLayerChangeStyle.bind(this),this.handleViewBuildingChange=this.handleViewBuildingChange.bind(this),this.handleCheckZoom=this.handleCheckZoom.bind(this),this.u.on("ViewBuildingChange",this.handleViewBuildingChange),this.u.on("buildingEntered",this.handleBuildingEntered),this.u.on("buildingExited",this.handleBuildingExited),this.u.on("buildingOverviewModeChanged",this.handleBuildingOverviewModeChanged),this.u.on("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.on("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.on("zoom",this.handleCheckZoom)}},{key:"handleCheckZoom",value:function(){this.findBuilding().isBuildingChange&&this.switchBuilding()}},{key:"createDOM",value:function(){this.hasDOM=!0,this.uuid=g.generateUUID();var t=((f=document.createElement("div")).innerHTML='\n    <div class="fm-control-groups" </div>'.trim(),f.firstChild);this.F=t,function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto";break;case l.RIGHT_TOP:n.style.right=-i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.left="auto";break;case l.LEFT_BOTTOM:n.style.left=i.x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.right="auto";break;case l.RIGHT_BOTTOM:n.style.right=-i.x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.left="auto";break;default:n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto"}}(this.C.position,this.C.offset,t),p(this.T,t);var i=this.D.getFloorInfos().map(function(t){return t.level}),n=i.length,e=this.I,r=!0;this.viewModeControl&&(this.u.getViewMode()===y.MODE_3D?this.P=!1:this.P=!0,this.V=((s=document.createElement("div")).innerHTML='\n    <div class="fm-view fm-view-3d"></div>'.trim(),s.firstChild),this.initViewModePanelEvent(this.V),p(t,this.V),this.setViewModeToStyle(this.V,this.P?"2d":"3d"));var s=((f=document.createElement("div")).innerHTML='\n      <div class="fm-layer">\n        <div class="fm-layer-image-many"> </div>\n      </div>'.trim(),f.firstChild);if(this.C.needAllLayerBtn&&p(t,s),this.X=s,this.eventSwitchBtn(s),this.handleLayerChangeStyle=this.handleLayerChangeStyle.bind(this),this.floorModeControl){n<=this.I&&(e=n,r=!1);this.q;this.L&&this.Q;s=((f=document.createElement("div")).innerHTML='<div class = "fm-floor-list-group" > </div'.trim(),f.firstChild);p(t,s),r&&s.appendChild(d("up",this.uuid));var o=((n=document.createElement("div")).innerHTML='<div class = "fm-floor-list" > </div'.trim(),n.firstChild);p(s,o),this.B=o,this.N=this.D.getFloorInfos();for(var u,h,a,c=this.N.length-1;-1<c;c--)o.appendChild((u=this.N[c],h=this.uuid,a=void 0,a=document.createElement("div"),u='\n    <label\n      class="fm-floor-name fm-floor-name-normal"\n      data-gid='.concat(u.level,'\n      id="gid_').concat(u.level+h,'"\n      <span>').concat(u.alias&&u.alias.toUpperCase()||u.name.toUpperCase(),"</span>\n    </label>"),a.innerHTML=u.trim(),a.firstChild)),0<c&&o.appendChild((a=void 0,(a=document.createElement("div")).innerHTML='\n  <hr class="fm-floor-line" />'.trim(),a.firstChild));var f=document.querySelector(".fm-floor-line"),n=0;f&&(n=f.getBoundingClientRect().height),this.W=document.querySelector(".fm-floor-name").clientHeight+n,document.querySelector(".fm-floor-list").style.height=this.W*e+"px",r&&s.appendChild(d("down",this.uuid)),o.scrollTop=this.getCenterScrolltopById(this.U,i.length);s=document.getElementById("gid_"+this.U+this.uuid);s.classList.remove("fm-floor-name-normal"),s.classList.add("fm-floor-name-active"),this.eventBtnPanelInit(o),this.eventPanelInit(t,o,i)}}},{key:"handleLayerChange",value:function(){var t;this.hasDOM&&(t=!this.L,this.changeLevelsSelect(t))}},{key:"handleLayerChangeStyle",value:function(t){this.hasDOM&&this.D&&t.buildingID===this.D.buildingID&&(1<this.D.visibleLevels.length?this.setLayerStatus(!0):this.setLayerStatus(!1))}},{key:"eventSwitchBtn",value:function(t){var i;this.hasDOM&&(i=c.getClikEventName(),this.handleLayerChange=this.handleLayerChange.bind(this),t.addEventListener(i,this.handleLayerChange))}},{key:"setViewModeToStyle",value:function(t,i){this.hasDOM&&("2d"==i?(t.classList.remove("fm-view-3d"),t.classList.add("fm-view-2d")):(t.classList.remove("fm-view-2d"),t.classList.add("fm-view-3d")))}},{key:"initViewModePanelEvent",value:function(t){var i=this,n=c.getClikEventName(),e=!0;t.addEventListener(n,function(){!1!==e&&(e=!1,i.u.getViewMode()===y.MODE_3D?(i.u.setViewMode({mode:y.MODE_2D,finish:function(){e=!0}}),i.setViewModeToStyle(this,"2d")):(i.u.setViewMode({mode:y.MODE_3D,finish:function(){e=!0}}),i.setViewModeToStyle(this,"3d")))})}},{key:"eventBtnPanelInit",value:function(n){var e=this,r=this;r.changeScrollBtnPic(),c.bindEvent(n,"label","click",function(){var t;r.enable&&r.U!==parseInt(this.dataset.gid)&&(r.foucusId=parseInt(this.dataset.gid),t=r.D.getFloorInfos().map(function(t){return t.level}),this.dataset.gid<t[0]||this.dataset.gid>t[t.length-1]||(n.scrollTop=r.getCenterScrolltopById(parseInt(this.dataset.gid),t.length),r.setGidStyleByClick(this.dataset.gid,"click")))});function t(t){r.changeScrollBtnPic();var i=0;t.wheelDelta?i+=-t.wheelDelta:t.detail&&(i+=t.detail),e.scrollTopAn_({el:n,to:n.scrollTop,form:n.scrollTop+i}),t.stopPropagation()}n.addEventListener("mousewheel",t,{passive:!0}),n.addEventListener("MozMousePixelScroll",t,!1),n.addEventListener("touchstart",this.touchstart.bind(this),!1),n.addEventListener("touchmove",this.touchmove.bind(this),!1),n.addEventListener("touchend",this.touchend.bind(this),!0)}},{key:"touchstart",value:function(t){t.preventDefault(),this.touchStartPointY=t.touches[0].pageY,this.touchPointX=t.touches[0].pageX,this.touchPointY=t.touches[0].pageY,t.stopPropagation()}},{key:"touchmove",value:function(t){t.preventDefault(),this.touchEndPointX=t.touches[0].pageX,this.touchEndPointY=t.touches[0].pageY,this.handleTouchEnd(t),t.stopPropagation()}},{key:"handleTouchEnd",value:function(t){var i,n=this,e=0;0<(t=t||window.event).changedTouches.length&&(n.touchEndPointX=t.changedTouches[0].pageX,n.touchEndPointY=t.changedTouches[0].pageY),(i=t.target)instanceof HTMLSpanElement==!0&&i.parentElement,0!=(e=-(n.touchEndPointY-n.touchPointY))&&(n.touchPointX=n.touchEndPointX,n.touchPointY=n.touchEndPointY,n=n.H(".fm-floor-list"),this.scrollTopAn_({el:n,to:n.scrollTop,form:n.scrollTop+e}))}},{key:"touchend",value:function(t){var i=this,n=null;0<(t=t||window.event).changedTouches.length&&(i.touchEndPointX=t.changedTouches[0].pageX,i.touchEndPointY=t.changedTouches[0].pageY),(n=t.target)instanceof HTMLSpanElement==!0&&(n=n.parentElement);var e=Math.abs(i.touchEndPointY-i.touchStartPointY);e<5&&0<=e&&n&&(n=parseInt(n.dataset.gid),isNaN(n)||(i.foucusId=n,i.setGidStyleByClick(n,"click"))),t.stopPropagation()}},{key:"eventPanelInit",value:function(t,u,h){var a=this;t.onselectstart=function(){return!1},t.style.MozUserSelect="none",c.bindEvent(t,".fm-scroll","click",function(t){var i=this.W,n=h.length-Math.floor(u.scrollTop/i)-(a.I-1),e=u.scrollTop%i,r=n+a.I-1+(0<e?1:0),s=0;if(this.id==="scroll_up"+a.uuid){var o=a.U+1,o=Math.min(h[h.length-1],o);if(a.foucusId==o)return;a.foucusId=o,a.setGidStyleByClick(o,"click"),o<n?s-=0<e?i-e:0:o<=1+r&&o===1+r&&(s-=i+(0<e?i-e:0))}else{o=a.U-1,o=Math.max(h[0],o);if(a.foucusId==o)return;a.foucusId=o,a.setGidStyleByClick(o,"click"),r<o?s+=0<e?e:0:n-1<=o&&o===n-1&&(s+=i+(0<e?e:0))}0!=s&&a.scrollTopAn_({el:u,to:u.scrollTop,form:u.scrollTop+s})}),c.bindEvent(t,".fm-scroll","touchend",function(t){var i=this.W,n=h.length-Math.floor(u.scrollTop/i)-(a.I-1),e=u.scrollTop%i,r=n+a.I-1+(0<e?1:0),s=0;if(this.id==="scroll_up"+a.uuid){var o=a.U+1,o=Math.min(h[h.length-1],o);if(a.foucusId==o)return;a.foucusId=o,a.setGidStyleByClick(o,"click"),o<n?s-=0<e?i-e:0:o<=1+r&&o===1+r&&(s-=i+(0<e?i-e:0))}else{o=a.U-1,o=Math.max(h[0],o);if(a.foucusId==o)return;a.foucusId=o,a.setGidStyleByClick(o,"click"),r<o?s+=0<e?e:0:n-1<=o&&o===n-1&&(s+=i+(0<e?e:0))}0!=s&&a.scrollTopAn_({el:u,to:u.scrollTop,form:u.scrollTop+s})})}},{key:"getCenterScrolltopById",value:function(t,i){return(i-t-Math.floor(this.I/2))*this.W}},{key:"changeScrollBtnPic",value:function(){var t=this.U,i=this.D.getFloorInfos().map(function(t){return t.level});i.sort(function(t,i){return t-i});var n=document.getElementById("scroll_down"+this.uuid),e=document.getElementById("scroll_up"+this.uuid);t==i[0]&&n?(n.classList.remove("fm-scroll-down"),n.classList.add("fm-scroll-down-grey")):n&&(n.classList.remove("fm-scroll-down-grey"),n.classList.add("fm-scroll-down")),t==i[i.length-1]&&e?(e.classList.remove("fm-scroll-up"),e.classList.add("fm-scroll-up-grey")):e&&(e.classList.remove("fm-scroll-up-grey"),e.classList.add("fm-scroll-up"))}},{key:"changeFocusLevel",value:function(t){this.foucusId=t}},{key:"changeLevelsSelect",value:function(t){this.allLayer=t,this.setLayerStatus(t)}},{key:"setLayerStatus",value:function(t){this.L=t,this.L?(this.X.firstElementChild.classList.remove("fm-layer-image-one"),this.X.firstElementChild.classList.add("fm-layer-image-many")):(this.X.firstElementChild.classList.remove("fm-layer-image-many"),this.X.firstElementChild.classList.add("fm-layer-image-one"))}},{key:"onChange",value:function(t){w=t}},{key:"foucusId",get:function(){return this.U},set:function(t){var i=this;this.D&&(null!==this.Z&&!1===this.K&&this.Z.finish(),this.K=!1,this.D.setLevel({level:t,finish:function(){i.K=!0},callback:function(t){i.Z=t}}),w&&w([t]))}},{key:"setGidStyleByEvent",value:function(t){this.setGidStyleByClick(t)}},{key:"setGidStyleByClick",value:function(t){var i=document.getElementById("gid_"+this.U+this.uuid);i.classList.remove("fm-floor-name-active"),i.classList.add("fm-floor-name-normal"),this.U=parseInt(t);t=document.getElementById("gid_"+t+this.uuid);t.classList.remove("fm-floor-name-normal"),t.classList.add("fm-floor-name-active"),this.changeScrollBtnPic()}},{key:"allLayer",get:function(){return this.L},set:function(t){this.D&&((this.L=t)?this.D.setVisibleLevels(this.D.getFloorInfos().map(function(t){return t.level})):this.D.setVisibleLevels([this.D.level]))}},{key:"handleBuildingEntered",value:function(t){var i=this;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.switchBuilding()},200)}},{key:"handleBuildingExited",value:function(){var t=this;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){t.switchBuilding()},200)}},{key:"handleBuildingOverviewModeChanged",value:function(){this.switchBuilding()}},{key:"handleViewBuildingChange",value:function(){this.switchBuilding()}}])&&M(t.prototype,n),e&&M(t,e),i}(),R={MODULE_SHORTEST:1,MODULE_BEST:2},E={PRIORITY_DEFAULT:1,PRIORITY_LIFTFIRST:2,PRIORITY_ESCALATORFIRST:3,PRIORITY_STAIRFIRST:4,PRIORITY_LIFTONLY:5,PRIORITY_ESCALATORONLY:6,PRIORITY_STAIRONLY:7,PRIORITY_ACCESSIBLEONLY:8,PRIORITY_LIFTFIRST1:9,PRIORITY_ESCALATORFIRST1:10,PRIORITY_STAIRFIRST1:11},O={ZH:"zh",EN:"en"};var S=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)};Object.assign(S.prototype,{J:function(t,i){void 0===this.$&&(this.$={});var n=this.$;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},tt:function(t,i){if(void 0===this.$)return!1;var n=this.$;return void 0!==n[t]&&-1!==n[t].indexOf(i)},it:function(t,i){void 0!==this.$&&(void 0===(t=this.$[t])||-1!==(i=t.indexOf(i))&&t.splice(i,1))},nt:function(t){if(void 0!==this.$){var i=this.$[t.type];if(void 0!==i)for(var n=i.slice(0),e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});var T=S;function A(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var j=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var t,n,e;return t=i,(n=[{key:"start",value:function(){this.startTime=x(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t,i=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(i=((t=x())-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=i),i)}}])&&A(t.prototype,n),e&&A(t,e),i}();function x(){return("undefined"==typeof performance?Date:performance).now()}for(var C=[],I=0;I<256;I++)C[I]=(I<16?"0":"")+I.toString(16);var L=1234567,P={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(C[255&t]+C[t>>8&255]+C[t>>16&255]+C[t>>24&255]+"-"+C[255&i]+C[i>>8&255]+"-"+C[i>>16&15|64]+C[i>>24&255]+"-"+C[63&n|128]+C[n>>8&255]+"-"+C[n>>16&255]+C[n>>24&255]+C[255&e]+C[e>>8&255]+C[e>>16&255]+C[e>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,e,r){return e+(t-i)*(r-e)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return((L=16807*(L=void 0!==t?t%2147483647:L)%2147483647)-1)/2147483646},degToRad:function(t){return t*P.DEG2RAD},radToDeg:function(t){return t*P.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,e,r){var s=Math.cos,o=Math.sin,u=s(n/2),h=o(n/2),a=s((i+e)/2),c=o((i+e)/2),f=s((i-e)/2),l=o((i-e)/2),v=s((e-i)/2),y=o((e-i)/2);switch(r){case"XYX":t.set(u*c,h*f,h*l,u*a);break;case"YZY":t.set(h*l,u*c,h*f,u*a);break;case"ZXZ":t.set(h*f,h*l,u*c,u*a);break;case"XZX":t.set(u*c,h*y,h*v,u*a);break;case"YXY":t.set(h*v,u*c,h*y,u*a);break;case"ZYZ":t.set(h*y,h*v,u*c,u*a);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function _(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var B=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),Object.defineProperty(this,"isQuaternion",{value:!0}),this.et=t,this.rt=i,this.st=n,this.ot=e}var t,i,n;return t=r,n=[{key:"slerp",value:function(t,i,n,e){return n.copy(t).slerp(i,e)}},{key:"slerpFlat",value:function(t,i,n,e,r,s,o){var u=n[e+0],h=n[e+1],a=n[e+2],c=n[e+3],f=r[s+0],l=r[s+1],v=r[s+2],y=r[s+3];c===y&&u===f&&h===l&&a===v||(n=1-o,r=0<=(e=u*f+h*l+a*v+c*y)?1:-1,(s=1-e*e)>Number.EPSILON&&(s=Math.sqrt(s),e=Math.atan2(s,e*r),n=Math.sin(n*e)/s,o=Math.sin(o*e)/s),u=u*n+f*(r=o*r),h=h*n+l*r,a=a*n+v*r,c=c*n+y*r,n===1-o&&(u*=o=1/Math.sqrt(u*u+h*h+a*a+c*c),h*=o,a*=o,c*=o)),t[i]=u,t[i+1]=h,t[i+2]=a,t[i+3]=c}},{key:"multiplyQuaternionsFlat",value:function(t,i,n,e,r,s){var o=n[e],u=n[e+1],h=n[e+2],a=n[e+3],c=r[s],n=r[s+1],e=r[s+2],s=r[s+3];return t[i]=o*s+a*c+u*e-h*n,t[i+1]=u*s+a*n+h*c-o*e,t[i+2]=h*s+a*e+o*n-u*c,t[i+3]=a*s-o*c-u*n-h*e,t}}],(i=[{key:"x",get:function(){return this.et},set:function(t){this.et=t,this.ut()}},{key:"y",get:function(){return this.rt},set:function(t){this.rt=t,this.ut()}},{key:"z",get:function(){return this.st},set:function(t){this.st=t,this.ut()}},{key:"w",get:function(){return this.ot},set:function(t){this.ot=t,this.ut()}},{key:"set",value:function(t,i,n,e){return this.et=t,this.rt=i,this.st=n,this.ot=e,this.ut(),this}},{key:"clone",value:function(){return new this.constructor(this.et,this.rt,this.st,this.ot)}},{key:"copy",value:function(t){return this.et=t.x,this.rt=t.y,this.st=t.z,this.ot=t.w,this.ut(),this}},{key:"setFromEuler",value:function(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t.et,e=t.rt,r=t.st,s=t.ht,o=Math.cos,t=Math.sin,u=o(n/2),h=o(e/2),a=o(r/2),c=t(n/2),f=t(e/2),l=t(r/2);switch(s){case"XYZ":this.et=c*h*a+u*f*l,this.rt=u*f*a-c*h*l,this.st=u*h*l+c*f*a,this.ot=u*h*a-c*f*l;break;case"YXZ":this.et=c*h*a+u*f*l,this.rt=u*f*a-c*h*l,this.st=u*h*l-c*f*a,this.ot=u*h*a+c*f*l;break;case"ZXY":this.et=c*h*a-u*f*l,this.rt=u*f*a+c*h*l,this.st=u*h*l+c*f*a,this.ot=u*h*a-c*f*l;break;case"ZYX":this.et=c*h*a-u*f*l,this.rt=u*f*a+c*h*l,this.st=u*h*l-c*f*a,this.ot=u*h*a+c*f*l;break;case"YZX":this.et=c*h*a+u*f*l,this.rt=u*f*a+c*h*l,this.st=u*h*l-c*f*a,this.ot=u*h*a-c*f*l;break;case"XZY":this.et=c*h*a-u*f*l,this.rt=u*f*a-c*h*l,this.st=u*h*l+c*f*a,this.ot=u*h*a+c*f*l;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==i&&this.ut(),this}},{key:"setFromAxisAngle",value:function(t,i){var n=i/2,i=Math.sin(n);return this.et=t.x*i,this.rt=t.y*i,this.st=t.z*i,this.ot=Math.cos(n),this.ut(),this}},{key:"setFromRotationMatrix",value:function(t){var i,n=t.elements,e=n[0],r=n[4],s=n[8],o=n[1],u=n[5],h=n[9],a=n[2],c=n[6],t=n[10],n=e+u+t;return 0<n?(n=.5/Math.sqrt(n+1),this.ot=.25/n,this.et=(c-h)*n,this.rt=(s-a)*n,this.st=(o-r)*n):u<e&&t<e?(i=2*Math.sqrt(1+e-u-t),this.ot=(c-h)/i,this.et=.25*i,this.rt=(r+o)/i,this.st=(s+a)/i):t<u?(i=2*Math.sqrt(1+u-e-t),this.ot=(s-a)/i,this.et=(r+o)/i,this.rt=.25*i,this.st=(h+c)/i):(u=2*Math.sqrt(1+t-e-u),this.ot=(o-r)/u,this.et=(s+a)/u,this.rt=(h+c)/u,this.st=.25*u),this.ut(),this}},{key:"setFromUnitVectors",value:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.et=-t.y,this.rt=t.x,this.st=0):(this.et=0,this.rt=-t.z,this.st=t.y)):(this.et=t.y*i.z-t.z*i.y,this.rt=t.z*i.x-t.x*i.z,this.st=t.x*i.y-t.y*i.x),this.ot=n,this.normalize()}},{key:"angleTo",value:function(t){return 2*Math.acos(Math.abs(P.clamp(this.dot(t),-1,1)))}},{key:"rotateTowards",value:function(t,i){var n=this.angleTo(t);if(0===n)return this;n=Math.min(1,i/n);return this.slerp(t,n),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.et*=-1,this.rt*=-1,this.st*=-1,this.ut(),this}},{key:"dot",value:function(t){return this.et*t.et+this.rt*t.rt+this.st*t.st+this.ot*t.ot}},{key:"lengthSq",value:function(){return this.et*this.et+this.rt*this.rt+this.st*this.st+this.ot*this.ot}},{key:"length",value:function(){return Math.sqrt(this.et*this.et+this.rt*this.rt+this.st*this.st+this.ot*this.ot)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this.et=0,this.rt=0,this.st=0,this.ot=1):(this.et=this.et*(t=1/t),this.rt=this.rt*t,this.st=this.st*t,this.ot=this.ot*t),this.ut(),this}},{key:"multiply",value:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,i){var n=t.et,e=t.rt,r=t.st,s=t.ot,o=i.et,u=i.rt,t=i.st,i=i.ot;return this.et=n*i+s*o+e*t-r*u,this.rt=e*i+s*u+r*o-n*t,this.st=r*i+s*t+n*u-e*o,this.ot=s*i-n*o-e*u-r*t,this.ut(),this}},{key:"slerp",value:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var n=this.et,e=this.rt,r=this.st,s=this.ot,o=s*t.ot+n*t.et+e*t.rt+r*t.st;if(o<0?(this.ot=-t.ot,this.et=-t.et,this.rt=-t.rt,this.st=-t.st,o=-o):this.copy(t),1<=o)return this.ot=s,this.et=n,this.rt=e,this.st=r,this;t=1-o*o;if(t<=Number.EPSILON){var u=1-i;return this.ot=u*s+i*this.ot,this.et=u*n+i*this.et,this.rt=u*e+i*this.rt,this.st=u*r+i*this.st,this.normalize(),this.ut(),this}u=Math.sqrt(t),t=Math.atan2(u,o),o=Math.sin((1-i)*t)/u,u=Math.sin(i*t)/u;return this.ot=s*o+this.ot*u,this.et=n*o+this.et*u,this.rt=e*o+this.rt*u,this.st=r*o+this.st*u,this.ut(),this}},{key:"equals",value:function(t){return t.et===this.et&&t.rt===this.rt&&t.st===this.st&&t.ot===this.ot}},{key:"fromArray",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.et=t[i],this.rt=t[i+1],this.st=t[i+2],this.ot=t[i+3],this.ut(),this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.et,t[i+1]=this.rt,t[i+2]=this.st,t[i+3]=this.ot,t}},{key:"fromBufferAttribute",value:function(t,i){return this.et=t.getX(i),this.rt=t.getY(i),this.st=t.getZ(i),this.ot=t.getW(i),this}},{key:"_onChange",value:function(t){return this.ut=t,this}},{key:"_onChangeCallback",value:function(){}}])&&_(t.prototype,i),n&&_(t,n),r}();function F(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var N=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=i,this.z=n}var t,i,n;return t=e,(i=[{key:"set",value:function(t,i,n){return void 0===n&&(n=this.z),this.x=t,this.y=i,this.z=n,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"sub",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"applyEuler",value:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(V.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,i){return this.applyQuaternion(V.setFromAxisAngle(t,i))}},{key:"applyMatrix3",value:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*e,this.y=t[1]*i+t[4]*n+t[7]*e,this.z=t[2]*i+t[5]*n+t[8]*e,this}},{key:"applyNormalMatrix",value:function(t){return this.applyMatrix3(t).normalize()}},{key:"applyMatrix4",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements,t=1/(r[3]*i+r[7]*n+r[11]*e+r[15]);return this.x=(r[0]*i+r[4]*n+r[8]*e+r[12])*t,this.y=(r[1]*i+r[5]*n+r[9]*e+r[13])*t,this.z=(r[2]*i+r[6]*n+r[10]*e+r[14])*t,this}},{key:"applyQuaternion",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,o=t.z,u=t.w,h=u*i+s*e-o*n,a=u*n+o*i-r*e,t=u*e+r*n-s*i,e=-r*i-s*n-o*e;return this.x=h*u+e*-r+a*-o-t*-s,this.y=a*u+e*-s+t*-r-h*-o,this.z=t*u+e*-o+h*-s-a*-r,this}},{key:"project",value:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}},{key:"transformDirection",value:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e,this.y=t[1]*i+t[5]*n+t[9]*e,this.z=t[2]*i+t[6]*n+t[10]*e,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"clampScalar",value:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}},{key:"clampLength",value:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}},{key:"lerpVectors",value:function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this}},{key:"cross",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,i){var n=t.x,e=t.y,r=t.z,s=i.x,t=i.y,i=i.z;return this.x=e*i-r*t,this.y=r*s-n*i,this.z=n*t-e*s,this}},{key:"projectOnVector",value:function(t){var i=t.lengthSq();if(0===i)return this.set(0,0,0);i=t.dot(this)/i;return this.copy(t).multiplyScalar(i)}},{key:"projectOnPlane",value:function(t){return D.copy(this).projectOnVector(t),this.sub(D)}},{key:"reflect",value:function(t){return this.sub(D.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;i=this.dot(t)/i;return Math.acos(P.clamp(i,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,i,n){var e=Math.sin(i)*t;return this.x=e*Math.sin(n),this.y=Math.cos(i)*t,this.z=e*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this}},{key:"setFromMatrixPosition",value:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this}},{key:"setFromMatrixColumn",value:function(t,i){return this.fromArray(t.elements,4*i)}},{key:"setFromMatrix3Column",value:function(t,i){return this.fromArray(t.elements,3*i)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}])&&F(t.prototype,i),n&&F(t,n),e}(),D=new N,V=new B;function Z(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var z=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.ct={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.ft={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}var i,n,e;return i=t,(n=[{key:"min",get:function(){return this.ct}},{key:"max",get:function(){return this.ft}},{key:"center",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=(this.min.x+this.max.x)/2,t.y=(this.min.y+this.max.y)/2),t}},{key:"size",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=this.max.x-this.min.x,t.y=this.max.y-this.min.y),t}},{key:"copy",value:function(t){return this.ft.x=t.max.x,this.ft.y=t.max.y,this.ct.x=t.min.x,this.ct.y=t.min.y,this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"reset",value:function(){this.ct={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.ft={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}},{key:"toObject",value:function(){return{min:this.min,max:this.max,center:this.center,size:this.size}}},{key:"expand",value:function(t){this.lt(t)}},{key:"expandByCoords",value:function(t){this.vt(t)}},{key:"valid",value:function(){return this.yt()}},{key:"isCross",value:function(t){var i=!0;return t.max.x<this.min.x&&(i=!1),t.min.x>this.max.x&&(i=!1),t.max.y<this.min.y&&(i=!1),i=t.min.y>this.max.y?!1:i}}])&&Z(i.prototype,n),e&&Z(i,e),t}();Object.assign(z.prototype,{yt:function(){return!(this.min.x>this.max.x||this.min.y>this.max.y)},lt:function(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y&&(this.max.y=t.max.y))},vt:function(t){var i=this;t&&0!=t.length&&t.forEach(function(t){t.x<i.min.x&&(i.min.x=t.x),t.y<i.min.y&&(i.min.y=t.y),t.x>i.max.x&&(i.max.x=t.x),t.y>i.max.y&&(i.max.y=t.y)})}});var U=z,G=function(t,i,n){n=n||2;var e,r,s,o,u,h=i&&i.length,a=h?i[0]*n:t.length,c=Y(t,0,a,n,!0),f=[];if(!c||c.next===c.prev)return f;if(h&&(c=function(t,i,n,e){var r,s,o,u,h=[];for(r=0,s=i.length;r<s;r++)o=i[r]*e,u=r<s-1?i[r+1]*e:t.length,(u=Y(t,o,u,e,!1))===u.next&&(u.steiner=!0),h.push(function(t){var i=t,n=t;for(;(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next,i!==t;);return n}(u));for(h.sort(q),r=0;r<h.length;r++)!function(t,i){(i=function(t,i){var n,e=i,r=t.x,s=t.y,o=-1/0;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var u=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=r&&o<u){if((o=u)===r){if(s===e.y)return e;if(s===e.next.y)return e.next}n=e.x<e.next.x?e:e.next}}}while(e=e.next,e!==i);if(!n)return null;if(r===o)return n;var h,a=n,c=n.x,f=n.y,l=1/0;e=n;for(;r>=e.x&&e.x>=c&&r!==e.x&&W(s<f?r:o,s,c,f,s<f?o:r,s,e.x,e.y)&&(h=Math.abs(s-e.y)/(r-e.x),nt(e,t)&&(h<l||h===l&&(e.x>n.x||e.x===n.x&&function(t,i){return K(t.prev,t,i.prev)<0&&K(i.next,t,t.next)<0}(n,e)))&&(n=e,l=h)),e=e.next,e!==a;);return n}(t,i))&&(t=et(i,t),H(i,i.next),H(t,t.next))}(h[r],n),n=H(n,n.next);return n}(t,i,c,n)),t.length>80*n){for(var l=e=t[0],v=r=t[1],y=n;y<a;y+=n)(s=t[y])<l&&(l=s),(o=t[y+1])<v&&(v=o),e<s&&(e=s),r<o&&(r=o);u=0!==(u=Math.max(e-l,r-v))?1/u:0}return X(c,f,n,l,v,u),f};function Y(t,i,n,e,r){var s,o;if(r===0<function(t,i,n,e){for(var r=0,s=i,o=n-e;s<n;s+=e)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,i,n,e))for(s=i;s<n;s+=e)o=rt(s,t[s],t[s+1],o);else for(s=n-e;i<=s;s-=e)o=rt(s,t[s],t[s+1],o);return o&&J(o,o.next)&&(st(o),o=o.next),o}function H(t,i){if(!t)return t;i=i||t;var n,e=t;do{if(n=!1,e.steiner||!J(e,e.next)&&0!==K(e.prev,e,e.next))e=e.next;else{if(st(e),(e=i=e.prev)===e.next)break;n=!0}}while(n||e!==i);return i}function X(t,i,n,e,r,s,o){if(t){!o&&s&&function(t,i,n,e){var r=t;for(;null===r.z&&(r.z=Q(r.x,r.y,i,n,e)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var i,n,e,r,s,o,u,h,a=1;do{for(n=t,s=t=null,o=0;n;){for(o++,e=n,i=u=0;i<a&&(u++,e=e.nextZ);i++);for(h=a;0<u||0<h&&e;)0!==u&&(0===h||!e||n.z<=e.z)?(n=(r=n).nextZ,u--):(e=(r=e).nextZ,h--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=e}}while(s.nextZ=null,a*=2,1<o)}(r)}(t,e,r,s);for(var u,h,a=t;t.prev!==t.next;)if(u=t.prev,h=t.next,s?function(t,i,n,e){var r=t.prev,s=t,o=t.next;if(0<=K(r,s,o))return!1;var u=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,h=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,a=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,c=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,f=Q(u,h,i,n,e),l=Q(a,c,i,n,e),v=t.prevZ,y=t.nextZ;for(;v&&v.z>=f&&y&&y.z<=l;){if(v!==t.prev&&v!==t.next&&W(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=K(v.prev,v,v.next))return!1;if(v=v.prevZ,y!==t.prev&&y!==t.next&&W(r.x,r.y,s.x,s.y,o.x,o.y,y.x,y.y)&&0<=K(y.prev,y,y.next))return!1;y=y.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&W(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=K(v.prev,v,v.next))return!1;v=v.prevZ}for(;y&&y.z<=l;){if(y!==t.prev&&y!==t.next&&W(r.x,r.y,s.x,s.y,o.x,o.y,y.x,y.y)&&0<=K(y.prev,y,y.next))return!1;y=y.nextZ}return!0}(t,e,r,s):function(t){var i=t.prev,n=t,e=t.next;if(0<=K(i,n,e))return!1;var r=t.next.next;for(;r!==t.prev;){if(W(i.x,i.y,n.x,n.y,e.x,e.y,r.x,r.y)&&0<=K(r.prev,r,r.next))return!1;r=r.next}return!0}(t))i.push(u.i/n),i.push(t.i/n),i.push(h.i/n),st(t),t=h.next,a=h.next;else if((t=h)===a){o?1===o?X(t=function(t,i,n){var e=t;do{var r=e.prev,s=e.next.next}while(!J(r,s)&&$(r,e,e.next,s)&&nt(r,s)&&nt(s,r)&&(i.push(r.i/n),i.push(e.i/n),i.push(s.i/n),st(e),st(e.next),e=t=s),e=e.next,e!==t);return H(e)}(H(t),i,n),i,n,e,r,s,2):2===o&&function(t,i,n,e,r,s){var o=t;do{for(var u=o.next.next;u!==o.prev;){if(o.i!==u.i&&function(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==i.i&&n.next.i!==i.i&&$(n,n.next,t,i))return!0}while(n=n.next,n!==t);return!1}(t,i)&&(nt(t,i)&&nt(i,t)&&function(t,i){var n=t,e=!1,r=(t.x+i.x)/2,s=(t.y+i.y)/2;for(;n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(e=!e),n=n.next,n!==t;);return e}(t,i)&&(K(t.prev,t,i.prev)||K(t,i.prev,i))||J(t,i)&&0<K(t.prev,t,t.next)&&0<K(i.prev,i,i.next))}(o,u)){var h=et(o,u);return o=H(o,o.next),h=H(h,h.next),X(o,i,n,e,r,s),X(h,i,n,e,r,s)}u=u.next}}while(o=o.next,o!==t)}(t,i,n,e,r,s):X(H(t),i,n,e,r,s,1);break}}}function q(t,i){return t.x-i.x}function Q(t,i,n,e,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-e)*r)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function W(t,i,n,e,r,s,o,u){return 0<=(r-o)*(i-u)-(t-o)*(s-u)&&0<=(t-o)*(e-u)-(n-o)*(i-u)&&0<=(n-o)*(s-u)-(r-o)*(e-u)}function K(t,i,n){return(i.y-t.y)*(n.x-i.x)-(i.x-t.x)*(n.y-i.y)}function J(t,i){return t.x===i.x&&t.y===i.y}function $(t,i,n,e){var r=it(K(t,i,n)),s=it(K(t,i,e)),o=it(K(n,e,t)),u=it(K(n,e,i));return r!==s&&o!==u||(0===r&&tt(t,n,i)||(0===s&&tt(t,e,i)||(0===o&&tt(n,t,e)||!(0!==u||!tt(n,i,e)))))}function tt(t,i,n){return i.x<=Math.max(t.x,n.x)&&i.x>=Math.min(t.x,n.x)&&i.y<=Math.max(t.y,n.y)&&i.y>=Math.min(t.y,n.y)}function it(t){return 0<t?1:t<0?-1:0}function nt(t,i){return K(t.prev,t,t.next)<0?0<=K(t,i,t.next)&&0<=K(t,t.prev,i):K(t,i,t.prev)<0||K(t,t.next,i)<0}function et(t,i){var n=new ot(t.i,t.x,t.y),e=new ot(i.i,i.x,i.y),r=t.next,s=i.prev;return(t.next=i).prev=t,(n.next=r).prev=n,(e.next=n).prev=e,(s.next=e).prev=s,e}function rt(t,i,n,e){n=new ot(t,i,n);return e?(n.next=e.next,(n.prev=e).next.prev=n,e.next=n):(n.prev=n).next=n,n}function st(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ot(t,i,n){this.i=t,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ut(t){return function(t){if(Array.isArray(t))return ht(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,i){if(t){if("string"==typeof t)return ht(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}var at={area:function(t){for(var i=t.length,n=0,e=i-1,r=0;r<i;e=r++)n+=t[e].x*t[r].y-t[r].x*t[e].y;return.5*n},isClockWise:function(t){return at.area(t)<0},triangulateShape:function(t,i){var n=[],e=[],r=[];ct(t),ft(n,t);var s=t.length;i.forEach(ct);for(var o=0;o<i.length;o++)e.push(s),s+=i[o].length,ft(n,i[o]);for(var u=G(n,e),h=0;h<u.length;h+=3)r.push(u.slice(h,h+3));return r},triangulate:function(t){(r=[]).push.apply(r,ut(t[0]));for(var i=[],n=1;n<t.length;n++){var e=[];e.push.apply(e,ut(t[n])),i.push(e)}if(!at.isClockWise(r))for(var r=r.reverse(),s=0,o=i.length;s<o;s++){var u=i[s];at.isClockWise(u)&&(i[s]=u.reverse())}return at.triangulateShape(r,i)}};function ct(t){var i,n=t.length;2<n&&(i=t[n-1],n=t[0],i.x===n.x&&i.y===n.y)&&t.pop()}function ft(t,i){for(var n=0;n<i.length;n++)t.push(i[n].x),t.push(i[n].y)}var lt=1e-5,vt=Math.PI/180,yt=180/Math.PI,n=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)};Object.assign(n.prototype,{dt:function(){return lt},pt:function(){return vt},bt:function(){return yt},mt:function(t){return t<lt&&-lt<t},wt:function(t){return lt<t},gt:function(t){return t<-lt},Mt:function(t,i,n){n=(t.x-n.x)*(i.y-n.y)-(i.x-n.x)*(t.y-n.y);return Math.abs(n)<lt?0:n},distanceOfTwoPoints:function(t,i){return t&&i?Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)):Number.NaN},distance:function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},isPolygonContainPoint:function(t,i){for(var n=0,e=0;e<t.length;e++){var r=t[e].x,s=t[e].y,o=0,u=0,u=e<t.length-1?(o=t[e+1].x,t[e+1].y):(o=t[0].x,t[0].y);if(r===i.x&&s===i.y||o===i.x&&u===i.y)return!0;if(u!==s){var h=r+(i.y-s)*(o-r)/(u-s);if(h===i.x)return!0;r!==o?h<=Math.max(r,o)&&h>=Math.min(r,o)&&h>i.x&&h!==r&&(h===o&&0<(s-i.y)*(u-i.y)?n+=2:n++):h<=Math.max(r,o)&&h>=Math.min(r,o)&&h>i.x&&(h===o&&0<(s-i.y)*(u-i.y)?n+=2:n++)}}return 0<n%2},kt:function(t,i,n,e){return!(Math.max(t.x,i.x)<Math.min(n.x,e.x))&&(!(Math.max(t.y,i.y)<Math.min(n.y,e.y))&&(!(Math.max(n.x,e.x)<Math.min(t.x,i.x))&&!(Math.max(n.y,e.y)<Math.min(t.y,i.y))))},Rt:function(t,i,n,e){return!(Math.max(t.x,i.x)<Math.min(n.x,e.x))&&(!(Math.max(t.y,i.y)<Math.min(n.y,e.y))&&(!(Math.max(n.x,e.x)<Math.min(t.x,i.x))&&(!(Math.max(n.y,e.y)<Math.min(t.y,i.y))&&((0!==this.Mt(n,i,t)||0!==this.Mt(i,e,t))&&(!(this.Mt(n,i,t)*this.Mt(i,e,t)<0)&&!(this.Mt(t,e,n)*this.Mt(e,i,n)<0))))))},Et:function(t,i,n){return!(t.x<i.x)&&(!(t.y<i.y)&&(!(t.x>n.x)&&!(t.y>n.y)))},Ot:function(t,i,n){var e=Math.min(i.x,n.x),r=Math.max(i.x,n.x),s=Math.min(i.y,n.y),n=Math.max(i.y,n.y);return!(t.x<e||t.x>r||t.y<s||t.y>n)},St:function(t,i,n){var e=Math.min(n.x,i.x),r=Math.max(n.x,i.x),s=Math.min(n.y,i.y),i=Math.max(n.y,i.y);return!(t.x<e||t.x>r||t.y<s||t.y>i)},Tt:function(t,i,n){for(var e,r,s=!1,o=0;o<n;o++)e=i[o],r=i[(o+1)%n],(e.y<t.y&&r.y>=t.y||r.y<t.y&&e.y>=t.y)&&(e.x<=t.x||r.x<=t.x)&&e.x+(t.y-e.y)/(r.y-e.y)*(r.x-e.x)<t.x&&(s=!s);return s},At:function(t,i,n){return(t.x-i.x)*(n.y-i.y)==(n.x-i.x)*(t.y-i.y)&&Math.min(i.x,n.x)<=t.x&&t.x<=Math.max(i.x,n.x)&&Math.min(i.y,n.y)<=t.y&&t.y<=Math.max(i.y,n.y)},jt:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))},xt:function(t,i){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)},Ct:function(t,i,n){var e=i.x,r=i.y,s=n.x,o=n.y,u=t.x,h=t.y,a=s-e,c=o-r,f=a*a+c*c,i=u-e,n=h-r,t=i*i+n*n;if(this.mt(f))return l=this.mt(t)?0:t;var l,f=Math.sqrt(f),a=a/f,c=c/f,n=a*i+c*n;return l=this.wt(n)?this.gt(n-f)?(a=u-(e+n*a))*a+(c=h-(r+n*c))*c:(s=u-s)*s+(o=h-o)*o:t,this.mt(l)?0:l},It:function(t,i,n,e){var r=i.x,s=i.y,o=n.x,u=n.y,h=t.x,a=t.y,c=o-r,f=u-s,l=Math.sqrt(c*c+f*f),v=h-r,y=a-s,t=Math.sqrt(v*v+y*y);if(this.mt(l))return e.x=i.x,e.y=i.y,this.mt(d=t)?0:d;var c=c/l,f=f/l,y=c*v+f*y,d=this.wt(y)?this.gt(y-l)?(c=h-(r=r+y*c),f=a-(y=s+y*f),f=Math.sqrt(c*c+f*f),e.x=r,e.y=y,f):(o=h-o,u=a-u,u=Math.sqrt(o*o+u*u),e.x=n.x,e.y=n.y,u):(e.x=i.x,e.y=i.y,t);return this.mt(d)?0:d},Lt:function(t,i){for(var n=0,e=0,r=0,s=0;s<i;s++){var o=t[s],u=t[(s+1)%i],h=(o.x*u.y-o.y*u.x)/2;n+=h,e+=h*(o.x+u.x)/3,r+=h*(o.y+u.y)/3}return{x:e/=n,y:r/=n}},Pt:function(t){for(var i=at.triangulate([t]),n=0,e=0,r=0,s=0;s<i.length;s++){var o=t[i[s][0]],u=t[i[s][1]],h=t[i[s][2]],a=u.x-o.x,c=u.y-o.y,f=h.x-o.x,c=(a*(h.y-o.y)-f*c)/2;n+=c,e+=(o.x+u.x+h.x)/3*c,r+=(o.y+u.y+h.y)/3*c}return{x:e/n,y:r/n}},_t:function(t,i){if(i<3)return 0;for(var n=0,e=0;e<i;++e){var r=t[e],s=t[(e+1)%i];n+=r.x*s.y-r.y*s.x}return Math.abs(n/2)},Bt:function(t,i,n,e,r){if(this.Rt(t,i,n,e)){var s=(e.x-n.x)*(t.y-i.y)-(i.x-t.x)*(n.y-e.y),o=(t.y-n.y)*(i.x-t.x)*(e.x-n.x)+n.x*(e.y-n.y)*(i.x-t.x)-t.x*(i.y-t.y)*(e.x-n.x);return r.x=o/s,s=(t.x-i.x)*(e.y-n.y)-(i.y-t.y)*(n.x-e.x),o=i.y*(t.x-i.x)*(e.y-n.y)+(e.x-i.x)*(e.y-n.y)*(t.y-i.y)-e.y*(n.x-e.x)*(i.y-t.y),r.y=o/s,1}return 0},Ft:function(t,i,n,e,r){var s=Math.min(n.x,e.x),o=Math.max(n.x,e.x),u=Math.min(n.y,e.y),h=Math.max(n.y,e.y),a=t.x,c=t.y,f=n.x,l=n.y,v=e.x,y=e.y;if(90==i){if(t.x<s||t.x>o)return!1;var d=(y-l)/(v-f)*(a-f)+l;return r.y=d,r.x=a,d<c?!1:!!this.St(r,n,e)}if(270==i){if(t.x<s||t.x>o)return!1;t=(y-l)/(v-f)*(a-f)+l;return r.y=t,r.x=a,c<t?!1:!!this.St(r,n,e)}if(270!=i&&90!=i&&Math.abs(o-s<.001)){o=s,s=Math.tan(i/180*Math.PI)*(o-a)+c;if(r.y=s,r.x=o,this.St(r,n,e)){o=o-a,s=s-c;return 0<o/Math.sqrt(o*o+s*s)*Math.cos(i/180*Math.PI)}}if(Math.abs(h-u<=.001)){h=u,u=1/Math.tan(i/180*Math.PI)*(h-c)+a;if(r.x=u,r.y=h,this.St(r,n,e)){var u=u-a,p=h-c;return 0<u/Math.sqrt(u*u+p*p)*Math.cos(i/180*Math.PI)}return!1}p=Math.tan(i/180*Math.PI),v=(y-l)/(v-f),v=(l-c-(v*f-p*a))/(p-v),p=c+p*(v-a);if(r.x=v,r.y=p,this.St(r,n,e)){a=v-a,c=p-c;return Math.abs(a)<=.001&&Math.abs(c)<=.001?!0:0<a/Math.sqrt(a*a+c*c)*Math.cos(i/180*Math.PI)}return!1},Nt:function(t,i){return Math.abs(t.x-i.x)<lt&&Math.abs(t.y-i.y)<lt},Dt:function(t,i,n,e){var r=t.x,s=t.y,o=i.x,u=i.y,h=n.x,a=n.y;if(this.Nt(t,i)||this.Nt(t,n))return e.x=r,e.y=s,!0;var c=Math.min(i.x,n.x),f=Math.max(i.x,n.x),l=Math.min(i.y,n.y),v=Math.max(i.y,n.y);if(Math.abs(o-h)<1e-5)return e.x=o,l<=(e.y=s)&&s<=v;if(Math.abs(u-a)<1e-5)return e.x=r,e.y=u,c<=r&&r<=f;f=-1/((a-u)/(h-o)),h=(a-u)/(h-o),h=(u-s-(h*o-f*r))/(f-h),r=s+f*(h-r);return e.x=h,e.y=r,!!this.St(e,i,n)||!(!this.Nt(t,i)&&!this.Nt(t,n))},Vt:function(t,i){return{x:t.y*i.z-t.z*i.y,y:t.z*i.x-t.x*i.z,z:t.x*i.y-t.y*i.x}},Zt:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},zt:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},Ut:function(t,i){return t.x*i.x+t.y*i.y},Gt:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Yt:function(t,i){if(0==t.x&&0==t.y||0==i.x&&0==i.y)return 0;var n={x:t.x,y:t.y,z:0},e={x:i.x,y:i.y,z:0},n=this.Vt(n,e),e=this.Ut(t,i),i=Math.acos(e/(this.Gt(t)*this.Gt(i)));return 0<n.z?i/Math.PI*180:360-i/Math.PI*180},Ht:function(t,i,n,e){for(var r=0;r<n.length;r++){var s=n[r],o=n[(r+1)%n.length];if(1==this.Bt(t,i,s,o,e))return!0}return!1},Xt:function(t,i,n,e,r){var s=Math.min(t.x,n.x,e.x),o=Math.max(t.x,n.x,e.x),u=Math.min(t.y,n.y,e.y),h=Math.max(t.y,n.y,e.y),h=Math.sqrt((o-s)*(o-s)+(h-u)*(h-u)),u=i/180*Math.PI,i=h*Math.cos(u)+t.x,u=h*Math.sin(u)+t.y;return 1==this.Bt(t,{x:i,y:u},n,e,r)},qt:function(t){for(var i={x:null,y:null},n=0,e=0,r=0;r<t.length;r++)n+=t[r].x,e+=t[r].y;return i.x=n/t.length,i.y=e/t.length,i},Qt:function(t,i,n,e){var r=[],s=t.x-i,o=t.x+i,u=t.y-i,h=t.y+i,a=Math.min(n.x,e.x),c=Math.max(n.x,e.x),f=Math.min(n.y,e.y),l=Math.max(n.y,e.y);if(c<s||o<a||l<u||h<f)return r;s=e.x-n.x,o=e.y-n.y,u=t.x-n.x,h=t.y-n.y,e=s*s+o*o,t=(s*u+o*h)/e,i=t*t-(u*u+h*h-i*i)/e;if(i<0)return r;e=Math.sqrt(i),i=-t+e,t=-t-e,e={x:n.x-s*i,y:n.y-o*i},o={x:n.x-s*t,y:n.y-o*t};return i===t||(a<=e.x&&e.x<=c&&f<=e.y&&e.y<=l&&r.push(e),a<=o.x&&o.x<=c&&f<=o.y&&o.y<=l&&r.push(o)),r}});var dt=new n,pt={Drive:1,Walk:0};function bt(t,i){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=wt(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw r}}}}function mt(t){return function(t){if(Array.isArray(t))return gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||wt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(t,i){if(t){if("string"==typeof t)return gt(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(t,i):void 0}}function gt(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function Mt(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.Wt=t.type,this.stepLength=.7,this.Kt=180/Math.PI,this.Jt=[295829355.45,147914677.73,73957338.86,36978669.43,18489334.72,9244667.36,4622333.68,2311166.84,1155583.42,577791.71,288895.85,144447.93,72223.96,36111.98,18056,9028,4514,2257,1128,564,282,141,70,35,17,8,4,2,1],this.u=null,this.$t=null,this.ti=5,this.ii=!0,this.ni=.2,this.ei=!1,this.ri=!0,this.si=!1,this.oi=1.2,this.ui=80,this.hi=30,this.ai=21,this.ci=!0,this.fi=22,this.li=1.3,this.vi="",this.yi=100,this.di=3,this.pi=1,this.bi=6,this.mi=10,this.wi=5,this.gi=0,this.Mi=!1,this.ki=!1,this.Ri=!1,this.Ei=!1,this.Oi=0,this.Si=0,this.Ti=0,this.Ai=0,this.ji=null,this.xi=null,this.Ci=!1,this.Ii=null,this.Li=null,this.Pi=!1,this._i=!1,this.Bi=null,this.Fi=0,this.Ni=fengmap.FMLanguageType.ZH,this.Di=fengmap.FMNaviMode.MODULE_SHORTEST,this.Vi=fengmap.FMNaviPriority.PRIORITY_DEFAULT,this.Zi=!1,this.zi=!0,this.Ui=[],this.Gi=!1,this.Yi=new Map,this.Hi=!0,this.crossCircles,this.Xi={radius:.5,dash:{size:4,gap:2}},this.qi="#002FA7",this.Qi=!0,this.Wi=0,this.Ki=new j,this.Ji=new T,this.$i(t),this.R()}var t,n,e;return t=i,(n=[{key:"locationMarker",get:function(){return this.tn},set:function(t){this.tn=t}},{key:"naviResult",get:function(){return this.in}},{key:"followPosition",get:function(){return this.ii},set:function(t){this.ii=t}},{key:"on",value:function(t,i){this.Ji.J(t,i)}},{key:"off",value:function(t,i){this.Ji.it(t,i)}},{key:"dispose",value:function(){this.stop(),this.u=null,this.$t&&(this.$t.dispose(),this.$t=null)}},{key:"setLanguage",value:function(t){this.Ni!=t&&(this.Ni=t,this.nn())}},{key:"setObstructions",value:function(t){this.$t.setObstructions(t)}},{key:"setStartPoint",value:function(t,i){this.en=Object.assign({},this.en,t,{x:t.x,y:t.y,level:t.level,buildingID:t.buildingID,height:"number"==typeof t.height?t.height:this.bi});var n=null;return n=t.url&&!i?this.rn(this.en,!0):n}},{key:"setDestPoint",value:function(t,i){this.sn=Object.assign({},this.sn,t,{x:t.x,y:t.y,level:t.level,buildingID:t.buildingID,height:"number"==typeof t.height?t.height:this.bi});var n=null;return n=t.url&&!i?this.rn(this.sn,!1):n}},{key:"route",value:function(t,i,n){this.$i(t),this.hn(),this.an({mode:this.Di,priority:this.Vi,toDoors:this.Zi,obstruct:this.zi,viapoints:this.Ui,barrierFree:this.Gi},i,n)}},{key:"naviConstraint",value:function(t){if(this.en&&this.sn){null==this.cn&&this.fn(),t.buildingID=void 0!==t.buildingID?t.buildingID:null;for(var i={},n=[],e=Number.MAX_VALUE,r=0,s=0;s<this.cn.length;s++)if(this.cn[s].bid===t.buildingID){for(var o=this.cn[s].naviPoints,u=1;u<o.length;u++){var h,a,c=o[u-1],f=o[u],l=c.index-r,v=this.ln[s].result.naviDescriptionsData[l].endPoint;c.level!==t.level||f.level!==t.level||(h=dt.It(t,c,f,i))<=e&&(a={index:-1,coords:{level:t.level,buildingID:t.buildingID},angle:null,distance:Number.MAX_VALUE,distanceToNext:Number.MAX_VALUE,remain:this.vn,relDirection:1,time:null,dots:[],insertIndex:-1,toNext:null,buildingIndex:-1},null!=this.yn&&(l=(t.x-this.yn.x)*(f.x-c.x)+(t.y-this.yn.y)*(f.y-c.y),0===Math.abs(l)&&null!=this.dn?a.relDirection=this.dn.relDirection:l<0&&(a.relDirection=-1)),a.distance=h,Object.assign(a.coords,i),a.angle=this.pn(c,f),a.index=c.index,a.distanceToNext=dt.jt(i,v),a.insertIndex=u,a.toNext=dt.jt(i,f),a.buildingIndex=s,n.push(a),e=h)}r+=this.ln[s].result.naviDescriptionsData.length}else r+=this.ln[s].result.naviDescriptionsData.length;var y=null,d=this.bn(n,e);return d&&(this.mn(y=d),y.time=t.time),this.yn=t,this.dn=y}}},{key:"pathConstraint",value:function(t,i){return this.$t?this.$t.pathConstraint(t,i):null}},{key:"locate",value:function(t,i){this.ki&&this.stop(),this.wn(t,i),this.yn=t}},{key:"locateNoConstraint",value:function(t,i){this.ki&&this.stop(),this.gn(t,i),this.yn=t}},{key:"clearLocationMarker",value:function(){this.tn&&(this.tn.remove(),this.tn=null)}},{key:"clearMarkers",value:function(){this.Mn&&(this.Mn.remove(),this.Mn=null,this.en=null),this.kn&&(this.kn.remove(),this.kn=null,this.sn=null)}},{key:"drawNaviLine",value:function(t){if(this.en&&this.sn)return this.Rn=this.En(this.On,t),this.Rn}},{key:"clearNaviLine",value:function(){this.Rn&&(this.Rn.remove(),this.Rn=null)}},{key:"clearAll",value:function(){this.clearMarkers(),this.clearNaviLine(),this.clearLocationMarker()}},{key:"overview",value:function(t,i){var n=this;if(0!==this.On.length){for(var e=new U,r=[],s=0;s<this.On.length;s++)!function(t){var i=[Number.MAX_VALUE,-Number.MAX_VALUE];n.On[t].resultbuild.forEach(function(t){i[0]=Math.min(i[0],t.level),i[1]=Math.max(i[1],t.level),e.vt(t.pointList)}),r.push({bid:n.On[t].bid,levelRange:i})}(s);this.Sn(t,e,r,i)}}},{key:"focusNaviLineSegment",value:function(t,i,n){if(0!=this.ln.length){for(var e,r,s,o=null,u=null,h=0;h<this.ln.length;h++){var a=this.ln[h].result.naviDescriptionsData;if(t-a.length<0){o=a[t],u=this.ln[h].bid;break}t-=a.length}u&&o&&((e=new U).vt([o.startPoint,o.endPoint]),r=[Math.min(o.startLevel,o.endLevel),Math.max(o.startLevel,o.endLevel)],s=this.u.getBuilding(u),this.Sn(i,e,r,s,n))}}},{key:"simulate",value:function(t){var i,n,e=this;this.en&&this.sn&&0!==this.On.length&&(this.ki&&this.stop(),this.ki=!0,this.$i(t),this.Ci=!(i={}),this.Ii=this.u.getRotation(),n=i.oi||this.oi,i.ai=i.ai||this.ai||0,this.Tn(),this.tn.rotateTo({heading:-this.Ii}),this.ii?this.An(this.en.level,this.en.buildingID,n,function(){e.ki&&e.jn(e.en,n,function(){var t;e.ki&&(t=i.ai>e.fi?e.fi:i.ai,e.ci?e.xn(e.ui,n,function(){e.ki&&e.Cn(t,n,function(){e.ki&&e.In()})}):e.Cn(t,n,function(){e.ki&&e.In()}))})}):this.ki&&this.In())}},{key:"pause",value:function(){this.Ei=!0}},{key:"resume",value:function(){this.Ei=!1}},{key:"stop",value:function(){this.Mi=!0,this.Ki.stop(),this.Ln&&this.u.off("update",this.Ln),this.Ei=!1,this.xi=null,this.Li=null,this.Ti=0,this.Ci=!1,this.Bi=null,this.Fi=0,this.Pi=!1,this._i=!1,this.Ln=null,this.ki=!1,this.Ri=!1,this.Oi=0,this.Si=0,this.ji=null}},{key:"getSpeed",value:function(){return this.ti}},{key:"setSpeed",value:function(t){this.ti=t}},{key:"addZoomCircle",value:function(t){if(0!=t.length){var i,n=null==t[0].buildingID?null:t[0].buildingID;this.Yi.has(n)?i=this.Yi.get(n):(i=new Map,this.Yi.set(n,i));for(var e,r=0;r<t.length;r++)i.has(t[r].level)||i.set(t[r].level,[]),(e=i.get(t[r].level)).push.apply(e,mt(t[r].circle))}}},{key:"stopZoomCircle",value:function(){this.Hi=!1}},{key:"constraintTrack",value:function(t){return this.$t.constraintTrack(t)}}])&&Mt(t.prototype,n),e&&Mt(t,e),i}();Object.assign(e.prototype,{$i:function(t){t&&(void 0!==t.map&&(this.u=t.map),void 0!==t.analyser&&(this.$t=t.analyser),void 0!==t.speed&&(this.ti=t.speed),void 0!==t.followSpeed&&(this.ni=t.followSpeed),void 0!==t.followPosition&&(this.ii=t.followPosition),void 0!==t.followAngle&&(this.ei=t.followAngle),void 0!==t.locationMarkerFollowAngle&&(this.ri=t.locationMarkerFollowAngle),void 0!==t.isMultiLevels&&(this.si=t.isMultiLevels),void 0!==t.inTime&&(this.oi=t.inTime),void 0!==t.tiltAngle&&(this.ui=t.tiltAngle),void 0!==t.changeFloorTiltAngle&&(this.hi=t.changeFloorTiltAngle),void 0!==t.changeTiltAngle&&(this.ci=t.changeTiltAngle),void 0!==t.zoom&&(this.ai=t.zoom),void 0!==t.maxZoom&&(this.fi=t.maxZoom),void 0!==t.extendScale&&(this.li=t.extendScale),void 0!==t.locationMarkerUrl&&(this.vi=t.locationMarkerUrl),void 0!==t.locationMarkerSize&&(this.yi=t.locationMarkerSize),void 0!==t.locationMarkerHeight&&(this.di=t.locationMarkerHeight),void 0!==t.lineMarkerHeight&&(this.pi=t.lineMarkerHeight),void 0!==t.imageMarkerHeight&&(this.bi=t.imageMarkerHeight),void 0!==t.directionAssert&&(this.mi=t.directionAssert),void 0!==t.combineAsset&&(this.wi=t.combineAsset),void 0!==t.completeDistance&&(this.gi=t.completeDistance),void 0!==t.Ni&&(this.mi=t.directionAssert),void 0!==t.mode&&(this.Di=t.mode),void 0!==t.priority&&(this.Vi=t.priority),void 0!==t.toDoors&&(this.Zi=t.toDoors),void 0!==t.obstruct&&(this.zi=t.obstruct),void 0!==t.viapoints&&(this.Ui=t.viapoints),void 0!==t.barrierFree&&(this.Gi=t.barrierFree),void 0!==t.lineStyle&&Object.assign(this.Xi,t.lineStyle),void 0!==t.linePassed&&(this.Qi=t.linePassed))},R:function(){1===this.Wt?this.Pn=void 0!==fengmap.FMNaviDriveAnalyser&&this.$t instanceof fengmap.FMNaviDriveAnalyser:this.Pn=void 0!==fengmap.FMNaviAnalyser&&(this.$t instanceof fengmap.FMNaviAnalyser||this.$t instanceof fengmap.FMNaviWalkAnalyser),this.en=null,this.sn=null,this.Mn=null,this.kn=null,this.tn=null,this.Ln=null,this.hn()},Tn:function(){this.tn instanceof fengmap.FMLocationMarker?this.tn.moveTo({buildingID:this.en.buildingID,level:this.en.level,x:this.en.x,y:this.en.y}):this.tn=new fengmap.FMLocationMarker({id:"location",buildingID:this.en.buildingID,level:this.en.level,x:this.en.x,y:this.en.y,url:this.vi||"",size:this.yi,height:this.di}),this.tn.addTo(this.u)},_n:function(t){for(var i,n=arguments.length<=1?0:arguments.length-1,e=0;e<n;e++){var r=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(t[r])return t[r]}return(i=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=i?void 0:arguments[i]},Bn:function(t){if(this.en&&this.sn)return t==this.en.level||t==this.Fn.level},hn:function(){this.in=null,this.Nn=[],this.Dn=[],this.On=[],this.Vn=[],this.ln=[],this.cn=[],this.Zn=[],this.zn=[],this.vn=0,this.Un=[],this.dn=null,this.yn=null},rn:function(t,i){if(t.level){var n=t.url||(i?"image/small/marker/nav_location_start.png":"image/small/marker/nav_location_dest.png"),e=i?this.Mn:this.kn;e&&e.remove();var r=(null!=t.buildingID?this.u.getBuilding(t.buildingID):this.u).getFloor(t.level);if(r)return(e=new fengmap.FMImageMarker(Object.assign({map:this.u,url:n,callback:function(){t.callback&&t.callback(e)},anchor:fengmap.FMMarkerAnchor.BOTTOM,depth:!1,collision:!1},t))).addTo(r),i?this.Mn=e:this.kn=e,e}},an:function(t,i,n){var e=this;this.en&&this.sn&&(t=Object.assign({start:Object.assign({},this.en),dest:Object.assign({},this.sn)},t),this.Gn(t,function(t){e.in=t,e.Yn(),e.crossCircles=e.Hn(e.On,e.Yi),e.Xn(),e.qn(),e.Qn(),e.fn(),i&&i(t)},function(t){n&&n(t)}))},Yn:function(){if(this.in&&this.in.subs&&0!=this.in.subs.length){for(var t=this.in.subs[0].buildingID,i=[],n=[],e=[],r=0;r<this.in.subs.length;r++){var s=this.in.subs[r];s.buildingID!==t&&(e.push({bid:t,result:i}),i=[],t=s.buildingID),i.push(s),r==this.in.subs.length-1&&e.push({bid:t,result:i})}for(var o=0;o<e.length;o++){var u=this.Wn(e[o].result);n.push({bid:e[o].bid,resultbuild:u})}this.Nn=e,this.On=n}},Wn:function(t){for(var i=[],n=Number.NaN,e=null,r=0;r<t.length;r++){var s,o=t[r];n!=o.levels[0]&&((e={length:0,level:o.levels[0],pointList:[]}).pointList.push(o.waypoint.points[0]),i.push(e),n=o.levels[0]),o.levels[0]==o.levels[1]?((s=e.pointList).push.apply(s,mt(o.waypoint.points.slice(1))),e.length+=o.distance):(e={length:0,level:o.levels[0],pointList:[o.waypoint.points[0]]},i.push(e),e={length:0,level:o.levels[1],pointList:[o.waypoint.points[1]]},i.push(e))}return i},Xn:function(){for(var t=0;t<this.On.length;t++){var i=this.On[t].resultbuild;this.Kn(i)}},Kn:function(t){for(var i=0;i<t.length-1;i++){var n,e,r=t[i];r.length&&(n=r.pointList[r.pointList.length-1],e=t[i+1].pointList[0],.2<dt.jt(n,e)&&r.pointList.push(Object.assign({},e)))}},qn:function(){for(var t=0;t<this.On.length;t++){var i=this.On[t].resultbuild,i=this.Jn(i);this.Vn.push({bid:this.On[t].bid,groupsPoints:i})}},Jn:function(t){for(var i=[],n=null,e=null,r=0;r<t.length;r++){var s=t[r],o=n==s.level;0==s.length&&0!=r&&r!=t.length-1||(o||(n=s.level,e&&i.push(e),e={level:s.level,pointList:[]}),e.pointList=e.pointList.concat(s.pointList))}return e&&i.push(e),i},Qn:function(){if(this.in)for(var t=0;t<this.Nn.length;t++){var i=this.Nn[t].bid,n=this.Nn[t].result,n=this.nn(n);this.ln.push({bid:i,result:n}),this.vn+=n.naviDistance}},nn:function(t){if(t){for(var i=[],n=[],e=[],r=0,s=this.Ni,o=t,u=0,h=null,a=0;a<o.length;a++){var c=o[a],f=c.waypoint.points,l=c.waypoint.direction[s];i.push(c.instruction[s]);l={startDirection:l[0],startIndex:void 0,startLevel:c.levels[0],startPoint:f[0],endDirection:l[1],endIndex:void 0,endLevel:c.levels[1],endPoint:f.slice(-1)[0],distance:c.distance};c.levels[0]==c.levels[1]?(l.startIndex=u,u+=f.length-1,l.endIndex=u):u=0,n.push(l),null!=h&&c.levels[0]==c.levels[1]||(h={level:c.levels[1],distance:0},e.push(h)),h.distance+=c.distance,r+=c.distance}return{naviDescriptions:i,naviDescriptionsData:n,naviFloorsDistance:e,naviDistance:r}}},fn:function(){if(this.Nn){for(var t=0,i=[],n=0;n<this.Nn.length;n++){for(var e=this.Nn[n].result,r=this.Nn[n].bid,s=this.$n(e),o=this.te(e),u=0;u<s.length;u++)s[u].index+=t;for(var h=0;h<o.length;h++)o[h].index+=t;var a=this.ln[n].result.naviDistance;t+=e.length,i.push({bid:r,distance:a,naviPoints:s,naviSubPoints:o})}this.cn=i}},$n:function(t){if(!t)return[];for(var i=[],n=t,e=0;e<n.length;e++){var r=n[e];if(r.levels[0]==r.levels[1])for(var s=e+1==n.length?null:n[e+1],o=r.waypoint.points,u=null==s||s.levels[0]!=s.levels[1]?o.length:o.length-1,h=0;h<u;h++){var a={x:o[h].x,y:o[h].y,z:0,level:r.levels[0],index:e};i.push(a)}}return i},te:function(t){if(!t)return[];for(var i=[],n=t,e=0;e<n.length;e++){var r=n[e].waypoint.points,s={x:r[0].x,y:r[0].y,level:r[0].level,index:e};i.push(s),e==n.length-1&&(r={x:r.slice(-1)[0].x,y:r.slice(-1)[0].y,level:r.slice(-1)[0].level,index:n.length},i.push(r))}return i},bn:function(t,i){for(var n=null,e=[],r=0;r<t.length;)t[r].distance==i&&e.push(t[r]),r+=1;if(1<e.length){for(var s=0;s<e.length;s++)if(0<=e[s].relDirection){n=e[s];break}-1===n.index&&(n=e[0])}else 1==e.length&&(n=e[0]);return n},mn:function(t){if(-1!=t.buildingIndex&&-1!==t.insertIndex){for(var i,n,e=t.buildingIndex,r=this.cn[e].naviPoints,s=0,o=r.length-1;o>t.insertIndex;o--)o-1>=t.insertIndex&&(i=r[o],n=r[o-1],i.level===n.level&&(s+=dt.jt(i,n)));r[t.insertIndex]&&r[t.insertIndex].level===t.coords.level&&(s+=dt.jt(r[t.insertIndex],t.coords));for(var u=e+1;u<this.cn.length;u++)s+=this.cn[u].distance;t.remain=s}},En:function(t,i){if(0===t.length)return null;1===this.Wt&&(this.Xi.hasOwnProperty("color")||(this.Xi.color=this.qi));var n=Object.assign({},this.Xi);i&&i.style&&Object.assign(n,i.style);for(var s=i&&i.height?i.height:this.pi,o=[],e=0;e<t.length;e++)for(var u=t[e].bid,h=t[e].resultbuild,r=0;r<h.length;r++)(function(t){var i=h[t],n=i.pointList;if(0===n.length)return;var t=i.level,e=[];n.forEach(function(t){var i=parseFloat(""+t.x),t=parseFloat(""+t.y);e.push({x:i,y:t,z:s})}),n.length<2&&(i=parseFloat(""+n[0].x),r=parseFloat(""+n[0].y),e.push({x:i,y:r,z:s}));var r=new fengmap.FMSegment;r.level=t,r.points=e,r.buildingID=u,o.push(r)})(r);n=new fengmap.FMLineMarker(Object.assign({segments:o},n));return n.passed=i&&null!=i.passed?i.passed:this.Qi,n.addTo(this.u),n},Gn:function(t,i,n){var e=this;this.$t.route(t,function(t){e.Zi&&t.door&&(e.sn.x=t.door.x,e.sn.y=t.door.y),i&&i(t)},function(t){n&&n(t)})},jn:function(t,i,n){this.u.setCenter({x:t.x,y:t.y,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},xn:function(t,i,n){this.u.setTilt({tilt:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},ie:function(t,i,n){this.u.setRotation({rotation:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},Cn:function(t,i,n){this.u.setZoom({zoom:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n},!0)},An:function(t,i,n,e){var r,i=null==i?((r=this.u).setVisibleLevels([t]),r.getLevel()):((r=this.u.getBuilding(i)).setVisibleLevels([t]),r.level);return i==t?(e&&e(),null):r.setLevel({level:t,animate:"number"==typeof n,duration:"number"==typeof n?n:0,finish:e})},ne:function(t){var i=this.Dn;if(0===i.length)return[];for(var n=[],e=0,r=0;r<i.length;r++){var s=i[r];if(!(s.pointList.length<=1))for(var o=s.level,u=0;u<s.pointList.length;u++){var h=s.pointList[u],h=new N(h.x,0,h.y);h.level=o;for(var a=-1,c=1;c<t.length;c++)if(e<t[c].ee){a=t[c-1].re;break}h.re=-1!==a?a:t[t.length-1].re,n.push(h),e++}}return n},se:function(t,i){if(0===i)return t[0];for(var n,e=0,r=0,s=t[0],o=1;o<t.length;o++)if((n=t[o]).bid===s.bid)if(n.level===s.level){if(i<=(e+=(u=n.clone().sub(s)).length())){u.normalize();var u=s.clone().add(u.clone().multiplyScalar(i-r));return u.level=n.level,u.index=n.re!=s.index?s.index:n.re,u.bid=(n.bid!=s.bid?s:n).bid,u}(s=n.clone()).level=n.level,s.index=n.re,s.bid=n.bid,r=e}else s=n;else s=n;var h=t[t.length-1];return h.index=h.re,h.bid=h.bid,h},oe:function(t){if(!t||0===t.length)return[];var e=-1,r=0,s=-1,i=t.map(function(t,i){var n=new N(t.startPoint.x,0,t.startPoint.y);return n.level=t.startLevel,n.re=i,e=i,t.startLevel!==t.endLevel?(r+=s,n.ee=r,r++):n.ee=t.startIndex+r,s=t.endIndex,n}),n=this.ue[this.ue.length-1],t=new N(n.endPoint.x,0,n.endPoint.y);return t.level=n.endLevel,t.re=e+1,t.ee=n.endIndex+r,i.push(t),i},he:function(t){var i=this;if(this.tn){if(this._i){var n={x:t.x,y:t.y,height:this.tn.height,level:t.level,buildingID:t.bid};return this.tn.moveTo(n),void(this._i=!1)}var e={},r=e.oi||this.oi;e.ai=e.ai||this.ai||0;var s=e.ai>this.fi?this.fi:e.ai;this.si||(n={x:this.tn.x,y:this.tn.y,height:this.tn.height,level:t.level,buildingID:t.bid},(e=this.Vn[this.Oi].groupsPoints[this.Si])&&e.pointList&&0<e.pointList.length&&(n=Object.assign(n,e.pointList[0])),this.tn.moveTo(n),this.tn.visible=!0),this.ci&&this.xn(this.ui,r,null),this.jn(t,r,function(){i.Cn(s,r,function(){i.Pi=!1})})}},ae:function(t){var i;this.tn&&(i={x:this.tn.x,y:this.tn.y,height:this.tn.height,level:t.level,buildingID:t.bid},(t=this.Vn[this.Oi].groupsPoints[this.Si])&&t.pointList&&0<t.pointList.length&&(i=Object.assign(i,t.pointList[0])),this.tn.moveTo(i),this._i=!1)},pn:function(t,i){var n=new N(0,0,1),t=new N(t.x,0,t.y),i=new N(i.x,0,i.y).clone().sub(t).normalize(),t=i.angleTo(n)*dt.bt();return 0<i.clone().cross(n).y?360-t:t},ce:function(t,i,n){return t===i?t:(180<Math.abs(i-t)&&(t<i?t+=360:i+=360),(t*(1-n)+i*n)%360)},fe:function(t,i){var n=this.Jt,e=Math.floor(t),r=n[e-1]*(1-t%1)+n[e]*(t%1);for(r*=i,e=0;r<n[e];)e++;return e+1-(r-n[e])/(n[e-1]-n[e])},le:function(t){if(this.Mi||requestAnimationFrame(this.le.bind(this,t)),!this.Ri&&(t.cnt++,t.cnt===t.step)){t.cnt=0;var i=this.Ki.getDelta();if(!(this._i||this.Pi||this.Ei||(this.Ti+=this.ti*i,this.Ti<=0))){var n=Object.assign({},this.se(t.ps,this.Ti)),e=this.vn-this.Ti,i=n.y;if(n.y=n.z,n.z=i,this.ji={distance:0,remain:e<this.Ai?this.Ai:e,walk:this.Ti,point:n,level:n.level,buildingID:n.bid,index:n.index-1},null!=this.xi&&(this.Li=this.pn(this.xi,n)),this.xi=Object.assign({},n),!n||e<this.Ai&&this.Ci)this.Ri=!0;else if(e<this.Ai&&!this.Ci&&(this.Ci=!0),this.Fi||(this.Fi=t.ps[0].level),null==this.Bi&&(this.Bi=t.ps[0].bid||"outdoor"),this.ki){t=n.bid||"outdoor";if(this.Bi!==t){this._i=!0,this.Bi=t,this.Oi++,this.Si=0,this.Fi=n.level;return this.ve(1,n),void this.Ji.nt({type:"transit",level:n.level,buildingID:n.bid})}this.Fi!==n.level&&(this.Fi=n.level,this.Si++,this.ve(0,n),this.Ji.nt({type:"transit",level:n.level,buildingID:n.bid}))}}}},ve:function(t,i){var n=this;if(this.ii){var e={},r=e.oi||this.oi;e.ai=e.ai||this.ai||0;var s=e.ai>this.fi?this.fi:e.ai;if(1===t)return this.ye(i.level,i.bid,function(){n.An(i.level,i.bid,r,function(){n.he(i)})});this.Pi=!0,this.ci&&this.xn(this.hi,r,null),this.si||(this.tn.visible=!1),this.ye(i.level,i.bid,function(){n.An(i.level,i.bid,r,function(){n.Cn(s,r,function(){n.jn(i,r,function(){n.ci?n.xn(n.ui,r,function(){n.he(i)}):n.he(i)})})})})}},de:function(){this.Mi=!1;for(var t=[],i=0;i<this.cn.length;i++){for(var n=this.cn[i].naviPoints,e=[],r=0;r<n.length;r++){var s=new N(n[r].x,0,n[r].y);s.re=n[r].index,s.level=n[r].level,s.bid=this.cn[i].bid,e.push(s)}t.push.apply(t,e)}this.Ki.start(),this.Ri=!1,this.Oi=0,this.Si=0,this.le({step:2,cnt:0,ps:t})},pe:function(){if(!(this.Pi||this._i||this.Ei)){if(this.xi){var t=new N(this.tn.x,this.tn.y,0).lerp(this.xi,this.Ci?1:this.ni);t.level=this.xi.level,t.buildingID=this.xi.bid;var i,n,e=this.naviConstraint(t);if(!e)return;if(this.tn.moveTo({x:t.x,y:t.y,height:this.di,level:t.level,buildingID:t.buildingID}),this.Rn&&(this.Rn.passed?this.Rn.moveProportion(1-e.remain/this.vn):this.Rn.moveProportion(0)),this.Hi)for(var r=0;r<this.crossCircles.length;r++)e.coords.buildingID==this.crossCircles[r].bid&&e.coords.level==this.crossCircles[r].level&&e.remain<=this.crossCircles[r].point.remain&&e.remain>=this.crossCircles[r].remain&&(i=!0,n=this.crossCircles[r].point);if(this.Wt===pt.Drive?this.Ji.nt(Object.assign({},this.ji,{type:"driving",distance:e.distance,remain:e.remain,walk:this.vn-e.remain,distanceToNext:e.distanceToNext,angle:e.angle,point:e.coords,level:e.coords.level,buildingID:e.coords.buildindID,index:e.index,enterCircle:i,intersect:n})):this.Ji.nt(Object.assign({},this.ji,{type:"walking",distance:e.distance,remain:e.remain,walk:this.vn-e.remain,distanceToNext:e.distanceToNext,angle:e.angle,point:e.coords,level:e.coords.level,buildingID:e.coords.buildindID,index:e.index,enterCircle:i,intersect:n})),i=!1,n=null,this.ii?this.jn(t):this.u.updateCountDown_=0,this.Ri)return this.stop(),void this.Ji.nt({type:"complete"})}null!=this.Li&&(t=this.ce(this.Ii,this.Li,this.ni),this.Ii=t,this.tn.rotateTo({heading:-t}),this.ei&&this.ie(t))}},In:function(){this.de(),this.Ln=this.pe.bind(this),this.u.on("update",this.Ln)},wn:function(t,i){var n=this.naviConstraint(t);if(n){if(this.Rn&&(this.Rn.passed?this.Rn.moveProportion(1-n.remain/this.vn):this.Rn.moveProportion(0)),this.Hi)for(var e=0;e<this.crossCircles.length;e++)n.coords.buildingID==this.crossCircles[e].bid&&n.coords.leve==this.crossCircles[e].level&&n.remain<=this.crossCircles[e].point.remain&&n.remain>=this.crossCircles[e].remain&&(r=!0,s=this.crossCircles[e].point);var t=null,t=this.Wt===pt.Drive?{type:"driving",distance:n.distance,remain:n.remain,drive:this.vn-n.remain,distanceToNext:n.distanceToNext,angle:n.angle,point:n.coords,level:n.coords.level,buildingID:n.coords.buildingID,index:n.index,enterCircle:r,intersect:s}:{type:"walking",distance:n.distance,remain:n.remain,walk:this.vn-n.remain,distanceToNext:n.distanceToNext,angle:n.angle,point:n.coords,level:n.coords.level,buildingID:n.coords.buildingID,index:n.index,enterCircle:r,intersect:s},r=!1,s=null;this.Ji.nt(t),this.tn&&(n.coords.height=this.di,this.tn.moveTo(n.coords),void 0!==i?this.tn.rotateTo({heading:i}):this.tn.rotateTo({heading:-n.angle}))}},gn:function(t,i){var n,e,r=this.naviConstraint(t);if(r){if(this.Hi)for(var s=0;s<this.crossCircles.length;s++)r.coords.buildingID==this.crossCircles[s].bid&&r.coords.leve==this.crossCircles[s].level&&r.remain<=this.crossCircles[s].point.remain&&r.remain>=this.crossCircles[s].remain&&(n=!0,e=this.crossCircles[s].point);this.Wt===pt.Drive?this.Ji.nt({type:"driving",distance:r.distance,remain:r.remain,drive:this.vn-r.remain,distanceToNext:r.distanceToNext,angle:r.angle,point:r.coords,level:r.coords.level,buildingID:r.coords.buildingID,index:r.index,enterCircle:n,intersect:e}):this.Ji.nt({type:"walking",distance:r.distance,remain:r.remain,walk:this.vn-r.remain,distanceToNext:r.distanceToNext,angle:r.angle,point:r.coords,level:r.coords.level,buildingID:r.coords.buildingID,index:r.index,enterCircle:n,intersect:e}),n=!1,e=null,this.tn&&(t.height=this.di,this.tn.moveTo(t),void 0!==i?this.tn.rotateTo({heading:i}):this.tn.rotateTo({heading:-r.angle}))}},be:function(t,i){for(var n=[{x:t.min.x,y:t.min.y},{x:t.min.x,y:t.max.y},{x:t.max.x,y:t.max.y},{x:t.max.x,y:t.min.y}],e=new U,r=0;r<i.length;r++)for(var s=i[r].levelRange,o=0;o<s.length;o++)for(var u=0,u=o===s.length-1?this.pi+2*this.Xi.radius:this.pi,h=0;h<n.length;h++){var a=fengmap.FMUtil.coordsMapToScreen(this.u,{x:n[h].x,y:n[h].y,buildingID:i[r].bid,level:s[o],height:u});a&&e.vt([a])}return e},me:function(t,i){var n=this.be(t,i).size,t=this.u.getContainer().clientHeight,i=this.u.getContainer().clientWidth;return i/t>n.x/n.y?n.y/t:n.x/i},we:function(t,i,n,e,r,s){var o=this,u=this.me(t,i),h=this.u.getZoom();u?(h=this.fe(this.u.getZoom(),u*(n||1)),r=e-1):h-=1,this.u.setZoom({zoom:h,animate:!1,finish:function(){++r===e?s&&s({zoom:h}):o.we(t,i,n,e,r,s)}})},ge:function(t,i){for(var n=this.be(t,i),e=[],r=0;r<i.length;r++){var s=i[r].levelRange;if(!(o=i[r].bid))for(var o=this.u.getMapOptions().buildingID,u=0;u<s.length;u++){var h=this.u.getBuilding(o).getFloor(s[u]).height;e.push(fengmap.FMUtil.coordsScreenToMap(this.u,{x:(n.max.x+n.min.x)/2,y:(n.max.y+n.min.y)/2,z:h+2*this.Xi.radius}))}}for(var a=new N,c=0;c<e.length;c++)a.add(e[c]);return a.divideScalar(e.length),a},Me:function(n,e,r,s,o,u){var h=this;this.we(n,e,r,10,0,function(t){var i=h.ge(n,e);h.u.setCenter({animate:!1,x:i.x,y:i.y,finish:function(){++o===s?u&&u({zoom:t.zoom,center:i}):h.Me(n,e,r,s,o,u)}})})},Sn:function(t,s,o,u){for(var h=this,a=t&&void 0!==t.ratio?t.ratio:1,i=t&&void 0!==t.rotation?t.rotation:0,n=t&&void 0!==t.tilt?t.tilt:30,c=!t||void 0===t.animate||t.animate,e=1,r=[1],f=0;f<o.length;f++){for(var l=o[f].levelRange,v=[],y=l[0];y<=l[1];)v.push(y),y++;null==o[f].bid?e=(r=v)[Math.floor((v.length-1)/2)]:this.u.getBuilding(o[f].bid).setVisibleLevels(v)}this.u.setVisibleLevels(r,function(){h.u.setLevel({level:e,animate:c,finish:function(){var t=r.length%2==0?h.u.getFloorSpace()/2:0;h.u.getInteracations().controls.panAdd({x:0,y:t,z:0}),h.u.setCenter({animate:c,x:s.center.x,y:s.center.y,finish:function(){h.u.setTilt({tilt:n,animate:c,finish:function(){h.u.setRotation({rotation:i,animate:c,finish:function(){var i=h.u.getInteracations(),t=h.u.copyCamera(),n=i.copyControls(t),e=i.controls,r=h.u.camera;i.controls=n,h.u.camera=t,h.u.getInteracations().controls.update(),h.Me(s,o,a,10,0,function(t){i.controls=e,h.u.camera=r,n.dispose(),n=null,h.u.enableUpdateRender(),h.u.setZoom({animate:c,zoom:t.zoom,duration:.5}),h.u.setCenter({animate:c,x:t.center.x,y:t.center.y,duration:.5,finish:function(){u&&u()}})})}})}})}})}})})},ye:function(t,i,n){if(null==t||null==i)return n&&n(),null;for(var e=this.u.getBuilding(i).levelChart,r=this.u.getVisibleLevels(),s=null,o=0;o<e.length;o++)if(o%2==1&&e[o]===t&&(s=e[o-1],r.indexOf(s)<0)){this.u.setVisibleLevels([s]);break}return null==s||this.u.getLevel()===s?(n&&n(),null):this.u.setLevel({level:s,animate:"number"==typeof duration,duration:"number"==typeof duration?duration:0,finish:n})},Hn:function(t,i){if(!i)return[];for(var n=0,e=0,r=[],s=0;s<t.length;s++)for(var o=t[s].resultbuild,u=0;u<o.length;u++)e+=o[u].length;for(var h=0;h<t.length;h++)for(var a=t[h].bid,c=t[h].resultbuild,f=0;f<c.length;f++){var l=c[f].level,v=c[f].pointList;if(0<f&&(n+=c[f-1].length),!(v.length<=1)&&(i.has(a)&&i.get(a).has(l)))for(var y=0,d=i.get(a).get(l),p=0;p<v.length;p++){0<p&&(y+=dt.distance(v[p-1],v[p]));var b,m=bt(d);try{for(m.s();!(b=m.n()).done;){var w,g=b.value,M=this.ke(v,g,p);M&&(M.remain=0==p?e-(n+y):e-(n+y-M.disIntersectToPoint),w=e-(n+y-M.disCenterToPoint),r.push({center:g.center,radius:g.radius,remain:w,point:M,level:l,bid:a}))}}catch(t){m.e(t)}finally{m.f()}}}return r},ke:function(t,i,n){var e=0;if(0==n)return dt.xt(t[n],i.center)<=.001?Object.assign({disIntersectToCenter:disIntersectToCenter,disIntersectToPoint:e},t[n]):null;if(dt.xt(i.center,t[n-1])<=.001)return null;if(dt.Ct(i.center,t[n-1],t[n])<=.001){var r,s=bt(i.points);try{for(s.s();!(r=s.n()).done;){var o=r.value;if(!dt.St(o,i.center,t[n]))for(var u=n;0<u;u--)if(dt.St(o,t[u-1],t[u])&&dt.Ct(o,t[u-1],t[u])<=.001){for(var h=[o],a=u;a<=n;a++)h.push(t[a]);for(var c=0;c<h.length-1;c++)e+=dt.distance(h[c],h[c+1]);return o.disIntersectToPoint=e,o.disCenterToPoint=dt.distance(i.center,t[n]),o}}}catch(t){s.e(t)}finally{s.f()}}return null}});var kt=e;function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ot(t,i,n){return(Ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=At(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function St(t,i){return(St=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Tt(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=At(n);return t=e?(t=At(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Rt(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function At(t){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}v=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&St(t,i)}(r,kt);var t,i,n,e=Tt(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),e.call(this,t,i,n)}return t=r,(i=[{key:"on",value:function(t,i){Ot(At(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){Ot(At(r.prototype),"off",this).call(this,t,i)}}])&&Et(t.prototype,i),n&&Et(t,n),r}();function jt(t){return(jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xt(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ct(t,i,n){return(Ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Pt(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function It(t,i){return(It=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Lt(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Pt(n);return t=e?(t=Pt(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==jt(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}S=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&It(t,i)}(r,kt);var t,i,n,e=Lt(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t.type=pt.Drive,(n=e.call(this,t,i,n)).ti=7,n.ni=.2,n}return t=r,(i=[{key:"on",value:function(t,i){Ct(Pt(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){Ct(Pt(r.prototype),"off",this).call(this,t,i)}},{key:"locate",value:function(t,i){Ct(Pt(r.prototype),"locate",this).call(this,t,i)}},{key:"locateNoConstraint",value:function(t,i){Ct(Pt(r.prototype),"locateNoConstraint",this).call(this,t,i)}},{key:"simulate",value:function(t){Ct(Pt(r.prototype),"simulate",this).call(this,t)}},{key:"naviResult",get:function(){return this.in}}])&&xt(t.prototype,i),n&&xt(t,n),r}();function _t(t){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ft(t,i,n){return(Ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Vt(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Nt(t,i){return(Nt=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Dt(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Vt(n);return t=e?(t=Vt(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==_t(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Vt(t){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}B=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Nt(t,i)}(r,kt);var t,i,n,e=Dt(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t.type=pt.Walk,e.call(this,t,i,n)}return t=r,(i=[{key:"on",value:function(t,i){Ft(Vt(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){Ft(Vt(r.prototype),"off",this).call(this,t,i)}}])&&Bt(t.prototype,i),n&&Bt(t,n),r}();function Zt(t,i,n,e){this.et=t||0,this.rt=i||0,this.st=n||0,this.ot=void 0!==e?e:1}Object.assign(Zt,{slerp:function(t,i,n,e){return n.copy(t).slerp(i,e)},slerpFlat:function(t,i,n,e,r,s,o){var u=n[e+0],h=n[e+1],a=n[e+2],c=n[e+3],f=r[s+0],l=r[s+1],v=r[s+2],y=r[s+3];c===y&&u===f&&h===l&&a===v||(n=1-o,r=0<=(e=u*f+h*l+a*v+c*y)?1:-1,(s=1-e*e)>Number.EPSILON&&(s=Math.sqrt(s),e=Math.atan2(s,e*r),n=Math.sin(n*e)/s,o=Math.sin(o*e)/s),u=u*n+f*(r=o*r),h=h*n+l*r,a=a*n+v*r,c=c*n+y*r,n===1-o&&(u*=o=1/Math.sqrt(u*u+h*h+a*a+c*c),h*=o,a*=o,c*=o)),t[i]=u,t[i+1]=h,t[i+2]=a,t[i+3]=c}}),Object.defineProperties(Zt.prototype,{x:{get:function(){return this.et},set:function(t){this.et=t,this.ut()}},y:{get:function(){return this.rt},set:function(t){this.rt=t,this.ut()}},z:{get:function(){return this.st},set:function(t){this.st=t,this.ut()}},w:{get:function(){return this.ot},set:function(t){this.ot=t,this.ut()}}}),Object.assign(Zt.prototype,{isQuaternion:!0,set:function(t,i,n,e){return this.et=t,this.rt=i,this.st=n,this.ot=e,this.ut(),this},clone:function(){return new this.constructor(this.et,this.rt,this.st,this.ot)},copy:function(t){return this.et=t.x,this.rt=t.y,this.st=t.z,this.ot=t.w,this.ut(),this},setFromEuler:function(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t.et,e=t.rt,r=t.st,s=t.order,o=Math.cos,u=Math.sin,h=o(n/2),t=o(e/2),o=o(r/2),n=u(n/2),e=u(e/2),r=u(r/2);return"XYZ"===s?(this.et=n*t*o+h*e*r,this.rt=h*e*o-n*t*r,this.st=h*t*r+n*e*o,this.ot=h*t*o-n*e*r):"YXZ"===s?(this.et=n*t*o+h*e*r,this.rt=h*e*o-n*t*r,this.st=h*t*r-n*e*o,this.ot=h*t*o+n*e*r):"ZXY"===s?(this.et=n*t*o-h*e*r,this.rt=h*e*o+n*t*r,this.st=h*t*r+n*e*o,this.ot=h*t*o-n*e*r):"ZYX"===s?(this.et=n*t*o-h*e*r,this.rt=h*e*o+n*t*r,this.st=h*t*r-n*e*o,this.ot=h*t*o+n*e*r):"YZX"===s?(this.et=n*t*o+h*e*r,this.rt=h*e*o+n*t*r,this.st=h*t*r-n*e*o,this.ot=h*t*o-n*e*r):"XZY"===s&&(this.et=n*t*o-h*e*r,this.rt=h*e*o-n*t*r,this.st=h*t*r+n*e*o,this.ot=h*t*o+n*e*r),!1!==i&&this.ut(),this},setFromAxisAngle:function(t,i){var n=i/2,i=Math.sin(n);return this.et=t.x*i,this.rt=t.y*i,this.st=t.z*i,this.ot=Math.cos(n),this.ut(),this},setFromRotationMatrix:function(t){var i,n=t.elements,e=n[0],r=n[4],s=n[8],o=n[1],u=n[5],h=n[9],a=n[2],c=n[6],t=n[10],n=e+u+t;return 0<n?(i=.5/Math.sqrt(n+1),this.ot=.25/i,this.et=(c-h)*i,this.rt=(s-a)*i,this.st=(o-r)*i):u<e&&t<e?(i=2*Math.sqrt(1+e-u-t),this.ot=(c-h)/i,this.et=.25*i,this.rt=(r+o)/i,this.st=(s+a)/i):t<u?(i=2*Math.sqrt(1+u-e-t),this.ot=(s-a)/i,this.et=(r+o)/i,this.rt=.25*i,this.st=(h+c)/i):(i=2*Math.sqrt(1+t-e-u),this.ot=(o-r)/i,this.et=(s+a)/i,this.rt=(h+c)/i,this.st=.25*i),this.ut(),this},setFromUnitVectors:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.et=-t.y,this.rt=t.x,this.st=0):(this.et=0,this.rt=-t.z,this.st=t.y)):(this.et=t.y*i.z-t.z*i.y,this.rt=t.z*i.x-t.x*i.z,this.st=t.x*i.y-t.y*i.x),this.ot=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(g.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var n=this.angleTo(t);if(0===n)return this;n=Math.min(1,i/n);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this.et*=-1,this.rt*=-1,this.st*=-1,this.ut(),this},dot:function(t){return this.et*t.et+this.rt*t.rt+this.st*t.st+this.ot*t.ot},lengthSq:function(){return this.et*this.et+this.rt*this.rt+this.st*this.st+this.ot*this.ot},length:function(){return Math.sqrt(this.et*this.et+this.rt*this.rt+this.st*this.st+this.ot*this.ot)},normalize:function(){var t=this.length();return 0===t?(this.et=0,this.rt=0,this.st=0,this.ot=1):(this.et=this.et*(t=1/t),this.rt=this.rt*t,this.st=this.st*t,this.ot=this.ot*t),this.ut(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var n=t.et,e=t.rt,r=t.st,s=t.ot,o=i.et,u=i.rt,t=i.st,i=i.ot;return this.et=n*i+s*o+e*t-r*u,this.rt=e*i+s*u+r*o-n*t,this.st=r*i+s*t+n*u-e*o,this.ot=s*i-n*o-e*u-r*t,this.ut(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var n=this.et,e=this.rt,r=this.st,s=this.ot,o=s*t.ot+n*t.et+e*t.rt+r*t.st;if(o<0?(this.ot=-t.ot,this.et=-t.et,this.rt=-t.rt,this.st=-t.st,o=-o):this.copy(t),1<=o)return this.ot=s,this.et=n,this.rt=e,this.st=r,this;t=1-o*o;if(t<=Number.EPSILON){var u=1-i;return this.ot=u*s+i*this.ot,this.et=u*n+i*this.et,this.rt=u*e+i*this.rt,this.st=u*r+i*this.st,this.normalize(),this.ut(),this}u=Math.sqrt(t),t=Math.atan2(u,o),o=Math.sin((1-i)*t)/u,u=Math.sin(i*t)/u;return this.ot=s*o+this.ot*u,this.et=n*o+this.et*u,this.rt=e*o+this.rt*u,this.st=r*o+this.st*u,this.ut(),this},equals:function(t){return t.et===this.et&&t.rt===this.rt&&t.st===this.st&&t.ot===this.ot},fromArray:function(t,i){return this.et=t[i=void 0===i?0:i],this.rt=t[i+1],this.st=t[i+2],this.ot=t[i+3],this.ut(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.et,t[i+1]=this.rt,t[i+2]=this.st,t[i+3]=this.ot,t},fromBufferAttribute:function(t,i){return this.et=t.getX(i),this.rt=t.getY(i),this.st=t.getZ(i),this.ot=t.getW(i),this},Re:function(t){return this.ut=t,this},ut:function(){}});var zt=new Gt,Ut=new Zt;function Gt(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0}Object.assign(Gt.prototype,{isVector3:!0,set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ut.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(Ut.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*e,this.y=t[1]*i+t[4]*n+t[7]*e,this.z=t[2]*i+t[5]*n+t[8]*e,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements,t=1/(r[3]*i+r[7]*n+r[11]*e+r[15]);return this.x=(r[0]*i+r[4]*n+r[8]*e+r[12])*t,this.y=(r[1]*i+r[5]*n+r[9]*e+r[13])*t,this.z=(r[2]*i+r[6]*n+r[10]*e+r[14])*t,this},applyQuaternion:function(t){var i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,o=t.z,u=t.w,h=u*i+s*e-o*n,a=u*n+o*i-r*e,t=u*e+r*n-s*i,e=-r*i-s*n-o*e;return this.x=h*u+e*-r+a*-o-t*-s,this.y=a*u+e*-s+t*-r-h*-o,this.z=t*u+e*-o+h*-s-a*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e,this.y=t[1]*i+t[5]*n+t[9]*e,this.z=t[2]*i+t[6]*n+t[10]*e,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},cross:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)},crossVectors:function(t,i){var n=t.x,e=t.y,r=t.z,s=i.x,t=i.y,i=i.z;return this.x=e*i-r*t,this.y=r*s-n*i,this.z=n*t-e*s,this},projectOnVector:function(t){var i=t.lengthSq();if(0===i)return this.set(0,0,0);i=t.dot(this)/i;return this.copy(t).multiplyScalar(i)},projectOnPlane:function(t){return zt.copy(this).projectOnVector(t),this.sub(zt)},reflect:function(t){return this.sub(zt.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;i=this.dot(t)/i;return Math.acos(g.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,n){var e=Math.sin(i)*t;return this.x=e*Math.sin(n),this.y=Math.cos(i)*t,this.z=e*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},setFromMatrix3Column:function(t,i){return this.fromArray(t.elements,3*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var Yt=new Gt,Ht=new Jt,Xt=new Gt(0,0,0),qt=new Gt(1,1,1),Qt=new Gt,Wt=new Gt,Kt=new Gt;function Jt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function $t(){}Object.assign(Jt.prototype,{isMatrix4:!0,set:function(t,i,n,e,r,s,o,u,h,a,c,f,l,v,y,d){var p=this.elements;return p[0]=t,p[4]=i,p[8]=n,p[12]=e,p[1]=r,p[5]=s,p[9]=o,p[13]=u,p[2]=h,p[6]=a,p[10]=c,p[14]=f,p[3]=l,p[7]=v,p[11]=y,p[15]=d,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Jt).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this},copyPosition:function(t){var i=this.elements,t=t.elements;return i[12]=t[12],i[13]=t[13],i[14]=t[14],this},extractBasis:function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,n=t.elements,e=1/Yt.setFromMatrixColumn(t,0).length(),r=1/Yt.setFromMatrixColumn(t,1).length(),t=1/Yt.setFromMatrixColumn(t,2).length();return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=0,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i,n,e,r,s,o,u,h,a,c,f,l,v=this.elements,y=t.x,d=t.y,p=t.z,b=Math.cos(y),m=Math.sin(y),w=Math.cos(d),y=Math.sin(d),d=Math.cos(p),p=Math.sin(p);return"XYZ"===t.order?(s=b*d,o=b*p,u=m*d,h=m*p,v[0]=w*d,v[4]=-w*p,v[8]=y,v[1]=o+u*y,v[5]=s-h*y,v[9]=-m*w,v[2]=h-s*y,v[6]=u+o*y,v[10]=b*w):"YXZ"===t.order?(n=w*p,e=y*d,v[0]=(i=w*d)+(r=y*p)*m,v[4]=e*m-n,v[8]=b*y,v[1]=b*p,v[5]=b*d,v[9]=-m,v[2]=n*m-e,v[6]=r+i*m,v[10]=b*w):"ZXY"===t.order?(n=w*p,e=y*d,v[0]=(i=w*d)-(r=y*p)*m,v[4]=-b*p,v[8]=e+n*m,v[1]=n+e*m,v[5]=b*d,v[9]=r-i*m,v[2]=-b*y,v[6]=m,v[10]=b*w):"ZYX"===t.order?(s=b*d,o=b*p,u=m*d,h=m*p,v[0]=w*d,v[4]=u*y-o,v[8]=s*y+h,v[1]=w*p,v[5]=h*y+s,v[9]=o*y-u,v[2]=-y,v[6]=m*w,v[10]=b*w):"YZX"===t.order?(a=b*w,c=b*y,f=m*w,l=m*y,v[0]=w*d,v[4]=l-a*p,v[8]=f*p+c,v[1]=p,v[5]=b*d,v[9]=-m*d,v[2]=-y*d,v[6]=c*p+f,v[10]=a-l*p):"XZY"===t.order&&(a=b*w,c=b*y,f=m*w,l=m*y,v[0]=w*d,v[4]=-p,v[8]=y*d,v[1]=a*p+l,v[5]=b*d,v[9]=c*p-f,v[2]=f*p-c,v[6]=m*d,v[10]=l*p+a),v[3]=0,v[7]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(Xt,t,qt)},lookAt:function(t,i,n){var e=this.elements;return Kt.subVectors(t,i),0===Kt.lengthSq()&&(Kt.z=1),Kt.normalize(),Qt.crossVectors(n,Kt),0===Qt.lengthSq()&&(1===Math.abs(n.z)?Kt.x+=1e-4:Kt.z+=1e-4,Kt.normalize(),Qt.crossVectors(n,Kt)),Qt.normalize(),Wt.crossVectors(Kt,Qt),e[0]=Qt.x,e[4]=Wt.x,e[8]=Kt.x,e[1]=Qt.y,e[5]=Wt.y,e[9]=Kt.y,e[2]=Qt.z,e[6]=Wt.z,e[10]=Kt.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var n=t.elements,e=i.elements,r=this.elements,s=n[0],o=n[4],u=n[8],h=n[12],a=n[1],c=n[5],f=n[9],l=n[13],v=n[2],y=n[6],d=n[10],p=n[14],b=n[3],m=n[7],w=n[11],g=n[15],M=e[0],k=e[4],R=e[8],E=e[12],O=e[1],S=e[5],T=e[9],A=e[13],j=e[2],x=e[6],C=e[10],I=e[14],t=e[3],i=e[7],n=e[11],e=e[15];return r[0]=s*M+o*O+u*j+h*t,r[4]=s*k+o*S+u*x+h*i,r[8]=s*R+o*T+u*C+h*n,r[12]=s*E+o*A+u*I+h*e,r[1]=a*M+c*O+f*j+l*t,r[5]=a*k+c*S+f*x+l*i,r[9]=a*R+c*T+f*C+l*n,r[13]=a*E+c*A+f*I+l*e,r[2]=v*M+y*O+d*j+p*t,r[6]=v*k+y*S+d*x+p*i,r[10]=v*R+y*T+d*C+p*n,r[14]=v*E+y*A+d*I+p*e,r[3]=b*M+m*O+w*j+g*t,r[7]=b*k+m*S+w*x+g*i,r[11]=b*R+m*T+w*C+g*n,r[15]=b*E+m*A+w*I+g*e,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[4],e=t[8],r=t[12],s=t[1],o=t[5],u=t[9],h=t[13],a=t[2],c=t[6],f=t[10],l=t[14];return t[3]*(+r*u*c-e*h*c-r*o*f+n*h*f+e*o*l-n*u*l)+t[7]*(+i*u*l-i*h*f+r*s*f-e*s*l+e*h*a-r*u*a)+t[11]*(+i*h*c-i*o*l-r*s*c+n*s*l+r*o*a-n*h*a)+t[15]*(-e*o*a-i*u*c+i*o*f+e*s*c-n*s*f+n*u*a)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this},setPosition:function(t,i,n){var e=this.elements;return t.isVector3?(e[12]=t.x,e[13]=t.y,e[14]=t.z):(e[12]=t,e[13]=i,e[14]=n),this},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,e=t.elements,r=e[0],s=e[1],o=e[2],u=e[3],h=e[4],a=e[5],c=e[6],f=e[7],l=e[8],v=e[9],y=e[10],d=e[11],p=e[12],b=e[13],m=e[14],w=e[15],g=v*m*f-b*y*f+b*c*d-a*m*d-v*c*w+a*y*w,M=p*y*f-l*m*f-p*c*d+h*m*d+l*c*w-h*y*w,i=l*b*f-p*v*f+p*a*d-h*b*d-l*a*w+h*v*w,t=p*v*c-l*b*c-p*a*y+h*b*y+l*a*m-h*v*m,e=r*g+s*M+o*i+u*t;if(0==e)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);e=1/e;return n[0]=g*e,n[1]=(b*y*u-v*m*u-b*o*d+s*m*d+v*o*w-s*y*w)*e,n[2]=(a*m*u-b*c*u+b*o*f-s*m*f-a*o*w+s*c*w)*e,n[3]=(v*c*u-a*y*u-v*o*f+s*y*f+a*o*d-s*c*d)*e,n[4]=M*e,n[5]=(l*m*u-p*y*u+p*o*d-r*m*d-l*o*w+r*y*w)*e,n[6]=(p*c*u-h*m*u-p*o*f+r*m*f+h*o*w-r*c*w)*e,n[7]=(h*y*u-l*c*u+l*o*f-r*y*f-h*o*d+r*c*d)*e,n[8]=i*e,n[9]=(p*v*u-l*b*u-p*s*d+r*b*d+l*s*w-r*v*w)*e,n[10]=(h*b*u-p*a*u+p*s*f-r*b*f-h*s*w+r*a*w)*e,n[11]=(l*a*u-h*v*u-l*s*f+r*v*f+h*s*d-r*a*d)*e,n[12]=t*e,n[13]=(l*b*o-p*v*o+p*s*y-r*b*y-l*s*m+r*v*m)*e,n[14]=(p*a*o-h*b*o-p*s*c+r*b*c+h*s*m-r*a*m)*e,n[15]=(h*v*o-l*a*o+l*s*c-r*v*c-h*s*y+r*a*y)*e,this},scale:function(t){var i=this.elements,n=t.x,e=t.y,t=t.z;return i[0]*=n,i[4]*=e,i[8]*=t,i[1]*=n,i[5]*=e,i[9]*=t,i[2]*=n,i[6]*=e,i[10]*=t,i[3]*=n,i[7]*=e,i[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,t))},makeTranslation:function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var n=Math.cos(i),e=Math.sin(i),r=1-n,s=t.x,o=t.y,u=t.z,i=r*s,t=r*o;return this.set(i*s+n,i*o-e*u,i*u+e*o,0,i*o+e*u,t*o+n,t*u-e*s,0,i*u-e*o,t*u+e*s,r*u*u+n,0,0,0,0,1),this},makeScale:function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,i,n){return this.set(1,i,n,0,t,1,n,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,n){var e=this.elements,r=i.et,s=i.rt,o=i.st,u=i.ot,h=r+r,a=s+s,c=o+o,f=r*h,l=r*a,v=r*c,i=s*a,r=s*c,s=o*c,o=u*h,h=u*a,a=u*c,u=n.x,c=n.y,n=n.z;return e[0]=(1-(i+s))*u,e[1]=(l+a)*u,e[2]=(v-h)*u,e[3]=0,e[4]=(l-a)*c,e[5]=(1-(f+s))*c,e[6]=(r+o)*c,e[7]=0,e[8]=(v+h)*n,e[9]=(r-o)*n,e[10]=(1-(f+i))*n,e[11]=0,e[12]=t.x,e[13]=t.y,e[14]=t.z,e[15]=1,this},decompose:function(t,i,n){var e=this.elements,r=Yt.set(e[0],e[1],e[2]).length(),s=Yt.set(e[4],e[5],e[6]).length(),o=Yt.set(e[8],e[9],e[10]).length();this.determinant()<0&&(r=-r),t.x=e[12],t.y=e[13],t.z=e[14],Ht.copy(this);var u=1/r,t=1/s,e=1/o;return Ht.elements[0]*=u,Ht.elements[1]*=u,Ht.elements[2]*=u,Ht.elements[4]*=t,Ht.elements[5]*=t,Ht.elements[6]*=t,Ht.elements[8]*=e,Ht.elements[9]*=e,Ht.elements[10]*=e,i.setFromRotationMatrix(Ht),n.x=r,n.y=s,n.z=o,this},makePerspective:function(t,i,n,e,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,u=2*r/(n-e),h=(i+t)/(i-t),n=(n+e)/(n-e),e=-(s+r)/(s-r),s=-2*s*r/(s-r);return o[0]=2*r/(i-t),o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=u,o[9]=n,o[13]=0,o[2]=0,o[6]=0,o[10]=e,o[14]=s,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,i,n,e,r,s){var o=this.elements,u=1/(i-t),h=1/(n-e),a=1/(s-r),t=(i+t)*u,e=(n+e)*h,r=(s+r)*a;return o[0]=2*u,o[4]=0,o[8]=0,o[12]=-t,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-e,o[2]=0,o[6]=0,o[10]=-2*a,o[14]=-r,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var i=this.elements,n=t.elements,e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<16;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}),Object.assign($t.prototype,{addEventListener:function(t,i){void 0===this.$&&(this.$={});var n=this.$;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){if(void 0===this.$)return!1;var n=this.$;return void 0!==n[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){void 0!==this.$&&(void 0===(t=this.$[t])||-1!==(i=t.indexOf(i))&&t.splice(i,1))},dispatchEvent:function(t){if(void 0!==this.$){var i=this.$[t.type];if(void 0!==i){t.target=this;for(var n=i.slice(0),e=0,r=n.length;e<r;e++)n[e].call(this,t)}}}});var ti=new Jt,ii=new Zt;function ni(t,i,n,e){this.et=t||0,this.rt=i||0,this.st=n||0,this.ht=e||ni.DefaultOrder}function ei(){this.mask=1}function ri(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}ni.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ni.DefaultOrder="XYZ",Object.defineProperties(ni.prototype,{x:{get:function(){return this.et},set:function(t){this.et=t,this.ut()}},y:{get:function(){return this.rt},set:function(t){this.rt=t,this.ut()}},z:{get:function(){return this.st},set:function(t){this.st=t,this.ut()}},order:{get:function(){return this.ht},set:function(t){this.ht=t,this.ut()}}}),Object.assign(ni.prototype,{isEuler:!0,set:function(t,i,n,e){return this.et=t,this.rt=i,this.st=n,this.ht=e||this.ht,this.ut(),this},clone:function(){return new this.constructor(this.et,this.rt,this.st,this.ht)},copy:function(t){return this.et=t.et,this.rt=t.rt,this.st=t.st,this.ht=t.ht,this.ut(),this},setFromRotationMatrix:function(t,i,n){var e=g.clamp,r=t.elements,s=r[0],o=r[4],u=r[8],h=r[1],a=r[5],c=r[9],f=r[2],t=r[6],r=r[10];return"XYZ"===(i=i||this.ht)?(this.rt=Math.asin(e(u,-1,1)),Math.abs(u)<.9999999?(this.et=Math.atan2(-c,r),this.st=Math.atan2(-o,s)):(this.et=Math.atan2(t,a),this.st=0)):"YXZ"===i?(this.et=Math.asin(-e(c,-1,1)),Math.abs(c)<.9999999?(this.rt=Math.atan2(u,r),this.st=Math.atan2(h,a)):(this.rt=Math.atan2(-f,s),this.st=0)):"ZXY"===i?(this.et=Math.asin(e(t,-1,1)),Math.abs(t)<.9999999?(this.rt=Math.atan2(-f,r),this.st=Math.atan2(-o,a)):(this.rt=0,this.st=Math.atan2(h,s))):"ZYX"===i?(this.rt=Math.asin(-e(f,-1,1)),Math.abs(f)<.9999999?(this.et=Math.atan2(t,r),this.st=Math.atan2(h,s)):(this.et=0,this.st=Math.atan2(-o,a))):"YZX"===i?(this.st=Math.asin(e(h,-1,1)),Math.abs(h)<.9999999?(this.et=Math.atan2(-c,a),this.rt=Math.atan2(-f,s)):(this.et=0,this.rt=Math.atan2(u,r))):"XZY"===i?(this.st=Math.asin(-e(o,-1,1)),Math.abs(o)<.9999999?(this.et=Math.atan2(t,a),this.rt=Math.atan2(u,s)):(this.et=Math.atan2(-c,r),this.rt=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this.ht=i,!1!==n&&this.ut(),this},setFromQuaternion:function(t,i,n){return ti.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ti,i,n)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this.ht)},reorder:function(t){return ii.setFromEuler(this),this.setFromQuaternion(ii,t)},equals:function(t){return t.et===this.et&&t.rt===this.rt&&t.st===this.st&&t.ht===this.ht},fromArray:function(t){return this.et=t[0],this.rt=t[1],this.st=t[2],void 0!==t[3]&&(this.ht=t[3]),this.ut(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.et,t[i+1]=this.rt,t[i+2]=this.st,t[i+3]=this.ht,t},toVector3:function(t){return t?t.set(this.et,this.rt,this.st):new Gt(this.et,this.rt,this.st)},Re:function(t){return this.ut=t,this},ut:function(){}}),Object.assign(ei.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(ri.prototype,{isMatrix3:!0,set:function(t,i,n,e,r,s,o,u,h){var a=this.elements;return a[0]=t,a[1]=e,a[2]=o,a[3]=i,a[4]=r,a[5]=u,a[6]=n,a[7]=s,a[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},extractBasis:function(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var n=t.elements,e=i.elements,r=this.elements,s=n[0],o=n[3],u=n[6],h=n[1],a=n[4],c=n[7],f=n[2],l=n[5],v=n[8],y=e[0],d=e[3],p=e[6],b=e[1],m=e[4],t=e[7],i=e[2],n=e[5],e=e[8];return r[0]=s*y+o*b+u*i,r[3]=s*d+o*m+u*n,r[6]=s*p+o*t+u*e,r[1]=h*y+a*b+c*i,r[4]=h*d+a*m+c*n,r[7]=h*p+a*t+c*e,r[2]=f*y+l*b+v*i,r[5]=f*d+l*m+v*n,r[8]=f*p+l*t+v*e,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],o=t[5],u=t[6],h=t[7],t=t[8];return i*s*t-i*o*h-n*r*t+n*o*u+e*r*h-e*s*u},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,e=this.elements,r=n[0],s=n[1],o=n[2],u=n[3],h=n[4],a=n[5],c=n[6],f=n[7],l=n[8],v=l*h-a*f,i=a*c-l*u,t=f*u-h*c,n=r*v+s*i+o*t;if(0==n)return this.set(0,0,0,0,0,0,0,0,0);n=1/n;return e[0]=v*n,e[1]=(o*f-l*s)*n,e[2]=(a*s-o*h)*n,e[3]=i*n,e[4]=(l*r-o*c)*n,e[5]=(o*u-a*r)*n,e[6]=t*n,e[7]=(s*c-f*r)*n,e[8]=(h*r-s*u)*n,this},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,n,e,r,s,o){var u=Math.cos(r),r=Math.sin(r);this.set(n*u,n*r,-n*(u*s+r*o)+s+t,-e*r,e*u,-e*(-r*s+u*o)+o+i,0,0,1)},scale:function(t,i){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this},rotate:function(t){var i=Math.cos(t),n=Math.sin(t),e=this.elements,r=e[0],s=e[3],o=e[6],u=e[1],h=e[4],t=e[7];return e[0]=i*r+n*u,e[3]=i*s+n*h,e[6]=i*o+n*t,e[1]=-n*r+i*u,e[4]=-n*s+i*h,e[7]=-n*o+i*t,this},translate:function(t,i){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this},equals:function(t){for(var i=this.elements,n=t.elements,e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<9;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}});var si=0,oi=new Gt,ui=new Zt,hi=new Jt,ai=new Gt,ci=new Gt,fi=new Gt,li=new Zt,vi=new Gt(1,0,0),yi=new Gt(0,1,0),di=new Gt(0,0,1),pi={type:"added"},bi={type:"removed"};function mi(){Object.defineProperty(this,"id",{value:si++}),this.uuid=g.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mi.DefaultUp.clone();var t=new Gt,i=new ni,n=new Zt,e=new Gt(1,1,1);i.Re(function(){n.setFromEuler(i,!1)}),n.Re(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new Jt},normalMatrix:{value:new ri}}),this.matrix=new Jt,this.matrixWorld=new Jt,this.matrixAutoUpdate=mi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ei,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function wi(){mi.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}mi.DefaultUp=new Gt(0,1,0),mi.DefaultMatrixAutoUpdate=!0,mi.prototype=Object.assign(Object.create($t.prototype),{constructor:mi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return ui.setFromAxisAngle(t,i),this.quaternion.multiply(ui),this},rotateOnWorldAxis:function(t,i){return ui.setFromAxisAngle(t,i),this.quaternion.premultiply(ui),this},rotateX:function(t){return this.rotateOnAxis(vi,t)},rotateY:function(t){return this.rotateOnAxis(yi,t)},rotateZ:function(t){return this.rotateOnAxis(di,t)},translateOnAxis:function(t,i){return oi.copy(t).applyQuaternion(this.quaternion),this.position.add(oi.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(vi,t)},translateY:function(t){return this.translateOnAxis(yi,t)},translateZ:function(t){return this.translateOnAxis(di,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(hi.getInverse(this.matrixWorld))},lookAt:function(t,i,n){t.isVector3?ai.copy(t):ai.set(t,i,n);n=this.parent;this.updateWorldMatrix(!0,!1),ci.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hi.lookAt(ci,ai,this.up):hi.lookAt(ai,ci,this.up),this.quaternion.setFromRotationMatrix(hi),n&&(hi.extractRotation(n.matrixWorld),ui.setFromRotationMatrix(hi),this.quaternion.premultiply(ui.inverse()))},add:function(t){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(pi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this},remove:function(t){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(bi)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),hi.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(hi),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,e=this.children.length;n<e;n++){var r=this.children[n].getObjectByProperty(t,i);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Gt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Zt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ci,t,fi),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Gt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ci,li,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Gt),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var e=this.children,r=0,s=e.length;r<s;r++)e[r].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++){var e=t.children[n];this.add(e.clone())}return this}}),wi.prototype=Object.assign(Object.create(mi.prototype),{constructor:wi,isScene:!0,copy:function(t,i){return mi.prototype.copy.call(this,t,i),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var gi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mi={h:0,s:0,l:0},ki={h:0,s:0,l:0};function Ri(t,i,n){return void 0===i&&void 0===n?this.set(t):this.setRGB(t,i,n)}function Ei(t,i,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(i-t)*n:n<.5?i:n<2/3?t+6*(i-t)*(2/3-n):t}function Oi(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Si(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Ti(t,i,n){this.name="",this.color=new Ri(t),this.near=void 0!==i?i:1,this.far=void 0!==n?n:1e3}Object.assign(Ri.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,n){return this.r=t,this.g=i,this.b=n,this},setHSL:function(t,i,n){return t=g.euclideanModulo(t,1),i=g.clamp(i,0,1),n=g.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(this.r=Ei(i=2*n-(n=n<=.5?n*(1+i):n+i-n*i),n,t+1/3),this.g=Ei(i,n,t),this.b=Ei(i,n,t-1/3)),this},setStyle:function(i){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}if(h=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(i)){var n,e=h[1],r=h[2];switch(e){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){var s=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,u=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(s,o,u)}}}else if(h=/^\#([A-Fa-f0-9]+)$/.exec(i)){var e=h[1],h=e.length;if(3===h)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return i&&0<i.length?this.setColorName(i):this},setColorName:function(t){var i=gi[t];return void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){i=0<(i=void 0===i?2:i)?1/i:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=Oi(t.r),this.g=Oi(t.g),this.b=Oi(t.b),this},copyLinearToSRGB:function(t){return this.r=Si(t.r),this.g=Si(t.g),this.b=Si(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var i,n=this.r,e=this.g,r=this.b,s=Math.max(n,e,r),o=Math.min(n,e,r),u=(o+s)/2;if(o===s)a=i=0;else{var h=s-o,a=u<=.5?h/(s+o):h/(2-s-o);switch(s){case n:i=(e-r)/h+(e<r?6:0);break;case e:i=(r-n)/h+2;break;case r:i=(n-e)/h+4}i/=6}return t.h=i,t.s=a,t.l=u,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,n){return this.getHSL(Mi),Mi.h+=t,Mi.s+=i,Mi.l+=n,this.setHSL(Mi.h,Mi.s,Mi.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},lerpHSL:function(t,i){this.getHSL(Mi),t.getHSL(ki);var n=g.lerp(Mi.h,ki.h,i),t=g.lerp(Mi.s,ki.s,i),i=g.lerp(Mi.l,ki.l,i);return this.setHSL(n,t,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return this.r=t[i=void 0===i?0:i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}}),Ri.NAMES=gi,Object.assign(Ti.prototype,{isFog:!0,clone:function(){return new Ti(this.color,this.near,this.far)}});var Ai=[new Gt,new Gt,new Gt,new Gt,new Gt,new Gt,new Gt,new Gt],ji=new Gt,xi=new Zi,Ci=new Gt,Ii=new Gt,Li=new Gt,Pi=new Gt,_i=new Gt,Bi=new Gt,Fi=new Gt,Ni=new Gt,Di=new Gt,Vi=new Gt;function Zi(t,i){this.min=void 0!==t?t:new Gt(1/0,1/0,1/0),this.max=void 0!==i?i:new Gt(-1/0,-1/0,-1/0)}function zi(t,i,n,e,r){for(var s=0,o=t.length-3;s<=o;s+=3){Vi.fromArray(t,s);var u=r.x*Math.abs(Vi.x)+r.y*Math.abs(Vi.y)+r.z*Math.abs(Vi.z),h=i.dot(Vi),a=n.dot(Vi),c=e.dot(Vi);if(Math.max(-Math.max(h,a,c),Math.min(h,a,c))>u)return!1}return!0}function Ui(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==e?e:1}function Gi(t,i){this.x=t||0,this.y=i||0}Object.assign(Zi.prototype,{isBox3:!0,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){for(var i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,o=-1/0,u=0,h=t.length;u<h;u+=3){var a=t[u],c=t[u+1],f=t[u+2];a<i&&(i=a),c<n&&(n=c),f<e&&(e=f),r<a&&(r=a),s<c&&(s=c),o<f&&(o=f)}return this.min.set(i,n,e),this.max.set(r,s,o),this},setFromBufferAttribute:function(t){for(var i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,o=-1/0,u=0,h=t.count;u<h;u++){var a=t.getX(u),c=t.getY(u),f=t.getZ(u);a<i&&(i=a),c<n&&(n=c),f<e&&(e=f),r<a&&(r=a),s<c&&(s=c),o<f&&(o=f)}return this.min.set(i,n,e),this.max.set(r,s,o),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){i=ji.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Gt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Gt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var i=t.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),xi.copy(i.boundingBox),xi.applyMatrix4(t.matrixWorld),this.union(xi));for(var n=t.children,e=0,r=n.length;e<r;e++)this.expandByObject(n[e]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new Gt),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,ji),ji.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,n=0<t.normal.x?(i=t.normal.x*this.min.x,t.normal.x*this.max.x):(i=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Fi),Ni.subVectors(this.max,Fi),Ci.subVectors(t.a,Fi),Ii.subVectors(t.b,Fi),Li.subVectors(t.c,Fi),Pi.subVectors(Ii,Ci),_i.subVectors(Li,Ii),Bi.subVectors(Ci,Li);t=[0,-Pi.z,Pi.y,0,-_i.z,_i.y,0,-Bi.z,Bi.y,Pi.z,0,-Pi.x,_i.z,0,-_i.x,Bi.z,0,-Bi.x,-Pi.y,Pi.x,0,-_i.y,_i.x,0,-Bi.y,Bi.x,0];return!!zi(t,Ci,Ii,Li,Ni)&&(!!zi(t=[1,0,0,0,1,0,0,0,1],Ci,Ii,Li,Ni)&&(Di.crossVectors(Pi,_i),zi(t=[Di.x,Di.y,Di.z],Ci,Ii,Li,Ni)))},clampPoint:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new Gt),i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return ji.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(ji).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(Ai[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ai[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ai[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ai[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ai[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ai[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ai[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ai[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ai)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.defineProperties(Ui.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Ui.prototype,{isVector4:!0,set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,r=this.w,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e+t[12]*r,this.y=t[1]*i+t[5]*n+t[9]*e+t[13]*r,this.z=t[2]*i+t[6]*n+t[10]*e+t[14]*r,this.w=t[3]*i+t[7]*n+t[11]*e+t[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,n,e,r=t.elements,s=r[0],o=r[4],u=r[8],h=r[1],a=r[5],c=r[9],f=r[2],l=r[6],v=r[10];if(Math.abs(o-h)<.01&&Math.abs(u-f)<.01&&Math.abs(c-l)<.01){if(Math.abs(o+h)<.1&&Math.abs(u+f)<.1&&Math.abs(c+l)<.1&&Math.abs(s+a+v-3)<.1)return this.set(1,0,0,0),this;var y=Math.PI,d=(s+1)/2,p=(a+1)/2,b=(v+1)/2,m=(o+h)/4,t=(u+f)/4,r=(c+l)/4;return p<d&&b<d?e=d<.01?(i=0,n=.707106781):(n=m/(i=Math.sqrt(d)),t/i):b<p?e=p<.01?(n=0,i=.707106781):(i=m/(n=Math.sqrt(p)),r/n):b<.01?(n=i=.707106781,e=0):(i=t/(e=Math.sqrt(b)),n=r/e),this.set(i,n,e,y),this}y=Math.sqrt((l-c)*(l-c)+(u-f)*(u-f)+(h-o)*(h-o));return Math.abs(y)<.001&&(y=1),this.x=(l-c)/y,this.y=(u-f)/y,this.z=(h-o)/y,this.w=Math.acos((s+a+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}}),Object.defineProperties(Gi.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Gi.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,n=this.y,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6],this.y=t[1]*i+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var n=Math.cos(i),e=Math.sin(i),r=this.x-t.x,i=this.y-t.y;return this.x=r*n-i*e+t.x,this.y=r*e+i*n+t.y,this}});var Yi=0,Hi=1,Xi=2,qi=1,Qi=100,Wi=204,Ki=205,Ji=3,$i=0,tn=1001,nn=1006,en=1008,rn=1009,sn=1023,on=3e3,un=7680,hn=519,an=35044,cn=new Gt;function fn(t,i,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===n,this.usage=an,this.updateRange={offset:0,count:-1},this.version=0}function ln(t,i,n){fn.call(this,new Int8Array(t),i,n)}function vn(t,i,n){fn.call(this,new Uint8Array(t),i,n)}function yn(t,i,n){fn.call(this,new Uint8ClampedArray(t),i,n)}function dn(t,i,n){fn.call(this,new Int16Array(t),i,n)}function pn(t,i,n){fn.call(this,new Uint16Array(t),i,n)}function bn(t,i,n){fn.call(this,new Int32Array(t),i,n)}function mn(t,i,n){fn.call(this,new Uint32Array(t),i,n)}function wn(t,i,n){fn.call(this,new Float32Array(t),i,n)}function gn(t,i,n){fn.call(this,new Float64Array(t),i,n)}Object.defineProperty(fn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(fn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var e=0,r=this.itemSize;e<r;e++)this.array[t+e]=i.array[n+e];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),s=new Ri),i[n++]=s.r,i[n++]=s.g,i[n++]=s.b}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),s=new Gi),i[n++]=s.x,i[n++]=s.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),s=new Gt),i[n++]=s.x,i[n++]=s.y,i[n++]=s.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),s=new Ui),i[n++]=s.x,i[n++]=s.y,i[n++]=s.z,i[n++]=s.w}return this},applyMatrix3:function(t){for(var i=0,n=this.count;i<n;i++)cn.x=this.getX(i),cn.y=this.getY(i),cn.z=this.getZ(i),cn.applyMatrix3(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this},applyMatrix4:function(t){for(var i=0,n=this.count;i<n;i++)cn.x=this.getX(i),cn.y=this.getY(i),cn.z=this.getZ(i),cn.applyMatrix4(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this},applyNormalMatrix:function(t){for(var i=0,n=this.count;i<n;i++)cn.x=this.getX(i),cn.y=this.getY(i),cn.z=this.getZ(i),cn.applyNormalMatrix(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this},transformDirection:function(t){for(var i=0,n=this.count;i<n;i++)cn.x=this.getX(i),cn.y=this.getY(i),cn.z=this.getZ(i),cn.transformDirection(t),this.setXYZ(i,cn.x,cn.y,cn.z);return this},set:function(t,i){return this.array.set(t,i=void 0===i?0:i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,e){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this},setXYZW:function(t,i,n,e,r){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(ln.prototype=Object.create(fn.prototype)).constructor=ln,(vn.prototype=Object.create(fn.prototype)).constructor=vn,(yn.prototype=Object.create(fn.prototype)).constructor=yn,(dn.prototype=Object.create(fn.prototype)).constructor=dn,pn.prototype=Object.create(fn.prototype),pn.prototype.constructor=pn,(bn.prototype=Object.create(fn.prototype)).constructor=bn,mn.prototype=Object.create(fn.prototype),mn.prototype.constructor=mn,(wn.prototype=Object.create(fn.prototype)).constructor=wn,(gn.prototype=Object.create(fn.prototype)).constructor=gn;var Mn=new Zi;function kn(t,i){this.center=void 0!==t?t:new Gt,this.radius=void 0!==i?i:0}function Rn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(kn.prototype,{set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(t,i){var n=this.center;void 0!==i?n.copy(i):Mn.setFromPoints(t).getCenter(n);for(var e=0,r=0,s=t.length;r<s;r++)e=Math.max(e,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,i){var n=this.center.distanceToSquared(t);return void 0===i&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new Gt),i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Zi),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Rn.prototype,{computeGroups:function(t){for(var i,n=[],e=void 0,r=t.faces,s=0;s<r.length;s++){var o=r[s];o.materialIndex!==e&&(e=o.materialIndex,void 0!==i&&(i.count=3*s-i.start,n.push(i)),i={start:3*s,materialIndex:e})}void 0!==i&&(i.count=3*s-i.start,n.push(i)),this.groups=n},fromGeometry:function(t){var i=t.faces,n=t.vertices,e=t.faceVertexUvs,r=e[0]&&0<e[0].length,s=e[1]&&0<e[1].length,o=t.morphTargets,u=o.length;if(0<u){for(var h=[],a=0;a<u;a++)h[a]={name:o[a].name,data:[]};this.morphTargets.position=h}var c=t.morphNormals,f=c.length;if(0<f){for(var l=[],a=0;a<f;a++)l[a]={name:c[a].name,data:[]};this.morphTargets.normal=l}var v=t.skinIndices,y=t.skinWeights,d=v.length===n.length,p=y.length===n.length;0<n.length&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(a=0;a<i.length;a++){var b=i[a];this.vertices.push(n[b.a],n[b.b],n[b.c]);var m=b.vertexNormals;3===m.length?this.normals.push(m[0],m[1],m[2]):(g=b.normal,this.normals.push(g,g,g));var w,g=b.vertexColors;3===g.length?this.colors.push(g[0],g[1],g[2]):(g=b.color,this.colors.push(g,g,g)),!0===r&&(void 0!==(w=e[0][a])?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",a),this.uvs.push(new Gi,new Gi,new Gi))),!0===s&&(void 0!==(w=e[1][a])?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",a),this.uvs2.push(new Gi,new Gi,new Gi)));for(var M=0;M<u;M++){var k=o[M].vertices;h[M].data.push(k[b.a],k[b.b],k[b.c])}for(M=0;M<f;M++){var R=c[M].vertexNormals[a];l[M].data.push(R.a,R.b,R.c)}d&&this.skinIndices.push(v[b.a],v[b.b],v[b.c]),p&&this.skinWeights.push(y[b.a],y[b.b],y[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var En=1,On=new Jt,Sn=new mi,Tn=new Gt,An=new Zi,jn=new Zi,xn=new Gt;function Cn(){Object.defineProperty(this,"id",{value:En+=2}),this.uuid=g.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function In(t,i,n,e){Cn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:i,widthSegments:n,heightSegments:e};for(var r=(t=t||1)/2,s=(i=i||1)/2,o=Math.floor(n)||1,u=Math.floor(e)||1,h=o+1,a=u+1,c=t/o,f=i/u,l=[],v=[],y=[],d=[],p=0;p<a;p++)for(var b=p*f-s,m=0;m<h;m++)v.push(m*c-r,-b,0),y.push(0,0,1),d.push(m/o),d.push(1-p/u);for(p=0;p<u;p++)for(m=0;m<o;m++){var w=m+h*(p+1),g=m+1+h*(p+1),M=m+1+h*p;l.push(m+h*p,w,M),l.push(w,g,M)}this.setIndex(l),this.setAttribute("position",new wn(v,3)),this.setAttribute("normal",new wn(y,3)),this.setAttribute("uv",new wn(d,2))}Cn.prototype=Object.assign(Object.create($t.prototype),{constructor:Cn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<function(t){if(0===t.length)return-1/0;for(var i=t[0],n=1,e=t.length;n<e;++n)t[n]>i&&(i=t[n]);return i}(t)?mn:pn)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,n){this.groups.push({start:t,count:i,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&(i=(new ri).getNormalMatrix(t),n.applyNormalMatrix(i),n.needsUpdate=!0);n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return On.makeRotationX(t),this.applyMatrix4(On),this},rotateY:function(t){return On.makeRotationY(t),this.applyMatrix4(On),this},rotateZ:function(t){return On.makeRotationZ(t),this.applyMatrix4(On),this},translate:function(t,i,n){return On.makeTranslation(t,i,n),this.applyMatrix4(On),this},scale:function(t,i,n){return On.makeScale(t,i,n),this.applyMatrix4(On),this},lookAt:function(t){return Sn.lookAt(t),Sn.updateMatrix(),this.applyMatrix4(Sn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Tn).negate(),this.translate(Tn.x,Tn.y,Tn.z),this},setFromObject:function(t){var i,n,e=t.geometry;return t.isPoints||t.isLine?(i=new wn(3*e.vertices.length,3),n=new wn(3*e.colors.length,3),this.setAttribute("position",i.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(n=new wn(e.lineDistances.length,1),this.setAttribute("lineDistance",n.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())):t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e),this},setFromPoints:function(t){for(var i=[],n=0,e=t.length;n<e;n++){var r=t[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new wn(i,3)),this},updateFromObject:function(t){var i,n=t.geometry;if(t.isMesh){var e=n.Ee;if(!0===n.elementsNeedUpdate&&(e=void 0,n.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(n);e.verticesNeedUpdate=n.verticesNeedUpdate,e.normalsNeedUpdate=n.normalsNeedUpdate,e.colorsNeedUpdate=n.colorsNeedUpdate,e.uvsNeedUpdate=n.uvsNeedUpdate,e.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=e}return!0===n.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(n.vertices),i.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(n.normals),i.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(n.colors),i.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(n.uvs),i.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(n.lineDistances),i.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.Ee=(new Rn).fromGeometry(t),this.fromDirectGeometry(t.Ee)},fromDirectGeometry:function(t){var i,n,e,r,s=new Float32Array(3*t.vertices.length);for(e in this.setAttribute("position",new fn(s,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(i=new Float32Array(3*t.normals.length),this.setAttribute("normal",new fn(i,3).copyVector3sArray(t.normals))),0<t.colors.length&&(i=new Float32Array(3*t.colors.length),this.setAttribute("color",new fn(i,3).copyColorsArray(t.colors))),0<t.uvs.length&&(n=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new fn(n,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(n=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new fn(n,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var o=[],u=t.morphTargets[e],h=0,a=u.length;h<a;h++){var c=u[h],f=new wn(3*c.data.length,3);f.name=c.name,o.push(f.copyVector3sArray(c.data))}this.morphAttributes[e]=o}return 0<t.skinIndices.length&&(r=new wn(4*t.skinIndices.length,4),this.setAttribute("skinIndex",r.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(r=new wn(4*t.skinWeights.length,4),this.setAttribute("skinWeight",r.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Zi);var t=this.attributes.position,i=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var n=0,e=i.length;n<e;n++){var r=i[n];An.setFromBufferAttribute(r),this.morphTargetsRelative?(xn.addVectors(this.boundingBox.min,An.min),this.boundingBox.expandByPoint(xn),xn.addVectors(this.boundingBox.max,An.max),this.boundingBox.expandByPoint(xn)):(this.boundingBox.expandByPoint(An.min),this.boundingBox.expandByPoint(An.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new kn);var t=this.attributes.position,i=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(An.setFromBufferAttribute(t),i)for(var e=0,r=i.length;e<r;e++){var s=i[e];jn.setFromBufferAttribute(s),this.morphTargetsRelative?(xn.addVectors(An.min,jn.min),An.expandByPoint(xn),xn.addVectors(An.max,jn.max),An.expandByPoint(xn)):(An.expandByPoint(jn.min),An.expandByPoint(jn.max))}An.getCenter(n);for(var o=0,e=0,r=t.count;e<r;e++)xn.fromBufferAttribute(t,e),o=Math.max(o,n.distanceToSquared(xn));if(i)for(e=0,r=i.length;e<r;e++)for(var s=i[e],u=this.morphTargetsRelative,h=0,a=s.count;h<a;h++)xn.fromBufferAttribute(s,h),u&&(Tn.fromBufferAttribute(t,h),xn.add(Tn)),o=Math.max(o,n.distanceToSquared(xn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes;if(i.position){var n=i.position.array;if(void 0===i.normal)this.setAttribute("normal",new fn(new Float32Array(n.length),3));else for(var e=i.normal.array,r=0,s=e.length;r<s;r++)e[r]=0;var o,u,h,a=i.normal.array,c=new Gt,f=new Gt,l=new Gt,v=new Gt,y=new Gt;if(t)for(var d=t.array,r=0,s=t.count;r<s;r+=3)o=3*d[r+0],u=3*d[r+1],h=3*d[r+2],c.fromArray(n,o),f.fromArray(n,u),l.fromArray(n,h),v.subVectors(l,f),y.subVectors(c,f),v.cross(y),a[o]+=v.x,a[1+o]+=v.y,a[2+o]+=v.z,a[u]+=v.x,a[1+u]+=v.y,a[2+u]+=v.z,a[h]+=v.x,a[1+h]+=v.y,a[2+h]+=v.z;else for(r=0,s=n.length;r<s;r+=9)c.fromArray(n,r),f.fromArray(n,r+3),l.fromArray(n,r+6),v.subVectors(l,f),y.subVectors(c,f),v.cross(y),a[r]=v.x,a[r+1]=v.y,a[r+2]=v.z,a[r+3]=v.x,a[r+4]=v.y,a[r+5]=v.z,a[r+6]=v.x,a[r+7]=v.y,a[r+8]=v.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)xn.x=t.getX(i),xn.y=t.getY(i),xn.z=t.getZ(i),xn.normalize(),t.setXYZ(i,xn.x,xn.y,xn.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(In.prototype=Object.create(Cn.prototype)).constructor=In;var Ln=0;function Pn(){Object.defineProperty(this,"id",{value:Ln++}),this.uuid=g.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=qi,this.side=Yi,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Wi,this.blendDst=Ki,this.blendEquation=Qi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ji,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=un,this.stencilZFail=un,this.stencilZPass=un,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function _n(t){Pn.call(this),this.type="MeshBasicMaterial",this.color=new Ri(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$i,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Pn.prototype=Object.assign(Object.create($t.prototype),{constructor:Pn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var i in t){var n,e=t[i];void 0!==e?"shading"!==i?void 0!==(n=this[i])?n&&n.isColor?n.set(e):n&&n.isVector3&&e&&e.isVector3?n.copy(e):this[i]=e:console.warn("THREE."+this.type+": '"+i+"' is not a property of this material."):(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e):console.warn("THREE.Material: '"+i+"' parameter is undefined.")}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var i=t.clippingPlanes,n=null;if(null!==i)for(var e=i.length,n=new Array(e),r=0;r!==e;++r)n[r]=i[r].clone();return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Pn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((_n.prototype=Object.create(Pn.prototype)).constructor=_n).prototype.isMeshBasicMaterial=!0,_n.prototype.copy=function(t){return Pn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var Bn=0;function Fn(t,i,n,e,r,s,o,u,h,a){Object.defineProperty(this,"id",{value:Bn++}),this.uuid=g.generateUUID(),this.name="",this.image=void 0!==t?t:Fn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==i?i:Fn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:tn,this.wrapT=void 0!==e?e:tn,this.magFilter=void 0!==r?r:nn,this.minFilter=void 0!==s?s:en,this.anisotropy=void 0!==h?h:1,this.format=void 0!==o?o:sn,this.internalFormat=null,this.type=void 0!==u?u:rn,this.offset=new Gi(0,0),this.repeat=new Gi(1,1),this.center=new Gi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ri,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==a?a:on,this.version=0,this.onUpdate=null}function Nn(t,i,n,e,r,s,o,u,h){Fn.call(this,t,i,n,e,r,s,o,u,h),this.needsUpdate=!0}Fn.DEFAULT_IMAGE=void 0,Fn.DEFAULT_MAPPING=300,Fn.prototype=Object.assign(Object.create($t.prototype),{constructor:Fn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case tn:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case tn:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Fn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((Nn.prototype=Object.create(Fn.prototype)).constructor=Nn).prototype.isCanvasTexture=!0;var Dn=new Gt,Vn=new Gt,Zn=new ri;function zn(t,i){this.normal=void 0!==t?t:new Gt(1,0,0),this.constant=void 0!==i?i:0}Object.assign(zn.prototype,{isPlane:!0,set:function(t,i){return this.normal.copy(t),this.constant=i,this},setComponents:function(t,i,n,e){return this.normal.set(t,i,n),this.constant=e,this},setFromNormalAndCoplanarPoint:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},setFromCoplanarPoints:function(t,i,n){i=Dn.subVectors(n,i).cross(Vn.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,i){return void 0===i&&(console.warn("THREE.Plane: .projectPoint() target is now required"),i=new Gt),i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,i){void 0===i&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new Gt);var n=t.delta(Dn),e=this.normal.dot(n);if(0===e)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;e=-(t.start.dot(this.normal)+this.constant)/e;return e<0||1<e?void 0:i.copy(n).multiplyScalar(e).add(t.start)},intersectsLine:function(t){var i=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return i<0&&0<t||t<0&&0<i},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Gt),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,i){i=i||Zn.getNormalMatrix(t),t=this.coplanarPoint(Dn).applyMatrix4(t),i=this.normal.applyMatrix3(i).normalize();return this.constant=-t.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Un=new Gt,Gn=new Gt,Yn=new Gt,Hn=new Gt,Xn=new Gt,qn=new Gt,Qn=new Gt;function Wn(t,i){this.origin=void 0!==t?t:new Gt,this.direction=void 0!==i?i:new Gt(0,0,-1)}Object.assign(Wn.prototype,{set:function(t,i){return this.origin.copy(t),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,i){return void 0===i&&(console.warn("THREE.Ray: .at() target is now required"),i=new Gt),i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Un)),this},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=new Gt),i.subVectors(t,this.origin);t=i.dot(this.direction);return t<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var i=Un.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(Un.copy(this.direction).multiplyScalar(i).add(this.origin),Un.distanceToSquared(t))},distanceSqToSegment:function(t,i,n,e){Gn.copy(t).add(i).multiplyScalar(.5),Yn.copy(i).sub(t).normalize(),Hn.copy(this.origin).sub(Gn);var r,s,o=.5*t.distanceTo(i),u=-this.direction.dot(Yn),h=Hn.dot(this.direction),a=-Hn.dot(Yn),c=Hn.lengthSq(),t=Math.abs(1-u*u);return c=0<t?(s=u*h-a,i=o*t,0<=(r=u*a-h)?-i<=s?s<=i?(r*=t=1/t)*(r+u*(s*=t)+2*h)+s*(u*r+s+2*a)+c:(s=o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c):(s=-o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c):s<=-i?-(r=Math.max(0,-(-u*o+h)))*r+(s=0<r?-o:Math.min(Math.max(-o,-a),o))*(s+2*a)+c:s<=i?(r=0,(s=Math.min(Math.max(-o,-a),o))*(s+2*a)+c):-(r=Math.max(0,-(u*o+h)))*r+(s=0<r?o:Math.min(Math.max(-o,-a),o))*(s+2*a)+c):(s=0<u?-o:o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c),n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),e&&e.copy(Yn).multiplyScalar(s).add(Gn),c},intersectSphere:function(t,i){Un.subVectors(t.center,this.origin);var n=Un.dot(this.direction),e=Un.dot(Un)-n*n,t=t.radius*t.radius;if(t<e)return null;t=Math.sqrt(t-e),e=n-t,t=n+t;return e<0&&t<0?null:e<0?this.at(t,i):this.at(e,i)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var i=t.normal.dot(this.direction);if(0===i)return 0===t.distanceToPoint(this.origin)?0:null;i=-(this.origin.dot(t.normal)+t.constant)/i;return 0<=i?i:null},intersectPlane:function(t,i){t=this.distanceToPlane(t);return null===t?null:this.at(t,i)},intersectsPlane:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},intersectBox:function(t,i){var n,e,r,s=1/this.direction.x,o=1/this.direction.y,u=1/this.direction.z,h=this.origin,s=0<=s?(n=(t.min.x-h.x)*s,(t.max.x-h.x)*s):(n=(t.max.x-h.x)*s,(t.min.x-h.x)*s),o=0<=o?(e=(t.min.y-h.y)*o,(t.max.y-h.y)*o):(e=(t.max.y-h.y)*o,(t.min.y-h.y)*o);return o<n||s<e?null:((o<s||s!=s)&&(s=o),(u=0<=u?(r=(t.min.z-h.z)*u,(t.max.z-h.z)*u):(r=(t.max.z-h.z)*u,(t.min.z-h.z)*u))<(n=n<e||n!=n?e:n)||s<r?null:((n<r||n!=n)&&(n=r),(s=u<s||s!=s?u:s)<0?null:this.at(0<=n?n:s,i)))},intersectsBox:function(t){return null!==this.intersectBox(t,Un)},intersectTriangle:function(t,i,n,e,r){Xn.subVectors(i,t),qn.subVectors(n,t),Qn.crossVectors(Xn,qn);n=this.direction.dot(Qn);if(0<n){if(e)return null;s=1}else{if(!(n<0))return null;s=-1,n=-n}Hn.subVectors(this.origin,t);e=s*this.direction.dot(qn.crossVectors(Hn,qn));if(e<0)return null;t=s*this.direction.dot(Xn.cross(Hn));if(t<0)return null;if(n<e+t)return null;var s=-s*Hn.dot(Qn);return s<0?null:this.at(s/n,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var Kn=new Gt,Jn=new Gt,$n=new Gt,te=new Gt,ie=new Gt,ne=new Gt,ee=new Gt,re=new Gt,se=new Gt,oe=new Gt;function ue(t,i,n){this.a=void 0!==t?t:new Gt,this.b=void 0!==i?i:new Gt,this.c=void 0!==n?n:new Gt}function he(t,i,n,e,r,s){this.a=t,this.b=i,this.c=n,this.normal=e&&e.isVector3?e:new Gt,this.vertexNormals=Array.isArray(e)?e:[],this.color=r&&r.isColor?r:new Ri,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==s?s:0}Object.assign(ue,{getNormal:function(t,i,n,e){void 0===e&&(console.warn("THREE.Triangle: .getNormal() target is now required"),e=new Gt),e.subVectors(n,i),Kn.subVectors(t,i),e.cross(Kn);i=e.lengthSq();return 0<i?e.multiplyScalar(1/Math.sqrt(i)):e.set(0,0,0)},getBarycoord:function(t,i,n,e,r){Kn.subVectors(e,i),Jn.subVectors(n,i),$n.subVectors(t,i);var s=Kn.dot(Kn),o=Kn.dot(Jn),e=Kn.dot($n),n=Jn.dot(Jn),t=Jn.dot($n),i=s*n-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Gt),0==i)return r.set(-2,-1,-1);i=1/i,n=(n*e-o*t)*i,i*=s*t-o*e;return r.set(1-n-i,i,n)},containsPoint:function(t,i,n,e){return ue.getBarycoord(t,i,n,e,te),0<=te.x&&0<=te.y&&te.x+te.y<=1},getUV:function(t,i,n,e,r,s,o,u){return this.getBarycoord(t,i,n,e,te),u.set(0,0),u.addScaledVector(r,te.x),u.addScaledVector(s,te.y),u.addScaledVector(o,te.z),u},isFrontFacing:function(t,i,n,e){return Kn.subVectors(n,i),Jn.subVectors(t,i),Kn.cross(Jn).dot(e)<0}}),Object.assign(ue.prototype,{set:function(t,i,n){return this.a.copy(t),this.b.copy(i),this.c.copy(n),this},setFromPointsAndIndices:function(t,i,n,e){return this.a.copy(t[i]),this.b.copy(t[n]),this.c.copy(t[e]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Kn.subVectors(this.c,this.b),Jn.subVectors(this.a,this.b),.5*Kn.cross(Jn).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Gt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return ue.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new zn),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,i){return ue.getBarycoord(t,this.a,this.b,this.c,i)},getUV:function(t,i,n,e,r){return ue.getUV(t,this.a,this.b,this.c,i,n,e,r)},containsPoint:function(t){return ue.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return ue.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),i=new Gt);var n=this.a,e=this.b,r=this.c;ie.subVectors(e,n),ne.subVectors(r,n),re.subVectors(t,n);var s=ie.dot(re),o=ne.dot(re);if(s<=0&&o<=0)return i.copy(n);se.subVectors(t,e);var u=ie.dot(se),h=ne.dot(se);if(0<=u&&h<=u)return i.copy(e);var a=s*h-u*o;if(a<=0&&0<=s&&u<=0)return f=s/(s-u),i.copy(n).addScaledVector(ie,f);oe.subVectors(t,r);var c=ie.dot(oe),t=ne.dot(oe);if(0<=t&&c<=t)return i.copy(r);s=c*o-s*t;if(s<=0&&0<=o&&t<=0)return l=o/(o-t),i.copy(n).addScaledVector(ne,l);o=u*t-c*h;if(o<=0&&0<=h-u&&0<=c-t)return ee.subVectors(r,e),l=(h-u)/(h-u+(c-t)),i.copy(e).addScaledVector(ee,l);var o=1/(o+s+a),f=s*o,l=a*o;return i.copy(n).addScaledVector(ie,f).addScaledVector(ne,l)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Object.assign(he.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var i=0,n=t.vertexNormals.length;i<n;i++)this.vertexNormals[i]=t.vertexNormals[i].clone();for(i=0,n=t.vertexColors.length;i<n;i++)this.vertexColors[i]=t.vertexColors[i].clone();return this}});var ae=new Jt,ce=new Wn,fe=new kn,le=new Gt,ve=new Gt,ye=new Gt,de=new Gt,pe=new Gt,be=new Gt,me=new Gt,we=new Gt,ge=new Gt,Me=new Gi,ke=new Gi,Re=new Gi,Ee=new Gt,Oe=new Gt;function Se(t,i){mi.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Cn,this.material=void 0!==i?i:new _n,this.updateMorphTargets()}function Te(t,i,n,e,r,s,o,u){i=i.side===Hi?e.intersectTriangle(o,s,r,!0,u):e.intersectTriangle(r,s,o,i.side!==Xi,u);if(null===i)return null;Oe.copy(u),Oe.applyMatrix4(t.matrixWorld);u=n.ray.origin.distanceTo(Oe);return u<n.near||u>n.far?null:{distance:u,point:Oe.clone(),object:t}}function Ae(t,i,n,e,r,s,o,u,h,a,c,f){le.fromBufferAttribute(r,a),ve.fromBufferAttribute(r,c),ye.fromBufferAttribute(r,f);var l=t.morphTargetInfluences;if(i.morphTargets&&s&&l){me.set(0,0,0),we.set(0,0,0),ge.set(0,0,0);for(var v=0,y=s.length;v<y;v++){var d=l[v],p=s[v];0!==d&&(de.fromBufferAttribute(p,a),pe.fromBufferAttribute(p,c),be.fromBufferAttribute(p,f),o?(me.addScaledVector(de,d),we.addScaledVector(pe,d),ge.addScaledVector(be,d)):(me.addScaledVector(de.sub(le),d),we.addScaledVector(pe.sub(ve),d),ge.addScaledVector(be.sub(ye),d)))}le.add(me),ve.add(we),ye.add(ge)}e=Te(t,i,n,e,le,ve,ye,Ee);return e&&(u&&(Me.fromBufferAttribute(u,a),ke.fromBufferAttribute(u,c),Re.fromBufferAttribute(u,f),e.uv=ue.getUV(Ee,le,ve,ye,Me,ke,Re,new Gi)),h&&(Me.fromBufferAttribute(h,a),ke.fromBufferAttribute(h,c),Re.fromBufferAttribute(h,f),e.uv2=ue.getUV(Ee,le,ve,ye,Me,ke,Re,new Gi)),h=new he(a,c,f),ue.getNormal(le,ve,ye,h.normal),e.face=h),e}function je(t,i,n,e){this.ray=new Wn(t,i),this.near=n||0,this.far=e||1/0,this.camera=null,this.layers=new ei,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function xe(t,i){return t.distance-i.distance}function Ce(t,i,n,e){if(t.layers.test(i.layers)&&t.raycast(i,n),!0===e)for(var r=t.children,s=0,o=r.length;s<o;s++)Ce(r[s],i,n,!0)}Se.prototype=Object.assign(Object.create(mi.prototype),{constructor:Se,isMesh:!0,copy:function(t){return mi.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,i,n,e=this.geometry;if(e.isBufferGeometry){var r=e.morphAttributes,s=Object.keys(r);if(0<s.length){var o=r[s[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,i=o.length;t<i;t++)n=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,i){var n=this.geometry,e=this.material,r=this.matrixWorld;if(void 0!==e&&(null===n.boundingSphere&&n.computeBoundingSphere(),fe.copy(n.boundingSphere),fe.applyMatrix4(r),!1!==t.ray.intersectsSphere(fe)&&(ae.getInverse(r),ce.copy(t.ray).applyMatrix4(ae),null===n.boundingBox||!1!==ce.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var s,o,u,h,a,c,f,l,v,y=n.index,d=n.attributes.position,p=n.morphAttributes.position,b=n.morphTargetsRelative,m=n.attributes.uv,w=n.attributes.uv2,g=n.groups,M=n.drawRange;if(null!==y)if(Array.isArray(e))for(h=0,c=g.length;h<c;h++)for(v=e[(l=g[h]).materialIndex],a=Math.max(l.start,M.start),f=Math.min(l.start+l.count,M.start+M.count);a<f;a+=3)s=y.getX(a),o=y.getX(a+1),u=y.getX(a+2),(C=Ae(this,v,t,ce,d,p,b,m,w,s,o,u))&&(C.faceIndex=Math.floor(a/3),C.face.materialIndex=l.materialIndex,i.push(C));else for(h=Math.max(0,M.start),c=Math.min(y.count,M.start+M.count);h<c;h+=3)s=y.getX(h),o=y.getX(h+1),u=y.getX(h+2),(C=Ae(this,e,t,ce,d,p,b,m,w,s,o,u))&&(C.faceIndex=Math.floor(h/3),i.push(C));else if(void 0!==d)if(Array.isArray(e))for(h=0,c=g.length;h<c;h++)for(v=e[(l=g[h]).materialIndex],a=Math.max(l.start,M.start),f=Math.min(l.start+l.count,M.start+M.count);a<f;a+=3)(C=Ae(this,v,t,ce,d,p,b,m,w,s=a,o=a+1,u=a+2))&&(C.faceIndex=Math.floor(a/3),C.face.materialIndex=l.materialIndex,i.push(C));else for(h=Math.max(0,M.start),c=Math.min(d.count,M.start+M.count);h<c;h+=3)(C=Ae(this,e,t,ce,d,p,b,m,w,s=h,o=h+1,u=h+2))&&(C.faceIndex=Math.floor(h/3),i.push(C))}else if(n.isGeometry){var k,R=Array.isArray(e),E=n.vertices,O=n.faces,n=n.faceVertexUvs[0];0<n.length&&(k=n);for(var S=0,T=O.length;S<T;S++){var A,j,x,C,I=O[S],L=R?e[I.materialIndex]:e;void 0!==L&&(A=E[I.a],j=E[I.b],x=E[I.c],(C=Te(this,L,t,ce,A,j,x,Ee))&&(k&&k[S]&&(L=k[S],Me.copy(L[0]),ke.copy(L[1]),Re.copy(L[2]),C.uv=ue.getUV(Ee,A,j,x,Me,ke,Re,new Gi)),C.face=I,C.faceIndex=S,i.push(C)))}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(je.prototype,{set:function(t,i){this.ray.set(t,i)},setFromCamera:function(t,i){i&&i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i&&i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i,n){n=n||[];return Ce(t,this,n,i),n.sort(xe),n},intersectObjects:function(t,i,n){var e=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var r=0,s=t.length;r<s;r++)Ce(t[r],this,e,i);return e.sort(xe),e}});var Ie={AMAP_SATELLITE:1,AMAP_VECTOR:2,BAIDU_VECTOR:4,BAIDU_SATELLITE:8,TD_VECTOR:16,TD_SATELLITE:32,OSM:64},z={FOV:35,CAMERA_NEAR:1,CAMERA_FAR:1e5,ZOOM_UPPER_BOUND:30,TILT_UPPER_BOUND:90,THOUSAND:1e3,DEG2RAD:.0174532,RAD2DEG:57.2957795,DRAW_TIME:500,EPS:.001};Object.freeze(z);var Le=z;function Pe(){mi.call(this),this.type="Group"}function _e(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}Pe.prototype=Object.assign(Object.create(mi.prototype),{constructor:Pe,isGroup:!0});var Be=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.disposed=!1}var i,n,e;return i=t,(n=[{key:"dispose",value:function(){this.disposed||(this.disposed=!0,this.disposeInternal())}},{key:"disposeInternal",value:function(){}}])&&_e(i.prototype,n),e&&_e(i,e),t}();function Fe(t,i){return i<t?1:t<i?-1:0}function Ne(t,i,n){var e,r=t.length;if(t[0]<=i)return 0;if(i<=t[r-1])return r-1;if(0<n){for(e=1;e<r;++e)if(t[e]<i)return e-1}else if(n<0){for(e=1;e<r;++e)if(t[e]<=i)return e}else for(e=1;e<r;++e){if(t[e]==i)return e;if(t[e]<i)return"function"==typeof n?0<n(i,t[e-1],t[e])?e-1:e:t[e-1]-i<i-t[e]?e-1:e}return r-1}function De(t,i){for(var n=Array.isArray(i)?i:[i],e=n.length,r=0;r<e;r++)t[t.length]=n[r]}function Ve(t,i){var n=t.length;if(n===i.length){for(var e=0;e<n;e++)if(t[e]!==i[e])return;return 1}}function Ze(){return!0}function ze(){}function Ue(){return function(){throw new Error("Unimplemented abstract method.")}()}var Ge=0;function Ye(t){return t.ol_uid||(t.ol_uid=String(++Ge))}var He="latest",n="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",Xe=(n.indexOf("firefox"),-1!==n.indexOf("safari")&&n.indexOf("chrom"),-1!==n.indexOf("webkit")&&n.indexOf("edge"),n.indexOf("macintosh"),"undefined"!=typeof devicePixelRatio?devicePixelRatio:1),qe="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,Qe="undefined"!=typeof Image&&Image.prototype.decode;!function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch(t){}}();function We(t){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ke(n){var e=tr();return function(){var t,i=nr(n);return t=e?(t=nr(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==We(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Je(t){var e="function"==typeof Map?new Map:void 0;return(Je=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return $e(t,arguments,nr(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ir(n,t)})(t)}function $e(t,i,n){return($e=tr()?Reflect.construct:function(t,i,n){var e=[null];e.push.apply(e,i);e=new(Function.bind.apply(t,e));return n&&ir(e,n.prototype),e}).apply(null,arguments)}function tr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function ir(t,i){return(ir=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function nr(t){return(nr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var er=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ir(t,i)}(r,Je(Error));var e=Ke(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i,n="Assertion failed. See https://openlayers.org/en/"+("latest"===He?He:"v"+He.split("-")[0])+"/doc/errors/#"+t+" for details.";return(i=e.call(this,n)).code=t,i.name="AssertionError",i.message=n,i}return r}();function rr(t,i){if(!t)throw new er(i)}new Array(6);function sr(){return[1,0,0,1,0,0]}function or(t,i){var n=i[0],e=i[1];return i[0]=t[0]*n+t[2]*e+t[4],i[1]=t[1]*n+t[3]*e+t[5],i}function ur(t,i,n,e,r,s,o,u){var h=Math.sin(s),s=Math.cos(s);return t[0]=e*s,t[1]=r*h,t[2]=-e*h,t[3]=r*s,t[4]=o*e*s-u*e*h+i,t[5]=o*r*h+u*r*s+n,t}function hr(t,i){var n=(u=i)[0]*u[3]-u[1]*u[2];rr(0!=n,32);var e=i[0],r=i[1],s=i[2],o=i[3],u=i[4],i=i[5];return t[0]=o/n,t[1]=-r/n,t[2]=-s/n,t[3]=e/n,t[4]=(s*i-o*u)/n,t[5]=-(e*i-r*u)/n,t}var ar={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},cr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function fr(t,i,n){i=i<t[0]?t[0]-i:t[2]<i?i-t[2]:0,t=n<t[1]?t[1]-n:t[3]<n?n-t[3]:0;return i*i+t*t}function lr(t,i){return vr(t,i[0],i[1])}function vr(t,i,n){return t[0]<=i&&i<=t[2]&&t[1]<=n&&n<=t[3]}function yr(t,i){var n=t[0],e=t[1],r=t[2],s=t[3],o=i[0],t=i[1],i=cr.UNKNOWN;return o<n?i|=cr.LEFT:r<o&&(i|=cr.RIGHT),t<e?i|=cr.BELOW:s<t&&(i|=cr.ABOVE),i=i===cr.UNKNOWN?cr.INTERSECTING:i}function dr(){return[1/0,1/0,-1/0,-1/0]}function pr(t,i,n,e,r){return r?(r[0]=t,r[1]=i,r[2]=n,r[3]=e,r):[t,i,n,e]}function br(t){return pr(1/0,1/0,-1/0,-1/0,t)}function mr(t,i){return t[0]==i[0]&&t[2]==i[2]&&t[1]==i[1]&&t[3]==i[3]}function wr(t,i,n,e,r){for(;n<e;n+=r)s=t,o=i[n],u=i[n+1],s[0]=Math.min(s[0],o),s[1]=Math.min(s[1],u),s[2]=Math.max(s[2],o),s[3]=Math.max(s[3],u);var s,o,u;return t}function gr(t){return[t[0],t[1]]}function Mr(t){return[t[2],t[1]]}function kr(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Rr(t,i,n,e,r){var s=i*e[0]/2,o=i*e[1]/2,u=Math.cos(n),h=Math.sin(n),a=s*u,c=s*h,i=o*u,e=o*h,n=t[0],s=t[1],u=n-a+e,o=n-a-e,h=n+a-e,t=n+a+e,n=s-c-i,a=s-c+i,e=s+c+i,i=s+c-i;return pr(Math.min(u,o,h,t),Math.min(n,a,e,i),Math.max(u,o,h,t),Math.max(n,a,e,i),r)}function Er(t){return t[3]-t[1]}function Or(t,i,n){n=n||dr();return jr(t,i)?(t[0]>i[0]?n[0]=t[0]:n[0]=i[0],t[1]>i[1]?n[1]=t[1]:n[1]=i[1],t[2]<i[2]?n[2]=t[2]:n[2]=i[2],t[3]<i[3]?n[3]=t[3]:n[3]=i[3]):br(n),n}function Sr(t){return[t[0],t[3]]}function Tr(t){return[t[2],t[3]]}function Ar(t){return t[2]-t[0]}function jr(t,i){return t[0]<=i[2]&&t[2]>=i[0]&&t[1]<=i[3]&&t[3]>=i[1]}function xr(t){return t[2]<t[0]||t[3]<t[1]}function Cr(t,i,n,e){var r=[];if(1<e)for(var s=t[2]-t[0],o=t[3]-t[1],u=0;u<e;++u)r.push(t[0]+s*u/e,t[1],t[2],t[1]+o*u/e,t[2]-s*u/e,t[3],t[0],t[3]-o*u/e);else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];i(r,r,2);for(var h,a=[],c=[],f=0,l=r.length;f<l;f+=2)a.push(r[f]),c.push(r[f+1]);return h=a,i=c,n=n,pr(Math.min.apply(null,h),Math.min.apply(null,i),Math.max.apply(null,h),Math.max.apply(null,i),n)}function Ir(t,i,n){return Math.min(Math.max(t,i),n)}var Lr="cosh"in Math?Math.cosh:function(t){t=Math.exp(t);return(t+1/t)/2};"log2"in Math&&Math.log2;function Pr(t,i,n,e){t=n-t,i=e-i;return t*t+i*i}function _r(t){return t*Math.PI/180}function Br(t,i){t%=i;return t*i<0?t+i:t}function Fr(t,i){i=Math.pow(10,i);return Math.round(t*i)/i}function Nr(t,i){return Math.floor(Fr(t,i))}function Dr(t,i){return Math.ceil(Fr(t,i))}var Vr=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Zr=/^([a-z]*)$|^hsla?\(.*\)$/i;function zr(t){return"string"==typeof t?t:function(t){var i=t[0];i!=(0|i)&&(i=i+.5|0);var n=t[1];n!=(0|n)&&(n=n+.5|0);var e=t[2];e!=(0|e)&&(e=e+.5|0);t=void 0===t[3]?1:Math.round(100*t[3])/100;return"rgba("+i+","+n+","+e+","+t+")"}(t)}function Ur(t){var i=document.createElement("div");if(i.style.color=t,""===i.style.color)return"";document.body.appendChild(i);t=getComputedStyle(i).color;return document.body.removeChild(i),t}var Gr,Yr,Hr=(Gr={},Yr=0,function(t){var i;if(Gr.hasOwnProperty(t))i=Gr[t];else{if(1024<=Yr){var n,e=0;for(n in Gr)0==(3&e++)&&(delete Gr[n],--Yr)}i=function(t){var i,n,e,r;Zr.exec(t)&&(t=Ur(t));{var s,o;Vr.exec(t)?(s=t.length-1,r=s<=4?1:2,o=4==s||8==s,i=parseInt(t.substr(1+0*r,r),16),n=parseInt(t.substr(+r+1,r),16),e=parseInt(t.substr(1+2*r,r),16),s=o?parseInt(t.substr(1+3*r,r),16):255,1==r&&(i=(i<<4)+i,n=(n<<4)+n,e=(e<<4)+e,o&&(s=(s<<4)+s)),s=[i,n,e,s/255]):0==t.indexOf("rgba(")?qr(s=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((s=t.slice(4,-1).split(",").map(Number)).push(1),qr(s)):rr(!1,14)}return s}(t),Gr[t]=i,++Yr}return i});function Xr(t){return Array.isArray(t)?t:Hr(t)}function qr(t){return t[0]=Ir(t[0]+.5|0,0,255),t[1]=Ir(t[1]+.5|0,0,255),t[2]=Ir(t[2]+.5|0,0,255),t[3]=Ir(t[3],0,1),t}function Qr(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}e=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}var i,n,e;return i=t,(n=[{key:"clear",value:function(){this.cache_={},this.cacheSize_=0}},{key:"canExpireCache",value:function(){return this.cacheSize_>this.maxCacheSize_}},{key:"expire",value:function(){if(this.canExpireCache()){var t,i=0;for(t in this.cache_){var n=this.cache_[t];0!=(3&i++)||n.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}}},{key:"get",value:function(t,i,n){n=Wr(t,i,n);return n in this.cache_?this.cache_[n]:null}},{key:"set",value:function(t,i,n,e){n=Wr(t,i,n);this.cache_[n]=e,++this.cacheSize_}},{key:"setSize",value:function(t){this.maxCacheSize_=t,this.expire()}}])&&Qr(i.prototype,n),e&&Qr(i,e),t}();function Wr(t,i,n){return i+":"+t+":"+(n?zr(n):"null")}var Kr=new e;function Jr(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var $r=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}var t,n,e;return t=i,(n=[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}])&&Jr(t.prototype,n),e&&Jr(t,e),i}(),ts="propertychange",is="function"==typeof Object.assign?Object.assign:function(t,i){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),e=1,r=arguments.length;e<r;++e){var s=arguments[e];if(null!=s)for(var o in s)s.hasOwnProperty(o)&&(n[o]=s[o])}return n};function ns(t){for(var i in t)delete t[i]}"function"==typeof Object.values&&Object.values;function es(t){for(var i in t)return;return!i}function rs(t){return(rs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ss(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function os(t,i){return(os=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function us(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=hs(n);return t=e?(t=hs(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==rs(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function hs(t){return(hs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var as=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&os(t,i)}(r,Be);var t,i,n,e=us(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).eventTarget_=t,i.pendingRemovals_=null,i.dispatching_=null,i.listeners_=null,i}return t=r,(i=[{key:"addEventListener",value:function(t,i){var n;t&&i&&(-1===(t=(n=this.listeners_||(this.listeners_={}))[t]||(n[t]=[])).indexOf(i)&&t.push(i))}},{key:"dispatchEvent",value:function(t){var i="string"==typeof t,n=i?t:t.type,e=this.listeners_&&this.listeners_[n];if(e){var r=i?new $r(t):t;r.target||(r.target=this.eventTarget_||this);var s,i=this.dispatching_||(this.dispatching_={}),t=this.pendingRemovals_||(this.pendingRemovals_={});n in i||(i[n]=0,t[n]=0),++i[n];for(var o=0,u=e.length;o<u;++o)if(!1===(s="handleEvent"in e[o]?e[o].handleEvent(r):e[o].call(this,r))||r.propagationStopped){s=!1;break}if(0==--i[n]){var h=t[n];for(delete t[n];h--;)this.removeEventListener(n,ze);delete i[n]}return s}}},{key:"disposeInternal",value:function(){this.listeners_&&ns(this.listeners_)}},{key:"getListeners",value:function(t){return this.listeners_&&this.listeners_[t]||void 0}},{key:"hasListener",value:function(t){return!!this.listeners_&&(t?t in this.listeners_:0<Object.keys(this.listeners_).length)}},{key:"removeEventListener",value:function(t,i){var n=this.listeners_&&this.listeners_[t];!n||-1!==(i=n.indexOf(i))&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=ze,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t]))}}])&&ss(t.prototype,i),n&&ss(t,n),r}(),cs="change",fs="error",ls="load",vs="resize";function ys(t,i,n,e,r){var s;e&&e!==t&&(n=n.bind(e)),r&&(s=n,n=function(){t.removeEventListener(i,n),s.apply(this,arguments)});r={target:t,type:i,listener:n};return t.addEventListener(i,n),r}function ds(t,i,n,e){return ys(t,i,n,e,!0)}function ps(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),ns(t))}function bs(t){return(bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ms(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ws(t,i){return(ws=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function gs(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ms(n);return t=e?(t=Ms(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==bs(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ms(t){return(Ms=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}z=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ws(t,i)}(r,as);var t,i,n,e=gs(r);function r(){var t;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this)).on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return t=r,(i=[{key:"changed",value:function(){++this.revision_,this.dispatchEvent(cs)}},{key:"getRevision",value:function(){return this.revision_}},{key:"onInternal",value:function(t,i){if(Array.isArray(t)){for(var n=t.length,e=new Array(n),r=0;r<n;++r)e[r]=ys(this,t[r],i);return e}return ys(this,t,i)}},{key:"onceInternal",value:function(t,i){if(Array.isArray(t))for(var n=t.length,e=new Array(n),r=0;r<n;++r)e[r]=ds(this,t[r],i);else e=ds(this,t,i);return i.ol_key=e}},{key:"unInternal",value:function(t,i){var n=i.ol_key;if(n)!function(t){if(Array.isArray(t))for(var i=0,n=t.length;i<n;++i)ps(t[i]);else ps(t)}(n);else if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)this.removeEventListener(t[e],i);else this.removeEventListener(t,i)}}])&&ms(t.prototype,i),n&&ms(t,n),r}();z.prototype.on,z.prototype.once,z.prototype.un;var ks=z;function Rs(t){return(Rs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Es(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Os(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Ss(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ts(t,i)}function Ts(t,i){return(Ts=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function As(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=xs(n);return t=e?(t=xs(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Rs(t)&&"function"!=typeof t?js(i):t}}function js(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xs(t){return(xs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Cs=function(){Ss(r,$r);var e=As(r);function r(t,i,n){return Os(this,r),(t=e.call(this,t)).key=i,t.oldValue=n,t}return r}(),Is=function(){Ss(r,ks);var t,i,n,e=As(r);function r(t){var i;return Os(this,r),(i=e.call(this)).on,i.once,i.un,Ye(js(i)),i.values_=null,void 0!==t&&i.setProperties(t),i}return t=r,(i=[{key:"get",value:function(t){var i;return i=this.values_&&this.values_.hasOwnProperty(t)?this.values_[t]:i}},{key:"getKeys",value:function(){return this.values_&&Object.keys(this.values_)||[]}},{key:"getProperties",value:function(){return this.values_&&is({},this.values_)||{}}},{key:"hasProperties",value:function(){return!!this.values_}},{key:"notify",value:function(t,i){var n="change:".concat(t);this.hasListener(n)&&this.dispatchEvent(new Cs(n,t,i)),this.hasListener(n=ts)&&this.dispatchEvent(new Cs(n,t,i))}},{key:"addChangeListener",value:function(t,i){this.addEventListener("change:".concat(t),i)}},{key:"removeChangeListener",value:function(t,i){this.removeEventListener("change:".concat(t),i)}},{key:"set",value:function(t,i,n){var e=this.values_||(this.values_={});n?e[t]=i:(n=e[t])!==(e[t]=i)&&this.notify(t,n)}},{key:"setProperties",value:function(t,i){for(var n in t)this.set(n,t[n],i)}},{key:"applyProperties",value:function(t){t.values_&&is(this.values_||(this.values_={}),t.values_)}},{key:"unset",value:function(t,i){var n;this.values_&&t in this.values_&&(n=this.values_[t],delete this.values_[t],es(this.values_)&&(this.values_=null),i||this.notify(t,n))}}])&&Es(t.prototype,i),n&&Es(t,n),r}(),Ls={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Ps(t){return(Ps="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _s(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Bs(t,i,n){return(Bs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Ds(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Fs(t,i){return(Fs=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ns(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ds(n);return t=e?(t=Ds(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ps(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ds(t){return(Ds=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vs=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Fs(t,i)}(r,Is);var t,i,n,e=Ns(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).on,i.once,i.un,i.background_=t.background;var n=is({},t);return"object"===Ps(t.properties)&&(delete n.properties,is(n,t.properties)),n[Ls.OPACITY]=void 0!==t.opacity?t.opacity:1,rr("number"==typeof n[Ls.OPACITY],64),n[Ls.VISIBLE]=void 0===t.visible||t.visible,n[Ls.Z_INDEX]=t.zIndex,n[Ls.MAX_RESOLUTION]=void 0!==t.maxResolution?t.maxResolution:1/0,n[Ls.MIN_RESOLUTION]=void 0!==t.minResolution?t.minResolution:0,n[Ls.MIN_ZOOM]=void 0!==t.minZoom?t.minZoom:-1/0,n[Ls.MAX_ZOOM]=void 0!==t.maxZoom?t.maxZoom:1/0,i.className_=void 0!==n.className?n.className:"ol-layer",delete n.className,i.setProperties(n),i.state_=null,i}return t=r,(i=[{key:"getBackground",value:function(){return this.background_}},{key:"getClassName",value:function(){return this.className_}},{key:"getLayerState",value:function(t){var i=this.state_||{layer:this,managed:void 0===t||t},t=this.getZIndex();return i.opacity=Ir(Math.round(100*this.getOpacity())/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=void 0!==t||i.managed?t:1/0,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i}},{key:"getLayersArray",value:Ue},{key:"getLayerStatesArray",value:function(t){return Ue()}},{key:"getExtent",value:function(){return this.get(Ls.EXTENT)}},{key:"getMaxResolution",value:function(){return this.get(Ls.MAX_RESOLUTION)}},{key:"getMinResolution",value:function(){return this.get(Ls.MIN_RESOLUTION)}},{key:"getMinZoom",value:function(){return this.get(Ls.MIN_ZOOM)}},{key:"getMaxZoom",value:function(){return this.get(Ls.MAX_ZOOM)}},{key:"getOpacity",value:function(){return this.get(Ls.OPACITY)}},{key:"getSourceState",value:function(){return Ue()}},{key:"getVisible",value:function(){return this.get(Ls.VISIBLE)}},{key:"getZIndex",value:function(){return this.get(Ls.Z_INDEX)}},{key:"setBackground",value:function(t){this.background_=t,this.changed()}},{key:"setExtent",value:function(t){this.set(Ls.EXTENT,t)}},{key:"setMaxResolution",value:function(t){this.set(Ls.MAX_RESOLUTION,t)}},{key:"setMinResolution",value:function(t){this.set(Ls.MIN_RESOLUTION,t)}},{key:"setMaxZoom",value:function(t){this.set(Ls.MAX_ZOOM,t)}},{key:"setMinZoom",value:function(t){this.set(Ls.MIN_ZOOM,t)}},{key:"setOpacity",value:function(t){rr("number"==typeof t,64),this.set(Ls.OPACITY,t)}},{key:"setVisible",value:function(t){this.set(Ls.VISIBLE,t)}},{key:"setZIndex",value:function(t){this.set(Ls.Z_INDEX,t)}},{key:"disposeInternal",value:function(){this.state_&&(this.state_.layer=null,this.state_=null),Bs(Ds(r.prototype),"disposeInternal",this).call(this)}}])&&_s(t.prototype,i),n&&_s(t,n),r}(),Zs="prerender",zs="postrender",Us="precompose",Gs="rendercomplete",Ys={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};function Hs(t){return(Hs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xs(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function qs(t,i,n){return(qs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Ks(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Qs(t,i){return(Qs=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ws(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ks(n);return t=e?(t=Ks(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Hs(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ks(t){return(Ks=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Js(t,i){if(t.visible){var n=i.resolution;if(!(n<t.minResolution||n>=t.maxResolution)){i=i.zoom;return i>t.minZoom&&i<=t.maxZoom}}}var $s=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Qs(t,i)}(r,Vs);var t,i,n,e=Ws(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=is({},t);delete i.source,(i=e.call(this,i)).on,i.once,i.un,i.mapPrecomposeKey_=null,i.mapRenderKey_=null,i.sourceChangeKey_=null,i.renderer_=null,i.rendered=!1,t.render&&(i.render=t.render),t.map&&i.setMap(t.map),i.addChangeListener(Ls.SOURCE,i.handleSourcePropertyChange_);t=t.source||null;return i.setSource(t),i}return t=r,(i=[{key:"getLayersArray",value:function(t){t=t||[];return t.push(this),t}},{key:"getLayerStatesArray",value:function(t){t=t||[];return t.push(this.getLayerState()),t}},{key:"getSource",value:function(){return this.get(Ls.SOURCE)||null}},{key:"getRenderSource",value:function(){return this.getSource()}},{key:"getSourceState",value:function(){var t=this.getSource();return t?t.getState():Ys.UNDEFINED}},{key:"handleSourceChange_",value:function(){this.changed()}},{key:"handleSourcePropertyChange_",value:function(){this.sourceChangeKey_&&(ps(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=ys(t,cs,this.handleSourceChange_,this)),this.changed()}},{key:"getFeatures",value:function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(t){return t([])})}},{key:"getData",value:function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}},{key:"render",value:function(t,i){var n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,i)}},{key:"unrender",value:function(){this.rendered=!1}},{key:"setMapInternal",value:function(t){t||this.unrender(),this.set(Ls.MAP,t)}},{key:"getMapInternal",value:function(){return this.get(Ls.MAP)}},{key:"setMap",value:function(t){this.mapPrecomposeKey_&&(ps(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ps(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ys(t,Us,function(t){var t=t.frameState.layerStatesArray,i=this.getLayerState(!1);rr(!t.some(function(t){return t.layer===i.layer}),67),t.push(i)},this),this.mapRenderKey_=ys(this,cs,t.render,t),this.changed())}},{key:"setSource",value:function(t){this.set(Ls.SOURCE,t)}},{key:"getRenderer",value:function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}},{key:"hasRenderer",value:function(){return!!this.renderer_}},{key:"createRenderer",value:function(){return null}},{key:"disposeInternal",value:function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),qs(Ks(r.prototype),"disposeInternal",this).call(this)}}])&&Xs(t.prototype,i),n&&Xs(t,n),r}();function to(t,i){for(var n=!0,e=t.length-1;0<=e;--e)if(t[e]!=i[e]){n=!1;break}return n}function io(t,i,n){var e=i.getExtent(),r=0;return i.canWrapX()&&(t[0]<e[0]||t[0]>e[2])&&(n=n||Ar(e),r=Math.floor((t[0]-e[0])/n)),r}function no(t){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ro(t,i){return(ro=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function so(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=oo(n);return t=e?(t=oo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==no(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function oo(t){return(oo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uo(t,i){Kr.expire()}var ho=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ro(t,i)}(r,Be);var t,i,n,e=so(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).map_=t,i}return t=r,(i=[{key:"dispatchRenderEvent",value:function(t,i){Ue()}},{key:"calculateMatrices2D",value:function(t){var i=t.viewState,n=t.coordinateToPixelTransform,e=t.pixelToCoordinateTransform;ur(n,t.size[0]/2,t.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),hr(e,n)}},{key:"forEachFeatureAtCoordinate",value:function(t,i,n,e,r,s,o,u){var h,a=i.viewState;function c(t,i,n,e){return r.call(s,i,t?n:null,e)}var f,l,v,y=a.projection,d=(f=t.slice(),(l=y).canWrapX()&&(v=Ar(l.getExtent()),(l=io(f,l,v))&&(f[0]-=l*v)),f),p=[[0,0]];y.canWrapX()&&e&&(y=Ar(y.getExtent()),p.push([-y,0],[y,0]));for(var b=i.layerStatesArray,m=b.length,w=[],g=[],M=0;M<p.length;M++)for(var k=m-1;0<=k;--k){var R=b[k],E=R.layer;if(E.hasRenderer()&&Js(R,a)&&o.call(u,E)){var O=E.getRenderer(),E=E.getSource();if(O&&E&&(E=E.getWrapX()?d:t,R=c.bind(null,R.managed),g[0]=E[0]+p[M][0],g[1]=E[1]+p[M][1],h=O.forEachFeatureAtCoordinate(g,i,n,R,w)),h)return h}}if(0!==w.length){var S=1/w.length;return w.forEach(function(t,i){return t.distanceSq+=i*S}),w.sort(function(t,i){return t.distanceSq-i.distanceSq}),w.some(function(t){return h=t.callback(t.feature,t.layer,t.geometry)}),h}}},{key:"forEachLayerAtPixel",value:function(t,i,n,e,r){return Ue()}},{key:"hasFeatureAtCoordinate",value:function(t,i,n,e,r,s){return void 0!==this.forEachFeatureAtCoordinate(t,i,n,e,Ze,this,r,s)}},{key:"getMap",value:function(){return this.map_}},{key:"renderFrame",value:function(t){Ue()}},{key:"scheduleExpireIconCache",value:function(t){Kr.canExpireCache()&&t.postRenderFunctions.push(uo)}}])&&eo(t.prototype,i),n&&eo(t,n),r}();function ao(t){return(ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function co(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function fo(t,i,n){return(fo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=yo(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function lo(t,i){return(lo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function vo(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=yo(n);return t=e?(t=yo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ao(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function yo(t){return(yo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var po=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&lo(t,i)}(r,ho);var t,i,n,e=vo(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).children_=[],t.renderedVisible_=!0,t}return t=r,(i=[{key:"disposeInternal",value:function(){fo(yo(r.prototype),"disposeInternal",this).call(this)}},{key:"renderFrame",value:function(t){this.calculateMatrices2D(t);for(var i=t.layerStatesArray.sort(function(t,i){return t.zIndex-i.zIndex}),n=t.viewState,e=[],r=null,s=this.children_.length=0,o=i.length;s<o;++s){var u=i[s];t.layerIndex=s;var h=u.layer,a=h.getSourceState();!Js(u,n)||a!=Ys.READY&&a!=Ys.UNDEFINED?h.unrender():(a=h.render(t,r))&&(a!==r&&(this.children_.push(a),r=a),"getDeclutter"in h&&e.push(h))}for(var c=e.length-1;0<=c;--c)e[c].renderDeclutter(t);this.scheduleExpireIconCache(t)}}])&&co(t.prototype,i),n&&co(t,n),r}(),bo="add",mo="remove";function wo(t){return(wo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function go(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Mo(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function ko(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ro(t,i)}function Ro(t,i){return(Ro=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Eo(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Oo(n);return t=e?(t=Oo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==wo(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Oo(t){return(Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var So="length",To=function(){ko(r,$r);var e=Eo(r);function r(t,i,n){return Mo(this,r),(t=e.call(this,t)).element=i,t.index=n,t}return r}(),Ao=function(){ko(o,Is);var t,i,n,s=Eo(o);function o(t,i){var n;if(Mo(this,o),(n=s.call(this)).on,n.once,n.un,n.unique_=!!(i||{}).unique,n.array_=t||[],n.unique_)for(var e=0,r=n.array_.length;e<r;++e)n.assertUnique_(n.array_[e],e);return n.updateLength_(),n}return t=o,(i=[{key:"clear",value:function(){for(;0<this.getLength();)this.pop()}},{key:"extend",value:function(t){for(var i=0,n=t.length;i<n;++i)this.push(t[i]);return this}},{key:"forEach",value:function(t){for(var i=this.array_,n=0,e=i.length;n<e;++n)t(i[n],n,i)}},{key:"getArray",value:function(){return this.array_}},{key:"item",value:function(t){return this.array_[t]}},{key:"getLength",value:function(){return this.get(So)}},{key:"insertAt",value:function(t,i){this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new To(bo,i,t))}},{key:"pop",value:function(){return this.removeAt(this.getLength()-1)}},{key:"push",value:function(t){this.unique_&&this.assertUnique_(t);var i=this.getLength();return this.insertAt(i,t),this.getLength()}},{key:"remove",value:function(t){for(var i=this.array_,n=0,e=i.length;n<e;++n)if(i[n]===t)return this.removeAt(n)}},{key:"removeAt",value:function(t){var i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new To(mo,i,t)),i}},{key:"setAt",value:function(t,i){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(i,t);var e=this.array_[t];this.array_[t]=i,this.dispatchEvent(new To(mo,e,t)),this.dispatchEvent(new To(bo,i,t))}else{for(var r=n;r<t;++r)this.insertAt(r,void 0);this.insertAt(t,i)}}},{key:"updateLength_",value:function(){this.set(So,this.array_.length)}},{key:"assertUnique_",value:function(t,i){for(var n=0,e=this.array_.length;n<e;++n)if(this.array_[n]===t&&n!==i)throw new er(58)}}])&&go(t.prototype,i),n&&go(t,n),o}();function jo(t){return(jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Co(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Io(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Lo(t,i)}function Lo(t,i){return(Lo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Po(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=_o(n);return t=e?(t=_o(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==jo(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function _o(t){return(_o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bo=function(){Io(e,$r);var n=Po(e);function e(t,i){return Co(this,e),(t=n.call(this,t)).layer=i,t}return e}(),Fo={LAYERS:"layers"},No=function(){Io(r,Vs);var t,i,n,e=Po(r);function r(t){Co(this,r);var i=t||{},t=is({},i);delete t.layers;i=i.layers;return(t=e.call(this,t)).on,t.once,t.un,t.layersListenerKeys_=[],t.listenerKeys_={},t.addChangeListener(Fo.LAYERS,t.handleLayersChanged_),i?Array.isArray(i)?i=new Ao(i.slice(),{unique:!0}):rr("function"==typeof i.getArray,43):i=new Ao(void 0,{unique:!0}),t.setLayers(i),t}return t=r,(i=[{key:"handleLayerChange_",value:function(){this.changed()}},{key:"handleLayersChanged_",value:function(){this.layersListenerKeys_.forEach(ps),this.layersListenerKeys_.length=0;var t,i=this.getLayers();for(t in this.layersListenerKeys_.push(ys(i,bo,this.handleLayersAdd_,this),ys(i,mo,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(ps);ns(this.listenerKeys_);for(var n=i.getArray(),e=0,r=n.length;e<r;e++){var s=n[e];this.registerLayerListeners_(s),this.dispatchEvent(new Bo("addlayer",s))}this.changed()}},{key:"registerLayerListeners_",value:function(t){var i=[ys(t,ts,this.handleLayerChange_,this),ys(t,cs,this.handleLayerChange_,this)];t instanceof r&&i.push(ys(t,"addlayer",this.handleLayerGroupAdd_,this),ys(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Ye(t)]=i}},{key:"handleLayerGroupAdd_",value:function(t){this.dispatchEvent(new Bo("addlayer",t.layer))}},{key:"handleLayerGroupRemove_",value:function(t){this.dispatchEvent(new Bo("removelayer",t.layer))}},{key:"handleLayersAdd_",value:function(t){t=t.element;this.registerLayerListeners_(t),this.dispatchEvent(new Bo("addlayer",t)),this.changed()}},{key:"handleLayersRemove_",value:function(t){var i=t.element,t=Ye(i);this.listenerKeys_[t].forEach(ps),delete this.listenerKeys_[t],this.dispatchEvent(new Bo("removelayer",i)),this.changed()}},{key:"getLayers",value:function(){return this.get(Fo.LAYERS)}},{key:"setLayers",value:function(t){var i=this.getLayers();if(i)for(var n=i.getArray(),e=0,r=n.length;e<r;++e)this.dispatchEvent(new Bo("removelayer",n[e]));this.set(Fo.LAYERS,t)}},{key:"getLayersArray",value:function(t){var i=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(i)}),i}},{key:"getLayerStatesArray",value:function(t){var i=void 0!==t?t:[],n=i.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(i)});var e=this.getLayerState(),r=e.zIndex;t||void 0!==e.zIndex||(r=0);for(var s=n,o=i.length;s<o;s++){var u=i[s];u.opacity*=e.opacity,u.visible=u.visible&&e.visible,u.maxResolution=Math.min(u.maxResolution,e.maxResolution),u.minResolution=Math.max(u.minResolution,e.minResolution),u.minZoom=Math.max(u.minZoom,e.minZoom),u.maxZoom=Math.min(u.maxZoom,e.maxZoom),void 0!==e.extent&&(void 0!==u.extent?u.extent=Or(u.extent,e.extent):u.extent=e.extent),void 0===u.zIndex&&(u.zIndex=r)}return i}},{key:"getSourceState",value:function(){return Ys.READY}}])&&xo(t.prototype,i),n&&xo(t,n),r}();function Do(t){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vo(t,i){return(Vo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Zo(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=zo(n);return t=e?(t=zo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Do(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function zo(t){return(zo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Uo=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Vo(t,i)}(r,$r);var e=Zo(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).map=i,t.frameState=void 0!==n?n:null,t}return r}(),Go="postrender",Yo="movestart",Ho="moveend",Xo={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};function qo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Qo=function(){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),this.priorityFunction_=t,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}var t,i,e;return t=n,(i=[{key:"clear",value:function(){this.elements_.length=0,this.priorities_.length=0,ns(this.queuedElements_)}},{key:"dequeue",value:function(){var t=this.elements_,i=this.priorities_,n=t[0];1==t.length?(t.length=0,i.length=0):(t[0]=t.pop(),i[0]=i.pop(),this.siftUp_(0));i=this.keyFunction_(n);return delete this.queuedElements_[i],n}},{key:"enqueue",value:function(t){rr(!(this.keyFunction_(t)in this.queuedElements_),31);var i=this.priorityFunction_(t);return i!=1/0&&(this.elements_.push(t),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}},{key:"getCount",value:function(){return this.elements_.length}},{key:"getLeftChildIndex_",value:function(t){return 2*t+1}},{key:"getRightChildIndex_",value:function(t){return 2*t+2}},{key:"getParentIndex_",value:function(t){return t-1>>1}},{key:"heapify_",value:function(){for(var t=(this.elements_.length>>1)-1;0<=t;t--)this.siftUp_(t)}},{key:"isEmpty",value:function(){return 0===this.elements_.length}},{key:"isKeyQueued",value:function(t){return t in this.queuedElements_}},{key:"isQueued",value:function(t){return this.isKeyQueued(this.keyFunction_(t))}},{key:"siftUp_",value:function(t){for(var i=this.elements_,n=this.priorities_,e=i.length,r=i[t],s=n[t],o=t;t<e>>1;){var u=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<e&&n[h]<n[u]?h:u;i[t]=i[u],n[t]=n[u],t=u}i[t]=r,n[t]=s,this.siftDown_(o,t)}},{key:"siftDown_",value:function(t,i){for(var n=this.elements_,e=this.priorities_,r=n[i],s=e[i];t<i;){var o=this.getParentIndex_(i);if(!(e[o]>s))break;n[i]=n[o],e[i]=e[o],i=o}n[i]=r,e[i]=s}},{key:"reprioritize",value:function(){for(var t,i,n=this.priorityFunction_,e=this.elements_,r=this.priorities_,s=0,o=e.length,u=0;u<o;++u)(i=n(t=e[u]))==1/0?delete this.queuedElements_[this.keyFunction_(t)]:(r[s]=i,e[s++]=t);e.length=s,r.length=s,this.heapify_()}}])&&qo(t.prototype,i),e&&qo(t,e),n}(),Wo=0,Ko=1,Jo=2,$o=3,tu=4;function iu(t){return(iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nu(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function eu(t,i,n){return(eu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=uu(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function ru(t,i){return(ru=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function su(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=uu(n);return t=e?(t=uu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==iu(t)&&"function"!=typeof t?ou(i):t}}function ou(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uu(t){return(uu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var hu=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ru(t,i)}(r,Qo);var t,i,n,e=su(r);function r(i,t){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,function(t){return i.apply(null,t)},function(t){return t[0].getKey()})).boundHandleTileChange_=n.handleTileChange.bind(ou(n)),n.tileChangeCallback_=t,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return t=r,(i=[{key:"enqueue",value:function(t){var i=eu(uu(r.prototype),"enqueue",this).call(this,t);return i&&t[0].addEventListener(cs,this.boundHandleTileChange_),i}},{key:"getTilesLoading",value:function(){return this.tilesLoading_}},{key:"handleTileChange",value:function(t){var i=t.target,t=i.getState();t!==Jo&&t!==$o&&t!==tu||(i.removeEventListener(cs,this.boundHandleTileChange_),(i=i.getKey())in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_())}},{key:"loadMoreTiles",value:function(t,i){for(var n,e,r=0;this.tilesLoading_<t&&r<i&&0<this.getCount();)e=(n=this.dequeue()[0]).getKey(),n.getState()!==Wo||e in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[e]=!0,++this.tilesLoading_,++r,n.load())}}])&&nu(t.prototype,i),n&&nu(t,n),r}();n={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};var au={};au[n.RADIANS]=6370997/(2*Math.PI),au[n.DEGREES]=2*Math.PI*6370997/360,au[n.FEET]=.3048,au[n.METERS]=1,au[n.USFEET]=1200/3937;var cu=n,fu=0,lu=1,vu={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},yu=42,du=256;function pu(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var bu=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}var t,n,e;return t=i,(n=[{key:"canWrapX",value:function(){return this.canWrapX_}},{key:"getCode",value:function(){return this.code_}},{key:"getExtent",value:function(){return this.extent_}},{key:"getUnits",value:function(){return this.units_}},{key:"getMetersPerUnit",value:function(){return this.metersPerUnit_||au[this.units_]}},{key:"getWorldExtent",value:function(){return this.worldExtent_}},{key:"getAxisOrientation",value:function(){return this.axisOrientation_}},{key:"isGlobal",value:function(){return this.global_}},{key:"setGlobal",value:function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}},{key:"getDefaultTileGrid",value:function(){return this.defaultTileGrid_}},{key:"setDefaultTileGrid",value:function(t){this.defaultTileGrid_=t}},{key:"setExtent",value:function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}},{key:"setWorldExtent",value:function(t){this.worldExtent_=t}},{key:"setGetPointResolution",value:function(t){this.getPointResolutionFunc_=t}},{key:"getPointResolutionFunc",value:function(){return this.getPointResolutionFunc_}}])&&pu(t.prototype,n),e&&pu(t,e),i}();function mu(t){return(mu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wu(t,i){return(wu=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function gu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Mu(n);return t=e?(t=Mu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==mu(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Mu(t){return(Mu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ku=6378137,Ru=Math.PI*ku,Eu=[-Ru,-Ru,Ru,Ru],Ou=[-180,-85,180,85],Su=ku*Math.log(Math.tan(Math.PI/2)),e=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&wu(t,i)}(n,bu);var i=gu(n);function n(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),i.call(this,{code:t,units:cu.METERS,extent:Eu,global:!0,worldExtent:Ou,getPointResolution:function(t,i){return t/Lr(i[1]/ku)}})}return n}(),Tu=[new e("EPSG:3857"),new e("EPSG:102100"),new e("EPSG:102113"),new e("EPSG:900913"),new e("http://www.opengis.net/def/crs/EPSG/0/3857"),new e("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Au(t,i,n){var e=t.length,r=1<n?n:2,s=i;void 0===s&&(s=2<r?t.slice():new Array(e));for(var o=0;o<e;o+=r){s[o]=Ru*t[o]/180;var u=ku*Math.log(Math.tan(Math.PI*(+t[o+1]+90)/360));Su<u?u=Su:u<-Su&&(u=-Su),s[o+1]=u}return s}function ju(t,i,n){var e=t.length,r=1<n?n:2,s=i;void 0===s&&(s=2<r?t.slice():new Array(e));for(var o=0;o<e;o+=r)s[o]=180*t[o]/Ru,s[o+1]=360*Math.atan(Math.exp(t[o+1]/ku))/Math.PI-90;return s}function xu(t){return(xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cu(t,i){return(Cu=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Iu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Lu(n);return t=e?(t=Lu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==xu(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Lu(t){return(Lu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pu=[-180,-90,180,90],_u=6378137*Math.PI/180,z=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Cu(t,i)}(e,bu);var n=Iu(e);function e(t,i){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),n.call(this,{code:t,units:cu.DEGREES,extent:Pu,axisOrientation:i,global:!0,metersPerUnit:_u,worldExtent:Pu})}return e}(),Bu=[new z("CRS:84"),new z("EPSG:4326","neu"),new z("urn:ogc:def:crs:OGC:1.3:CRS84"),new z("urn:ogc:def:crs:OGC:2:84"),new z("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new z("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new z("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Fu={};var Nu={};function Du(t,i,n){t=t.getCode(),i=i.getCode();t in Nu||(Nu[t]={}),Nu[t][i]=n}var Vu={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var Zu=!0;function zu(t){Zu=!(void 0===t||t)}function Uu(t,i,n){var e;if(void 0!==i){for(var r=0,s=t.length;r<s;++r)i[r]=t[r];e=i}else e=t.slice();return e}function Gu(t,i,n){if(void 0!==i&&t!==i){for(var e=0,r=t.length;e<r;++e)i[e]=t[e];t=i}return t}function Yu(t){var i,n;i=t.getCode(),n=t,Fu[i]=n,Du(t,t,Uu)}function Hu(t){return"string"==typeof t?Fu[i=t]||Fu[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var i}function Xu(t){t.forEach(Yu),t.forEach(function(i){t.forEach(function(t){i!==t&&Du(i,t,Uu)})})}function qu(t,i){return t?"string"==typeof t?Hu(t):t:Hu(i)}function Qu(t,i){if(t===i)return!0;var n=t.getUnits()===i.getUnits();return(t.getCode()===i.getCode()||Wu(t,i)===Uu)&&n}function Wu(t,i){var n,t=t.getCode(),i=i.getCode();return(i=i,n=(t=t)in Nu&&i in Nu[t]?Nu[t][i]:n)||Gu}function Ku(t,i){return Wu(Hu(t),Hu(i))}function Ju(t,i,n){return Ku(i,n)(t,void 0,t.length)}function $u(t,i,n,e){return Cr(t,Ku(i,n),void 0,e)}var th,ih,nh,eh=null;function rh(t,i){return eh?Ju(t,i,eh):t}function sh(t,i){return eh?Ju(t,eh,i):(Zu&&!to(t,[0,0])&&-180<=t[0]&&t[0]<=180&&-90<=t[1]&&t[1]<=90&&(Zu=!1,console.warn("Call useGeographic() ol/proj once to work with [longitude, latitude] coordinates.")),t)}function oh(t,i){return eh?$u(t,eh,i):t}function uh(a,c,f){return function(t,i,n,e,r){if(t){if(!i&&!c)return t;var s=c?0:n[0]*i,o=c?0:n[1]*i,u=r?r[0]:0,h=r?r[1]:0,n=a[0]+s/2+u,r=a[2]-s/2+u,s=a[1]+o/2+h,u=a[3]-o/2+h;r<n&&(r=n=(r+n)/2),u<s&&(u=s=(u+s)/2);o=Ir(t[0],n,r),h=Ir(t[1],s,u);return e&&f&&i&&(o+=-(i=30*i)*Math.log(1+Math.max(0,n-t[0])/i)+i*Math.log(1+Math.max(0,t[0]-r)/i),h+=-i*Math.log(1+Math.max(0,s-t[1])/i)+i*Math.log(1+Math.max(0,t[1]-u)/i)),[o,h]}}}function hh(t){return t}function ah(h,a,c,f,l){return function(t,i,n,e){if(void 0!==t){o=f?(r=h,s=n,o=l,u=Ar(n=f)/s[0],s=Er(n)/s[1],o?Math.min(r,Math.max(u,s)):Math.min(r,Math.min(u,s))):h;return(void 0===c||c)&&e?(r=t,u=o,s=a,e=Math.min(r,u),e*=Math.log(1+50*Math.max(0,r/u-1))/50+1,s&&(e=Math.max(e,s),e/=Math.log(1+50*Math.max(0,s/r-1))/50+1),Ir(e,s/2,2*u)):Ir(t,a,o)}var r,s,o,u}}function ch(t){if(void 0!==t)return 0}function fh(t){if(void 0!==t)return t}function lh(t){return Math.pow(t,3)}function vh(t){return 1-lh(1-t)}function yh(t){return 3*t*t-2*t*t*t}function dh(t){return(dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ph(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function bh(t,i){return(bh=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function mh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=wh(n);return t=e?(t=wh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==dh(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function wh(t){return(wh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Xu(Tu),Xu(Bu),th=Tu,ih=Au,nh=ju,Bu.forEach(function(i){th.forEach(function(t){Du(i,t,ih),Du(t,i,nh)})});function gh(t,i){setTimeout(function(){t(i)},0)}function Mh(t,i,n,e,r){var s=Math.cos(-r),o=Math.sin(-r),r=t[0]*s-t[1]*o,t=t[1]*s+t[0]*o;return[(r+=(i[0]/2-n[0])*e)*s-(t+=(n[1]-i[1]/2)*e)*(o=-o),t*s+r*o]}var kh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&bh(t,i)}(r,Is);var t,i,n,e=mh(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).on,i.once,i.un;t=is({},t);return i.hints_=[0,0],i.animations_=[],i.updateAnimationKey_,i.projection_=qu(t.projection,"EPSG:3857"),i.viewportSize_=[100,100],i.targetCenter_=null,i.targetResolution_,i.targetRotation_,i.nextCenter_=null,i.nextResolution_,i.nextRotation_,i.cancelAnchor_=void 0,t.center&&(t.center=sh(t.center,i.projection_)),t.extent&&(t.extent=oh(t.extent,i.projection_)),t.projection&&zu(),i.applyOptions_(t),i}return t=r,(i=[{key:"applyOptions_",value:function(t){var i,n=is({},t);for(i in vu)delete n[i];this.setProperties(n,!0);var e=function(t){var i=void 0!==t.minZoom?t.minZoom:0,n=void 0!==t.maxZoom?t.maxZoom:28,e=void 0!==t.zoomFactor?t.zoomFactor:2,r=void 0!==t.multiWorld&&t.multiWorld,s=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,o=void 0!==t.showFullExtent&&t.showFullExtent,u=qu(t.projection,"EPSG:3857"),h=u.getExtent(),a=t.constrainOnlyCenter,c=t.extent;r||c||!u.isGlobal()||(a=!1,c=h);var f=(h?Math.max(Ar(h),Er(h)):360*au[cu.DEGREES]/u.getMetersPerUnit())/du/Math.pow(2,0),r=f/Math.pow(2,28);void 0!==(h=t.maxResolution)?i=0:h=f/Math.pow(e,i);void 0===(u=t.minResolution)&&(u=void 0!==t.maxZoom?void 0!==t.maxResolution?h/Math.pow(e,n):f/Math.pow(e,n):r);return n=i+Math.floor(Math.log(h/u)/Math.log(e)),u=h/Math.pow(e,n-i),{constraint:ah(h,u,s,!a&&c,o),maxResolution:h,minResolution:u,minZoom:i,zoomFactor:e}}(t);this.maxResolution_=e.maxResolution,this.minResolution_=e.minResolution,this.zoomFactor_=e.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=e.minZoom;var r=function(t){if(void 0!==t.extent){var i=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return uh(t.extent,t.constrainOnlyCenter,i)}i=qu(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&i.isGlobal()){i=i.getExtent().slice();return i[0]=-1/0,i[2]=1/0,uh(i,!1,!1)}return hh}(t),s=e.constraint,e=function(t){{if(void 0===t.enableRotation||t.enableRotation){t=t.constrainRotation;return void 0===t||!0===t?function(t){var n=t||_r(5);return function(t,i){return i?t:void 0!==t?Math.abs(t)<=n?0:t:void 0}}():!1!==t&&"number"==typeof t?function(t){var n=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/n+.5)*n:void 0}}(t):fh}return ch}}(t);this.constraints_={center:r,resolution:s,rotation:e},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}},{key:"padding",get:function(){return this.padding_},set:function(t){var i=this.padding_;this.padding_=t;var n,e=this.getCenter();e&&(n=t||[0,0,0,0],i=i||[0,0,0,0],t=this.getResolution(),this.setCenterInternal([e[0]+t/2*(n[3]-i[3]+i[1]-n[1]),e[1]-t/2*(n[0]-i[0]+i[2]-n[2])]))}},{key:"getUpdatedOptions_",value:function(t){var i=this.getProperties();return void 0!==i.resolution?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),is({},i,t)}},{key:"animate",value:function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var i=new Array(arguments.length),n=0;n<i.length;++n){var e=arguments[n];e.center&&((e=is({},e)).center=sh(e.center,this.getProjection())),e.anchor&&((e=is({},e)).anchor=sh(e.anchor,this.getProjection())),i[n]=e}this.animateInternal.apply(this,i)}},{key:"animateInternal",value:function(t){var i,n=arguments.length;1<n&&"function"==typeof arguments[n-1]&&(i=arguments[n-1],--n);for(var e=0;e<n&&!this.isDef();++e){var r=arguments[e];r.center&&this.setCenterInternal(r.center),void 0!==r.zoom?this.setZoom(r.zoom):r.resolution&&this.setResolution(r.resolution),void 0!==r.rotation&&this.setRotation(r.rotation)}if(e!==n){for(var s=Date.now(),o=this.targetCenter_.slice(),u=this.targetResolution_,h=this.targetRotation_,a=[];e<n;++e){var c=arguments[e],f={start:s,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||yh,callback:i};c.center&&(f.sourceCenter=o,f.targetCenter=c.center.slice(),o=f.targetCenter),void 0!==c.zoom?(f.sourceResolution=u,f.targetResolution=this.getResolutionForZoom(c.zoom),u=f.targetResolution):c.resolution&&(f.sourceResolution=u,f.targetResolution=c.resolution,u=f.targetResolution),void 0!==c.rotation&&(f.sourceRotation=h,c=Br(c.rotation-h+Math.PI,2*Math.PI)-Math.PI,f.targetRotation=h+c,h=f.targetRotation),!function(t){if(t.sourceCenter&&t.targetCenter&&!to(t.sourceCenter,t.targetCenter))return!1;return t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}(f)?s+=f.duration:f.complete=!0,a.push(f)}this.animations_.push(a),this.setHint(fu,1),this.updateAnimations_()}else i&&gh(i,!0)}},{key:"getAnimating",value:function(){return 0<this.hints_[fu]}},{key:"getInteracting",value:function(){return 0<this.hints_[lu]}},{key:"cancelAnimations",value:function(){var t;this.setHint(fu,-this.hints_[fu]);for(var i=0,n=this.animations_.length;i<n;++i){var e=this.animations_[i];if(e[0].callback&&gh(e[0].callback,!1),!t)for(var r=0,s=e.length;r<s;++r){var o=e[r];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}},{key:"updateAnimations_",value:function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),i=!1,n=this.animations_.length-1;0<=n;--n){for(var e,r=this.animations_[n],s=!0,o=0,u=r.length;o<u;++o){var h=r[o];if(!h.complete){var a=t-h.start,c=0<h.duration?a/h.duration:1;1<=c?(h.complete=!0,c=1):s=!1;var f,l,v,y=h.easing(c);if(h.sourceCenter&&(f=h.sourceCenter[0],l=h.sourceCenter[1],a=h.targetCenter[0],c=h.targetCenter[1],this.nextCenter_=h.targetCenter,this.targetCenter_=[f+y*(a-f),l+y*(c-l)]),h.sourceResolution&&h.targetResolution&&(v=1===y?h.targetResolution:h.sourceResolution+y*(h.targetResolution-h.sourceResolution),h.anchor&&(l=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(v,0,l,!0),this.targetCenter_=this.calculateCenterZoom(l,h.anchor)),this.nextResolution_=h.targetResolution,this.targetResolution_=v,this.applyTargetState_(!0)),void 0!==h.sourceRotation&&void 0!==h.targetRotation&&(v=1===y?Br(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+y*(h.targetRotation-h.sourceRotation),h.anchor&&(y=this.constraints_.rotation(v,!0),this.targetCenter_=this.calculateCenterRotate(y,h.anchor)),this.nextRotation_=h.targetRotation,this.targetRotation_=v),this.applyTargetState_(!0),i=!0,!h.complete)break}}s&&(this.animations_[n]=null,this.setHint(fu,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN,(e=r[0].callback)&&gh(e,!0))}this.animations_=this.animations_.filter(Boolean),i&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}}},{key:"calculateCenterRotate",value:function(t,i){var n,e,r,s=this.getCenterInternal();return void 0!==s&&(n=[s[0]-i[0],s[1]-i[1]],e=n,r=t-this.getRotation(),s=Math.cos(r),t=Math.sin(r),r=e[0]*s-e[1]*t,t=e[1]*s+e[0]*t,e[0]=r,e[1]=t,t=i,(i=n)[0]+=+t[0],i[1]+=+t[1]),n}},{key:"calculateCenterZoom",value:function(t,i){var n,e=this.getCenterInternal(),r=this.getResolution();return n=void 0!==e&&void 0!==r?[i[0]-t*(i[0]-e[0])/r,i[1]-t*(i[1]-e[1])/r]:n}},{key:"getViewportSize_",value:function(t){var i=this.viewportSize_;if(t){var n=i[0],e=i[1];return[Math.abs(n*Math.cos(t))+Math.abs(e*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(e*Math.cos(t))]}return i}},{key:"setViewportSize",value:function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}},{key:"getCenter",value:function(){var t=this.getCenterInternal();return t&&rh(t,this.getProjection())}},{key:"getCenterInternal",value:function(){return this.get(vu.CENTER)}},{key:"getConstraints",value:function(){return this.constraints_}},{key:"getConstrainResolution",value:function(){return this.get("constrainResolution")}},{key:"getHints",value:function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}},{key:"calculateExtent",value:function(t){var i=this.calculateExtentInternal(t);return t=i,i=this.getProjection(),eh?$u(t,i,eh):t}},{key:"calculateExtentInternal",value:function(t){var i=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();rr(n,1);var e=this.getResolution();rr(void 0!==e,2);t=this.getRotation();return rr(void 0!==t,3),Rr(n,e,t,i)}},{key:"getMaxResolution",value:function(){return this.maxResolution_}},{key:"getMinResolution",value:function(){return this.minResolution_}},{key:"getMaxZoom",value:function(){return this.getZoomForResolution(this.minResolution_)}},{key:"setMaxZoom",value:function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}},{key:"getMinZoom",value:function(){return this.getZoomForResolution(this.maxResolution_)}},{key:"setMinZoom",value:function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}},{key:"setConstrainResolution",value:function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}},{key:"getProjection",value:function(){return this.projection_}},{key:"getResolution",value:function(){return this.get(vu.RESOLUTION)}},{key:"getResolutions",value:function(){return this.resolutions_}},{key:"getResolutionForExtent",value:function(t,i){return this.getResolutionForExtentInternal(oh(t,this.getProjection()),i)}},{key:"getResolutionForExtentInternal",value:function(t,i){var n=i||this.getViewportSizeMinusPadding_(),i=Ar(t)/n[0],n=Er(t)/n[1];return Math.max(i,n)}},{key:"getResolutionForValueFunction",value:function(t){var i=t||2,n=this.getConstrainedResolution(this.maxResolution_),t=this.minResolution_,e=Math.log(n/t)/Math.log(i);return function(t){return n/Math.pow(i,t*e)}}},{key:"getRotation",value:function(){return this.get(vu.ROTATION)}},{key:"getValueForResolutionFunction",value:function(t){var i=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),t=this.minResolution_,e=Math.log(n/t)/i;return function(t){return Math.log(n/t)/i/e}}},{key:"getViewportSizeMinusPadding_",value:function(t){var i=this.getViewportSize_(t),t=this.padding_;return i=t?[i[0]-t[1]-t[3],i[1]-t[0]-t[2]]:i}},{key:"getState",value:function(){var t,i=this.getProjection(),n=this.getResolution(),e=this.getRotation(),r=this.getCenterInternal(),s=this.padding_;return s&&(t=this.getViewportSizeMinusPadding_(),r=Mh(r,this.getViewportSize_(),[t[0]/2+s[3],t[1]/2+s[0]],n,e)),{center:r.slice(0),projection:void 0!==i?i:null,resolution:n,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:e,zoom:this.getZoom()}}},{key:"getZoom",value:function(){var t,i=this.getResolution();return t=void 0!==i?this.getZoomForResolution(i):t}},{key:"getZoomForResolution",value:function(t){var i,n,e=this.minZoom_||0;return n=this.resolutions_?(n=Ne(this.resolutions_,t,1),i=this.resolutions_[e=n],n==this.resolutions_.length-1?2:i/this.resolutions_[n+1]):(i=this.maxResolution_,this.zoomFactor_),e+Math.log(i/t)/Math.log(n)}},{key:"getResolutionForZoom",value:function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var i=Ir(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,Ir(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}},{key:"fit",value:function(t,i){this.fitInternal(t,i)}},{key:"rotatedExtentForGeometry",value:function(t){for(var i=this.getRotation(),n=Math.cos(i),e=Math.sin(-i),r=t.getFlatCoordinates(),s=t.getStride(),o=1/0,u=1/0,h=-1/0,a=-1/0,c=0,f=r.length;c<f;c+=s)var l=r[c]*n-r[c+1]*e,v=r[c]*e+r[c+1]*n,o=Math.min(o,l),u=Math.min(u,v),h=Math.max(h,l),a=Math.max(a,v);return[o,u,h,a]}},{key:"fitInternal",value:function(t,i){var n=i||{},e=(e=n.size)||this.getViewportSizeMinusPadding_(),r=void 0!==n.padding?n.padding:[0,0,0,0],s=void 0!==n.nearest&&n.nearest,i=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.getResolutionForZoom(n.maxZoom):0,t=this.rotatedExtentForGeometry(t),e=this.getResolutionForExtentInternal(t,[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e=isNaN(e)?i:Math.max(e,i);e=this.getConstrainedResolution(e,s?0:1);i=this.getRotation(),s=Math.sin(i),i=Math.cos(i),t=kr(t);t[0]+=(r[1]-r[3])/2*e,t[1]+=(r[0]-r[2])/2*e;r=t[0]*i-t[1]*s,s=t[1]*i+t[0]*s,r=this.getConstrainedCenter([r,s],e),s=n.callback||ze;void 0!==n.duration?this.animateInternal({resolution:e,center:r,duration:n.duration,easing:n.easing},s):(this.targetResolution_=e,this.targetCenter_=r,this.applyTargetState_(!1,!0),gh(s,!0))}},{key:"centerOn",value:function(t,i,n){this.centerOnInternal(sh(t,this.getProjection()),i,n)}},{key:"centerOnInternal",value:function(t,i,n){this.setCenterInternal(Mh(t,i,n,this.getResolution(),this.getRotation()))}},{key:"calculateCenterShift",value:function(t,i,n,e){var r,s=this.padding_;return s&&t&&(r=Mh(t,e,[(r=this.getViewportSizeMinusPadding_(-n))[0]/2+s[3],r[1]/2+s[0]],i,n),r=[t[0]-r[0],t[1]-r[1]]),r}},{key:"isDef",value:function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}},{key:"adjustCenter",value:function(t){var i=rh(this.targetCenter_,this.getProjection());this.setCenter([i[0]+t[0],i[1]+t[1]])}},{key:"adjustCenterInternal",value:function(t){var i=this.targetCenter_;this.setCenterInternal([i[0]+t[0],i[1]+t[1]])}},{key:"adjustResolution",value:function(t,i){i=i&&sh(i,this.getProjection());this.adjustResolutionInternal(t,i)}},{key:"adjustResolutionInternal",value:function(t,i){var n=this.getAnimating()||this.getInteracting(),e=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,e,n);i&&(this.targetCenter_=this.calculateCenterZoom(n,i)),this.targetResolution_*=t,this.applyTargetState_()}},{key:"adjustZoom",value:function(t,i){this.adjustResolution(Math.pow(this.zoomFactor_,-t),i)}},{key:"adjustRotation",value:function(t,i){i=i&&sh(i,this.getProjection()),this.adjustRotationInternal(t,i)}},{key:"adjustRotationInternal",value:function(t,i){var n=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,n);i&&(this.targetCenter_=this.calculateCenterRotate(n,i)),this.targetRotation_+=t,this.applyTargetState_()}},{key:"setCenter",value:function(t){this.setCenterInternal(t&&sh(t,this.getProjection()))}},{key:"setCenterInternal",value:function(t){this.targetCenter_=t,this.applyTargetState_()}},{key:"setHint",value:function(t,i){return this.hints_[t]+=i,this.changed(),this.hints_[t]}},{key:"setResolution",value:function(t){this.targetResolution_=t,this.applyTargetState_()}},{key:"setRotation",value:function(t){this.targetRotation_=t,this.applyTargetState_()}},{key:"setZoom",value:function(t){this.setResolution(this.getResolutionForZoom(t))}},{key:"applyTargetState_",value:function(t,i){var n=this.getAnimating()||this.getInteracting()||i,e=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(e),i=this.constraints_.resolution(this.targetResolution_,0,r,n),r=this.constraints_.center(this.targetCenter_,i,r,n,this.calculateCenterShift(this.targetCenter_,i,e,r));this.get(vu.ROTATION)!==e&&this.set(vu.ROTATION,e),this.get(vu.RESOLUTION)!==i&&(this.set(vu.RESOLUTION,i),this.set("zoom",this.getZoom(),!0)),r&&this.get(vu.CENTER)&&to(this.get(vu.CENTER),r)||this.set(vu.CENTER,r),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}},{key:"resolveConstraints",value:function(t,i,n){var e=void 0!==t?t:200,r=i||0,t=this.constraints_.rotation(this.targetRotation_),i=this.getViewportSize_(t),r=this.constraints_.resolution(this.targetResolution_,r,i),i=this.constraints_.center(this.targetCenter_,r,i,!1,this.calculateCenterShift(this.targetCenter_,r,t,i));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=r,this.targetRotation_=t,this.targetCenter_=i,void this.applyTargetState_();n=n||(0===e?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===r&&this.getRotation()===t&&this.getCenterInternal()&&to(this.getCenterInternal(),i)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:t,center:i,resolution:r,duration:e,easing:vh,anchor:n}))}},{key:"beginInteraction",value:function(){this.resolveConstraints(0),this.setHint(lu,1)}},{key:"endInteraction",value:function(t,i,n){n=n&&sh(n,this.getProjection());this.endInteractionInternal(t,i,n)}},{key:"endInteractionInternal",value:function(t,i,n){this.setHint(lu,-1),this.resolveConstraints(t,i,n)}},{key:"getConstrainedCenter",value:function(t,i){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,i||this.getResolution(),n)}},{key:"getConstrainedZoom",value:function(t,i){t=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(t,i))}},{key:"getConstrainedResolution",value:function(t,i){var n=i||0,i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,i)}}])&&ph(t.prototype,i),n&&ph(t,n),r}();function Rh(t,i){return Array.isArray(t)?t:(void 0===i?i=[t,t]:(i[0]=t,i[1]=t),i)}function Eh(t){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Sh(t,i,n){return(Sh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=xh(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Th(t,i){return(Th=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ah(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=xh(n);return t=e?(t=xh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Eh(t)&&"function"!=typeof t?jh(i):t}}function jh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xh(t){return(xh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ch(t){t instanceof $s?t.setMapInternal(null):t instanceof No&&t.getLayers().forEach(Ch)}var Ih=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Th(t,i)}(u,Is);var t,i,n,o=Ah(u);function u(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(i=o.call(this)).on,i.once,i.size_=t.size,void 0===i.size_&&(i.size_=[2e3,2e3]),i.un;var n,e,r,e=(e={},r=(n=t).layers&&"function"==typeof n.layers.getLayers?n.layers:new No({layers:n.layers}),e[Xo.LAYERGROUP]=r,e[Xo.TARGET]=n.target,e[Xo.VIEW]=n.view instanceof kh?n.view:new kh,{values:e});i.renderComplete_,i.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,i.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Xe,i.postRenderTimeoutHandle_,i.animationDelayKey_,i.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(jh(i)),i.coordinateToPixelTransform_=sr(),i.pixelToCoordinateTransform_=sr(),i.frameIndex_=0,i.frameState_=null,i.previousExtent_=null,i.viewPropertyListenerKey_=null,i.viewChangeListenerKey_=null,i.layerGroupPropertyListenerKeys_=null,i.moveTolerance_=t.moveTolerance,i.targetChangeHandlerKeys_=null,i.overlayIdIndex_={},i.renderer_=null,i.postRenderFunctions_=[],i.tileQueue_=new hu(i.getTilePriority.bind(jh(i)),i.handleTileChange_.bind(jh(i))),i.addChangeListener(Xo.VIEW,i.handleViewChanged_),i.addChangeListener(Xo.TARGET,i.handleTargetChanged_),i.setProperties(e.values);var s=jh(i);return!t.view||t.view instanceof kh||t.view.then(function(t){s.setView(new kh(t))}),i}return t=u,(i=[{key:"createRenderer",value:function(){throw new Error("Use a map type that has a createRenderer method")}},{key:"addLayer",value:function(t){this.getLayerGroup().getLayers().push(t)}},{key:"handleLayerAdd_",value:function(t){!function t(i,n){if(i instanceof $s)i.setMapInternal(n);else if(i instanceof No)for(var e=i.getLayers().getArray(),r=0,s=e.length;r<s;++r)t(e[r],n)}(t.layer,this)}},{key:"addOverlay",value:function(t){this.getOverlays().push(t)}},{key:"addOverlayInternal_",value:function(t){var i=t.getId();void 0!==i&&(this.overlayIdIndex_[i.toString()]=t),t.setMap(this)}},{key:"disposeInternal",value:function(){this.setTarget(null),Sh(xh(u.prototype),"disposeInternal",this).call(this)}},{key:"getAllLayers",value:function(){var n=[];return function i(t){t.forEach(function(t){t instanceof No?i(t.getLayers()):n.push(t)})}(this.getLayers()),n}},{key:"getTarget",value:function(){return this.get(Xo.TARGET)}},{key:"getOverlays",value:function(){return this.overlays_}},{key:"getOverlayById",value:function(t){t=this.overlayIdIndex_[t.toString()];return void 0!==t?t:null}},{key:"getLayerGroup",value:function(){return this.get(Xo.LAYERGROUP)}},{key:"setLayers",value:function(t){var i=this.getLayerGroup();t instanceof Ao?i.setLayers(t):((i=i.getLayers()).clear(),i.extend(t))}},{key:"getLayers",value:function(){return this.getLayerGroup().getLayers()}},{key:"getLoadingOrNotReady",value:function(){for(var t=this.getLayerGroup().getLayerStatesArray(),i=0,n=t.length;i<n;++i){var e=t[i].layer;if(!e.getRenderer().ready)return!0;e=e.getSource();if(e&&e.loading)return!0}return!1}},{key:"getRenderer",value:function(){return this.renderer_}},{key:"getSize",value:function(){return this.size_}},{key:"getView",value:function(){return this.get(Xo.VIEW)}},{key:"getOverlayContainer",value:function(){return this.overlayContainer_}},{key:"getOverlayContainerStopEvent",value:function(){return this.overlayContainerStopEvent_}},{key:"getTilePriority",value:function(t,i,n,e){return r=this.frameState_,t=t,i=i,n=n,e=e,r&&i in r.wantedTiles&&r.wantedTiles[i][t.getKey()]?(t=r.viewState.center,r=n[0]-t[0],t=n[1]-t[1],65536*Math.log(e)+Math.sqrt(r*r+t*t)/e):1/0;var r}},{key:"handlePostRender",value:function(){var t,i,n,e=this.frameState_,r=this.tileQueue_;r.isEmpty()||(n=i=this.maxTilesLoading_,!e||((t=e.viewHints)[fu]||t[lu])&&(i=(t=8<Date.now()-e.time)?0:8,n=t?0:2),r.getTilesLoading()<i&&(r.reprioritize(),r.loadMoreTiles(i,n))),e&&this.hasListener(Gs)&&!e.animate&&this.renderComplete_&&this.renderer_.dispatchRenderEvent(Gs,e);for(var s=this.postRenderFunctions_,o=0,u=s.length;o<u;++o)s[o](this,e);s.length=0}},{key:"handleTargetChanged_",value:function(){this.renderer_||(this.renderer_=this.createRenderer()),this.targetChangeHandlerKeys_=[ys(document,vs,this.updateSize,this)],this.updateSize()}},{key:"handleTileChange_",value:function(){this.render()}},{key:"handleViewPropertyChanged_",value:function(){this.render()}},{key:"handleViewChanged_",value:function(){this.viewPropertyListenerKey_&&(ps(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ps(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=ys(t,ts,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ys(t,cs,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}},{key:"isRendered",value:function(){return!!this.frameState_}},{key:"render",value:function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}},{key:"removeLayer",value:function(t){return this.getLayerGroup().getLayers().remove(t)}},{key:"handleLayerRemove_",value:function(t){Ch(t.layer)}},{key:"removeOverlay",value:function(t){return this.getOverlays().remove(t)}},{key:"renderFrame_",value:function(t){var i,n=this,e=this.getSize(),r=this.getView(),s=this.frameState_,o=null;void 0!==e&&(0<(i=e)[0]&&0<i[1])&&r&&r.isDef()&&(i=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),r=r.getState(),o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Rr(r.center,r.resolution,r.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:i,wantedTiles:{},mapId:Ye(this),renderTargets:{}},r.nextCenter&&r.nextResolution&&(i=isNaN(r.nextRotation)?r.rotation:r.nextRotation,o.nextExtent=Rr(r.nextCenter,r.nextResolution,i,e))),this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),!s||this.previousExtent_&&(xr(this.previousExtent_)||mr(o.extent,this.previousExtent_))||(this.dispatchEvent(new Uo(Yo,this,s)),this.previousExtent_=br(this.previousExtent_)),!this.previousExtent_||o.viewHints[fu]||o.viewHints[lu]||mr(o.extent,this.previousExtent_)||(this.dispatchEvent(new Uo(Ho,this,o)),e=o.extent,(s=this.previousExtent_)?(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3]):e.slice())),this.dispatchEvent(new Uo(Go,this,o)),this.renderComplete_=!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){n.postRenderTimeoutHandle_=void 0,n.handlePostRender()},0))}},{key:"setSize",value:function(t){this.set(Xo.SIZE,t)}},{key:"setTarget",value:function(t){this.set(Xo.TARGET,t)}},{key:"setView",value:function(t){var i;!t||t instanceof kh?this.set(Xo.VIEW,t):(this.set(Xo.VIEW,new kh),i=this,t.then(function(t){i.setView(new kh(t))}))}},{key:"updateSize",value:function(){var t=this.size_;this.setSize(t),this.updateViewportSize_()}},{key:"updateViewportSize_",value:function(){var t,i=this.getView();i&&(t=this.size_,i.setViewportSize(t))}}])&&Oh(t.prototype,i),n&&Oh(t,n),u}();function Lh(t){return(Lh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ph(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _h(t,i){return(_h=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Bh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Fh(n);return t=e?(t=Fh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Lh(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Fh(t){return(Fh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Nh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&_h(t,i)}(r,Ih);var t,i,n,e=Bh(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t=is({},t),e.call(this,t)}return t=r,(i=[{key:"createRenderer",value:function(){return new po(this)}}])&&Ph(t.prototype,i),n&&Ph(t,n),r}();function Dh(t){return(Dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Zh(t,i){return(Zh=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function zh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Uh(n);return t=e?(t=Uh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Dh(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Uh(t){return(Uh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Zh(t,i)}(s,as);var t,i,n,r=zh(s);function s(t,i,n){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s);var e=n||{};return(n=r.call(this)).tileCoord=t,n.state=i,n.interimTile=null,n.key="",n.transition_=void 0===e.transition?250:e.transition,n.transitionStarts_={},n.interpolate=!!e.interpolate,n}return t=s,(i=[{key:"changed",value:function(){this.dispatchEvent(cs)}},{key:"release",value:function(){}},{key:"getKey",value:function(){return this.key+"/"+this.tileCoord}},{key:"getInterimTile",value:function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Jo)return this.transition_=0,t}while(t=t.interimTile);return this}},{key:"refreshInterimChain",value:function(){if(this.interimTile){var t=this.interimTile,i=this;do{if(t.getState()==Jo){t.interimTile=null;break}}while(t.getState()!=Ko&&t.getState()==Wo?i.interimTile=t.interimTile:i=t,t=i.interimTile)}}},{key:"getTileCoord",value:function(){return this.tileCoord}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(t){if(this.state!==$o&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}},{key:"load",value:function(){Ue()}},{key:"getAlpha",value:function(t,i){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(n){if(-1===n)return 1}else this.transitionStarts_[t]=n=i;n=i-n+1e3/60;return n>=this.transition_?1:lh(n/this.transition_)}},{key:"inTransition",value:function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}},{key:"endTransition",value:function(t){this.transition_&&(this.transitionStarts_[t]=-1)}}])&&Vh(t.prototype,i),n&&Vh(t,n),s}();var Yh={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Hh(t,i,n){var t=t,e=!0,r=!1,s=!1,o=[ds(t,ls,function(){s=!0,r||i()})];return t.src&&Qe?(r=!0,t.decode().then(function(){e&&i()}).catch(function(t){e&&(s?i:n)()})):o.push(ds(t,fs,n)),function(){e=!1,o.forEach(ps)}}function Xh(t){return(Xh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Qh(t,i){return(Qh=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Wh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Kh(n);return t=e?(t=Kh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Xh(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Kh(t){return(Kh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Qh(t,i)}(u,Gh);var t,i,n,o=Wh(u);function u(t,i,n,e,r,s){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(s=o.call(this,t,i,s)).crossOrigin_=e,s.src_=n,s.key=n,s.image_=new Image,null!==e&&(s.image_.crossOrigin=e),s.unlisten_=null,s.tileLoadFunction_=r,s}return t=u,(i=[{key:"getImage",value:function(){return this.image_}},{key:"setImage",value:function(t){this.image_=t,this.state=Jo,this.unlistenImage_(),this.changed()}},{key:"handleImageError_",value:function(){this.state=$o,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}},{key:"handleImageLoad_",value:function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Jo:this.state=tu,this.unlistenImage_(),this.changed()}},{key:"load",value:function(){this.state==$o&&(this.state=Wo,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Wo&&(this.state=Ko,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Hh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}},{key:"unlistenImage_",value:function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}])&&qh(t.prototype,i),n&&qh(t,n),u}();function $h(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var ta=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}var t,n,e;return t=i,(n=[{key:"canExpireCache",value:function(){return 0<this.highWaterMark&&this.getCount()>this.highWaterMark}},{key:"expireCache",value:function(t){for(;this.canExpireCache();)this.pop()}},{key:"clear",value:function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}},{key:"containsKey",value:function(t){return this.entries_.hasOwnProperty(t)}},{key:"forEach",value:function(t){for(var i=this.oldest_;i;)t(i.value_,i.key_,this),i=i.newer}},{key:"get",value:function(t,i){t=this.entries_[t];return rr(void 0!==t,15),t===this.newest_?t.value_:(t===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this.newest_,this.newest_.newer=t,(this.newest_=t).value_)}},{key:"remove",value:function(t){var i=this.entries_[t];return rr(void 0!==i,15),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[t],--this.count_,i.value_}},{key:"getCount",value:function(){return this.count_}},{key:"getKeys",value:function(){for(var t=new Array(this.count_),i=0,n=this.newest_;n;n=n.older)t[i++]=n.key_;return t}},{key:"getValues",value:function(){for(var t=new Array(this.count_),i=0,n=this.newest_;n;n=n.older)t[i++]=n.value_;return t}},{key:"peekLast",value:function(){return this.oldest_.value_}},{key:"peekLastKey",value:function(){return this.oldest_.key_}},{key:"peekFirstKey",value:function(){return this.newest_.key_}},{key:"pop",value:function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}},{key:"replace",value:function(t,i){this.get(t),this.entries_[t].value_=i}},{key:"set",value:function(t,i){rr(!(t in this.entries_),16);i={key_:t,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}},{key:"setSize",value:function(t){this.highWaterMark=t}}])&&$h(t.prototype,n),e&&$h(t,e),i}();function ia(t,i,n,e){return void 0!==e?(e[0]=t,e[1]=i,e[2]=n,e):[t,i,n]}function na(t,i,n){return t+"/"+i+"/"+n}function ea(t){return(ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ra(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function sa(t,i){return(sa=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function oa(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ua(n);return t=e?(t=ua(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ea(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ua(t){return(ua=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ha=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&sa(t,i)}(r,ta);var t,i,n,e=oa(r);function r(){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),e.apply(this,arguments)}return t=r,(i=[{key:"expireCache",value:function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}}},{key:"pruneExceptNewestZ",value:function(){var t,n;0!==this.getCount()&&(t=this.peekFirstKey(),n=t.split("/").map(Number)[0],this.forEach(function(t){var i;t.tileCoord[0]!==n&&(this.remove(na((i=t.tileCoord)[0],i[1],i[2])),t.release())}.bind(this)))}}])&&ra(t.prototype,i),n&&ra(t,n),r}(),aa="tileloadstart",ca="tileloadend",fa="tileloaderror";function la(t){return(la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function va(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ya(t,i){return(ya=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function da(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ba(n);return t=e?(t=ba(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==la(t)&&"function"!=typeof t?pa(i):t}}function pa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ba(t){return(ba=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ma(i){return i?Array.isArray(i)?function(t){return i}:"function"==typeof i?i:function(t){return[i]}:null}var wa=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ya(t,i)}(r,Is);var t,i,n,e=da(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).projection=Hu(t.projection),i.attributions_=ma(t.attributions),i.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,i.loading=!1,i.state_=void 0!==t.state?t.state:Ys.READY,i.wrapX_=void 0!==t.wrapX&&t.wrapX,i.interpolate_=!!t.interpolate,i.viewResolver=null,i.viewRejector=null;var n=pa(i);return i.viewPromise_=new Promise(function(t,i){n.viewResolver=t,n.viewRejector=i}),i}return t=r,(i=[{key:"getAttributions",value:function(){return this.attributions_}},{key:"getAttributionsCollapsible",value:function(){return this.attributionsCollapsible_}},{key:"getProjection",value:function(){return this.projection}},{key:"getResolutions",value:function(){return Ue()}},{key:"getView",value:function(){return this.viewPromise_}},{key:"getState",value:function(){return this.state_}},{key:"getWrapX",value:function(){return this.wrapX_}},{key:"getInterpolate",value:function(){return this.interpolate_}},{key:"refresh",value:function(){this.changed()}},{key:"setAttributions",value:function(t){this.attributions_=ma(t),this.changed()}},{key:"setState",value:function(t){this.state_=t,this.changed()}}])&&va(t.prototype,i),n&&va(t,n),r}();function ga(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Ma=function(){function r(t,i,n,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),this.minX=t,this.maxX=i,this.minY=n,this.maxY=e}var t,i,n;return t=r,(i=[{key:"contains",value:function(t){return this.containsXY(t[1],t[2])}},{key:"containsTileRange",value:function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}},{key:"containsXY",value:function(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}},{key:"equals",value:function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}},{key:"extend",value:function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}},{key:"getHeight",value:function(){return this.maxY-this.minY+1}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight()]}},{key:"getWidth",value:function(){return this.maxX-this.minX+1}},{key:"intersects",value:function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}])&&ga(t.prototype,i),n&&ga(t,n),r}();function ka(t,i,n,e,r){return void 0!==r?(r.minX=t,r.maxX=i,r.minY=n,r.maxY=e,r):new Ma(t,i,n,e)}var Ra=Ma;function Ea(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Oa=[0,0,0],Sa=function(){function h(t){var n,e,r,i;if(!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h),this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,rr((n=this.resolutions_,e=!0,r=function(t,i){return i-t}||Fe,n.every(function(t,i){if(0===i)return!0;t=r(n[i-1],t);return!(0<t||e&&0===t)})),17),!t.origins)for(var s=0,o=this.resolutions_.length-1;s<o;++s)if(i){if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}else i=this.resolutions_[s]/this.resolutions_[s+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,rr(this.origins_.length==this.resolutions_.length,20));var u=t.extent;void 0===u||this.origin_||this.origins_||(this.origin_=Sr(u)),rr(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,rr(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:du,rr(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==u?u:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,i){t=new Ra(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));return u&&(i=this.getTileRangeForExtentAndZ(u,i),t.minX=Math.max(i.minX,t.minX),t.maxX=Math.min(i.maxX,t.maxX),t.minY=Math.max(i.minY,t.minY),t.maxY=Math.min(i.maxY,t.maxY)),t},this):u&&this.calculateTileRanges_(u)}var t,i,n;return t=h,(i=[{key:"forEachTileCoord",value:function(t,i,n){for(var e=this.getTileRangeForExtentAndZ(t,i),r=e.minX,s=e.maxX;r<=s;++r)for(var o=e.minY,u=e.maxY;o<=u;++o)n([i,r,o])}},{key:"forEachTileCoordParentTileRange",value:function(t,i,n,e){var r,s,o=null,u=t[0]-1;for(2===this.zoomFactor_?(r=t[1],s=t[2]):o=this.getTileCoordExtent(t,e);u>=this.minZoom;){if(i(u,2===this.zoomFactor_?ka(r=Math.floor(r/2),r,s=Math.floor(s/2),s,n):this.getTileRangeForExtentAndZ(o,u,n)))return!0;--u}return!1}},{key:"getExtent",value:function(){return this.extent_}},{key:"getMaxZoom",value:function(){return this.maxZoom}},{key:"getMinZoom",value:function(){return this.minZoom}},{key:"getOrigin",value:function(t){return this.origin_||this.origins_[t]}},{key:"getResolution",value:function(t){return this.resolutions_[t]}},{key:"getResolutions",value:function(){return this.resolutions_}},{key:"getTileCoordChildTileRange",value:function(t,i,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var e=2*t[1],r=2*t[2];return ka(e,1+e,r,1+r,i)}n=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,i)}return null}},{key:"getTileRangeForTileCoordAndZ",value:function(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;var e=t[0],r=t[1],s=t[2];if(i===e)return ka(r,s,r,s,n);if(this.zoomFactor_){var o=Math.pow(this.zoomFactor_,i-e),u=Math.floor(r*o),h=Math.floor(s*o);return i<e?ka(u,u,h,h,n):ka(u,Math.floor(o*(r+1))-1,h,Math.floor(o*(s+1))-1,n)}t=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(t,i,n)}},{key:"getTileRangeExtent",value:function(t,i,n){var e=this.getOrigin(t),r=this.getResolution(t),s=Rh(this.getTileSize(t),this.tmpSize_),o=e[0]+i.minX*s[0]*r,t=e[0]+(i.maxX+1)*s[0]*r;return pr(o,e[1]+i.minY*s[1]*r,t,e[1]+(i.maxY+1)*s[1]*r,n)}},{key:"getTileRangeForExtentAndZ",value:function(t,i,n){var e=Oa;this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,e);var r=e[1],s=e[2];return this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,e),ka(r,e[1],s,e[2],n)}},{key:"getTileCoordCenter",value:function(t){var i=this.getOrigin(t[0]),n=this.getResolution(t[0]),e=Rh(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*e[0]*n,i[1]-(t[2]+.5)*e[1]*n]}},{key:"getTileCoordExtent",value:function(t,i){var n=this.getOrigin(t[0]),e=this.getResolution(t[0]),r=Rh(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*r[0]*e,t=n[1]-(t[2]+1)*r[1]*e;return pr(s,t,s+r[0]*e,t+r[1]*e,i)}},{key:"getTileCoordForCoordAndResolution",value:function(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}},{key:"getTileCoordForXYAndResolution_",value:function(t,i,n,e,r){var s=this.getZForResolution(n),o=n/this.getResolution(s),u=this.getOrigin(s),h=Rh(this.getTileSize(s),this.tmpSize_),t=o*(t-u[0])/n/h[0],h=o*(u[1]-i)/n/h[1],h=e?(t=Dr(t,5)-1,Dr(h,5)-1):(t=Nr(t,5),Nr(h,5));return ia(s,t,h,r)}},{key:"getTileCoordForXYAndZ_",value:function(t,i,n,e,r){var s=this.getOrigin(n),o=this.getResolution(n),u=Rh(this.getTileSize(n),this.tmpSize_),t=(t-s[0])/o/u[0],u=(s[1]-i)/o/u[1],u=e?(t=Dr(t,5)-1,Dr(u,5)-1):(t=Nr(t,5),Nr(u,5));return ia(n,t,u,r)}},{key:"getTileCoordForCoordAndZ",value:function(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}},{key:"getTileCoordResolution",value:function(t){return this.resolutions_[t[0]]}},{key:"getTileSize",value:function(t){return this.tileSize_||this.tileSizes_[t]}},{key:"getFullTileRange",value:function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}},{key:"getZForResolution",value:function(t,i){return Ir(Ne(this.resolutions_,t,i||0),this.minZoom,this.maxZoom)}},{key:"calculateTileRanges_",value:function(t){for(var i=this.resolutions_.length,n=new Array(i),e=this.minZoom;e<i;++e)n[e]=this.getTileRangeForExtentAndZ(t,e);this.fullTileRanges_=n}}])&&Ea(t.prototype,i),n&&Ea(t,n),h}();function Ta(t){var i,n,e,r=t.getDefaultTileGrid();return r||(r=function(t,i,n,e){e=void 0!==e?e:ar.TOP_LEFT,i=Aa(t,i,n);return new Sa({extent:t,origin:function(t,i){var n;return i===ar.BOTTOM_LEFT?n=gr(t):i===ar.BOTTOM_RIGHT?n=Mr(t):i===ar.TOP_LEFT?n=Sr(t):i===ar.TOP_RIGHT?n=Tr(t):rr(!1,13),n}(t,e),resolutions:i,tileSize:n})}(ja(t),i,n,e),t.setDefaultTileGrid(r)),r}function Aa(t,i,n,e){for(var r=void 0!==i?i:yu,i=Er(t),t=Ar(t),n=Rh(void 0!==n?n:du),s=0<e?e:Math.max(t/n[0],i/n[1]),o=r+1,u=new Array(o),h=0;h<o;++h)u[h]=s/Math.pow(2,h);return u}function ja(t){var i=(t=Hu(t)).getExtent();return i=!i?pr(-(t=180*au[cu.DEGREES]/t.getMetersPerUnit()),-t,t,t):i}function xa(t){return(xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ca(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Ia(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function La(t,i,n){return(La="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Fa(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Pa(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&_a(t,i)}function _a(t,i){return(_a=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ba(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Fa(n);return t=e?(t=Fa(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==xa(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Fa(t){return(Fa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var n=function(){Pa(r,wa);var t,i,n,e=Ba(r);function r(t){var i;Ca(this,r),(i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})).on,i.once,i.un,i.opaque_=void 0!==t.opaque&&t.opaque,i.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,i.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;return i.tileGrid&&Rh(i.tileGrid.getTileSize(i.tileGrid.getMinZoom()),[256,256]),i.tileCache=new ha(t.cacheSize||0),i.tmpSize=[0,0],i.key_=t.key||"",i.tileOptions={transition:t.transition,interpolate:t.interpolate},i.zDirection=t.zDirection||0,i}return t=r,(i=[{key:"canExpireCache",value:function(){return this.tileCache.canExpireCache()}},{key:"expireCache",value:function(t,i){t=this.getTileCacheForProjection(t);t&&t.expireCache(i)}},{key:"forEachLoadedTile",value:function(t,i,n,e){var r=this.getTileCacheForProjection(t);if(!r)return!1;for(var s,o,u=!0,h=n.minX;h<=n.maxX;++h)for(var a=n.minY;a<=n.maxY;++a)s=na(i,h,a),o=!1,(o=r.containsKey(s)?(o=(s=r.get(s)).getState()===Jo)&&!1!==e(s):o)||(u=!1);return u}},{key:"getGutterForProjection",value:function(t){return 0}},{key:"getKey",value:function(){return this.key_}},{key:"setKey",value:function(t){this.key_!==t&&(this.key_=t,this.changed())}},{key:"getOpaque",value:function(t){return this.opaque_}},{key:"getResolutions",value:function(){return this.tileGrid?this.tileGrid.getResolutions():null}},{key:"getTile",value:function(t,i,n,e,r){return Ue()}},{key:"getTileGrid",value:function(){return this.tileGrid}},{key:"getTileGridForProjection",value:function(t){return this.tileGrid||Ta(t)}},{key:"getTileCacheForProjection",value:function(t){return rr(Qu(this.getProjection(),t),68),this.tileCache}},{key:"getTilePixelRatio",value:function(t){return this.tilePixelRatio_}},{key:"getTilePixelSize",value:function(t,i,n){n=this.getTileGridForProjection(n),i=this.getTilePixelRatio(i),n=Rh(n.getTileSize(t),this.tmpSize);return 1==i?n:(t=n,n=i,(i=void 0===(i=this.tmpSize)?[0,0]:i)[0]=t[0]*n+.5|0,i[1]=t[1]*n+.5|0,i)}},{key:"getTileCoordForTileUrlFunction",value:function(t,i){var n,e,r,s=void 0!==i?i:this.getProjection(),o=this.getTileGridForProjection(s);return this.getWrapX()&&s.isGlobal()&&(n=o,r=s,i=(e=t)[0],s=n.getTileCoordCenter(e),t=lr(r=ja(r),s)?e:(e=Ar(r),r=Math.ceil((r[0]-s[0])/e),s[0]+=e*r,n.getTileCoordForCoordAndZ(s,i))),function(t,i){var n=t[0],e=t[1],t=t[2];if(!(i.getMinZoom()>n||n>i.getMaxZoom())){n=i.getFullTileRange(n);return!n||n.containsXY(e,t)}}(t,o)?t:null}},{key:"clear",value:function(){this.tileCache.clear()}},{key:"refresh",value:function(){this.clear(),La(Fa(r.prototype),"refresh",this).call(this)}},{key:"updateCacheSize",value:function(t,i){i=this.getTileCacheForProjection(i);t>i.highWaterMark&&(i.highWaterMark=t)}},{key:"useTile",value:function(t,i,n,e){}}])&&Ia(t.prototype,i),n&&Ia(t,n),r}(),Na=function(){Pa(e,$r);var n=Ba(e);function e(t,i){return Ca(this,e),(t=n.call(this,t)).tile=i,t}return e}(),Da=n;function Va(t,i){for(var r,n=t.length,e=new Array(n),s=0;s<n;++s)e[s]=function(e,r){var s=/\{z\}/g,o=/\{x\}/g,u=/\{y\}/g,h=/\{-y\}/g;return function(i,t,n){if(i)return e.replace(s,i[0].toString()).replace(o,i[1].toString()).replace(u,i[2].toString()).replace(h,function(){var t=i[0],t=r.getFullTileRange(t);return rr(t,55),(t.getHeight()-i[2]-1).toString()})}}(t[s],i);return 1!==(r=e).length?function(t,i,n){if(t){e=Br(((e=t)[1]<<e[0])+e[2],r.length);return r[e](t,i,n)}var e}:r[0]}function Za(t){return(Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function za(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ua(t,i){return(Ua=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ga(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ya(n);return t=e?(t=Ya(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Za(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ya(t){return(Ya=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ha=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ua(t,i)}(r,Da);var t,i,n,e=Ga(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})).generateTileUrlFunction_=i.tileUrlFunction===r.prototype.tileUrlFunction,i.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(i.tileUrlFunction=t.tileUrlFunction),i.urls=null,t.urls?i.setUrls(t.urls):t.url&&i.setUrl(t.url),i.tileLoadingKeys_={},i}return t=r,(i=[{key:"getTileLoadFunction",value:function(){return this.tileLoadFunction}},{key:"getTileUrlFunction",value:function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}},{key:"getUrls",value:function(){return this.urls}},{key:"handleTileChange",value:function(t){var i,n=t.target,e=Ye(n),t=n.getState();t==Ko?(this.tileLoadingKeys_[e]=!0,i=aa):e in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[e],i=t==$o?fa:t==Jo?ca:void 0),null!=i&&this.dispatchEvent(new Na(i,n))}},{key:"setTileLoadFunction",value:function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}},{key:"setTileUrlFunction",value:function(t,i){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==i?this.setKey(i):this.changed()}},{key:"setUrl",value:function(t){t=function(t){var i=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){for(var e=n[1].charCodeAt(0),r=n[2].charCodeAt(0),s=e;s<=r;++s)i.push(t.replace(n[0],String.fromCharCode(s)));return i}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var o=parseInt(n[2],10),u=parseInt(n[1],10);u<=o;u++)i.push(t.replace(n[0],u.toString()));return i}return i.push(t),i}(t);this.urls=t,this.setUrls(t)}},{key:"setUrls",value:function(t){var i=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Va(t,this.tileGrid),i):this.setKey(i)}},{key:"tileUrlFunction",value:function(t,i,n){}},{key:"useTile",value:function(t,i,n){n=na(t,i,n);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}])&&za(t.prototype,i),n&&za(t,n),r}();function Xa(t){return(Xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qa(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Qa(t,i,n){return(Qa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Ja(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Wa(t,i){return(Wa=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ka(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ja(n);return t=e?(t=Ja(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Xa(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ja(t){return(Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $a(t,i){t.getImage().src=i}var tc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Wa(t,i)}(r,Ha);var t,i,n,e=Ka(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(i=t.interpolate),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction||$a,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:i,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})).crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,i.tileClass=void 0!==t.tileClass?t.tileClass:Jh,i.tileCacheForProjection={},i.tileGridForProjection={},i.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,i.renderReprojectionEdges_=!1,i}return t=r,(i=[{key:"canExpireCache",value:function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}},{key:"expireCache",value:function(t,i){var n,e=this.getTileCacheForProjection(t);for(n in this.tileCache.expireCache(this.tileCache==e?i:{}),this.tileCacheForProjection){var r=this.tileCacheForProjection[n];r.expireCache(r==e?i:{})}}},{key:"getGutterForProjection",value:function(t){return this.getProjection()&&t&&!Qu(this.getProjection(),t)?0:this.getGutter()}},{key:"getGutter",value:function(){return 0}},{key:"getKey",value:function(){var t=Qa(Ja(r.prototype),"getKey",this).call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t}},{key:"getOpaque",value:function(t){return!(this.getProjection()&&t&&!Qu(this.getProjection(),t))&&Qa(Ja(r.prototype),"getOpaque",this).call(this,t)}},{key:"getTileGridForProjection",value:function(t){var i=this.getProjection();if(!this.tileGrid||i&&!Qu(i,t)){i=Ye(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ta(t)),this.tileGridForProjection[i]}return this.tileGrid}},{key:"getTileCacheForProjection",value:function(t){var i=this.getProjection();if(!i||Qu(i,t))return this.tileCache;t=Ye(t);return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new ha(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}},{key:"createTile_",value:function(t,i,n,e,r,s){i=[t,i,n],n=this.getTileCoordForTileUrlFunction(i,r),r=n?this.tileUrlFunction(n,e,r):void 0,r=new this.tileClass(i,void 0!==r?Wo:tu,void 0!==r?r:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return r.key=s,r.addEventListener(cs,this.handleTileChange.bind(this)),r}},{key:"getTile",value:function(t,i,n,e,r){var s=this.getProjection();return this.getTileInternal(t,i,n,e,s||r)}},{key:"getTileInternal",value:function(t,i,n,e,r){var s,o=null,u=na(t,i,n),h=this.getKey();return this.tileCache.containsKey(u)?(o=this.tileCache.get(u)).key!=h&&(s=o,o=this.createTile_(t,i,n,e,r,h),s.getState()==Wo?o.interimTile=s.interimTile:o.interimTile=s,o.refreshInterimChain(),this.tileCache.replace(u,o)):(o=this.createTile_(t,i,n,e,r,h),this.tileCache.set(u,o)),o}},{key:"setRenderReprojectionEdges",value:function(t){if(this.renderReprojectionEdges_!=t){for(var i in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[i].clear();this.changed()}}}])&&qa(t.prototype,i),n&&qa(t,n),r}();function ic(t){return(ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nc(t,i){return(nc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function ec(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=rc(n);return t=e?(t=rc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ic(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function rc(t){return(rc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var sc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&nc(t,i)}(o,tc);var s=ec(o);function o(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,o);var i=t||{},n=void 0===i.imageSmoothing||i.imageSmoothing;void 0!==i.interpolate&&(n=i.interpolate);var e,r=void 0!==i.projection?i.projection:"EPSG:3857",e=void 0!==i.tileGrid?i.tileGrid:(t={extent:ja(r),maxResolution:i.maxResolution,maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize},e={extent:t=(e=t||{}).extent||Hu("EPSG:3857").getExtent(),minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Aa(t,e.maxZoom,e.tileSize,e.maxResolution)},new Sa(e));return s.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:n,opaque:i.opaque,projection:r,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:e,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})}return o}();function oc(t){return(oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uc(t,i){return(uc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function hc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ac(n);return t=e?(t=ac(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==oc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ac(t){return(ac=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var cc='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',fc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&uc(t,i)}(e,sc);var n=hc(e);function e(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e);var i=t||{},t=void 0!==i.attributions?i.attributions:[cc];return n.call(this,{attributions:t,attributionsCollapsible:!1,cacheSize:i.cacheSize,crossOrigin:void 0!==i.crossOrigin?i.crossOrigin:"anonymous",interpolate:void 0!==i.interpolate?i.interpolate:void 0===i.imageSmoothing||i.imageSmoothing,maxZoom:void 0!==i.maxZoom?i.maxZoom:19,opaque:void 0===i.opaque||i.opaque,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,transition:i.transition,url:void 0!==i.url?i.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:i.wrapX,zDirection:i.zDirection})}return e}(),lc="preload",vc="useInterimTilesOnError";function yc(t){return(yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function pc(t,i,n){return(pc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=wc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function bc(t,i){return(bc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function mc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=wc(n);return t=e?(t=wc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==yc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function wc(t){return(wc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var gc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&bc(t,i)}(r,$s);var t,i,n,e=mc(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=t||{},t=is({},i);return delete t.preload,delete t.useInterimTilesOnError,(t=e.call(this,t)).on,t.once,t.un,t.setPreload(void 0!==i.preload?i.preload:0),t.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),t}return t=r,(i=[{key:"getPreload",value:function(){return this.get(lc)}},{key:"setPreload",value:function(t){this.set(lc,t)}},{key:"getUseInterimTilesOnError",value:function(){return this.get(vc)}},{key:"setUseInterimTilesOnError",value:function(t){this.set(vc,t)}},{key:"getData",value:function(t){return pc(wc(r.prototype),"getData",this).call(this,t)}}])&&dc(t.prototype,i),n&&dc(t,n),r}();function Mc(t){return(Mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Rc(t,i,n){return(Rc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Tc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Ec(t,i){return(Ec=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Oc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Tc(n);return t=e?(t=Tc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Mc(t)&&"function"!=typeof t?Sc(i):t}}function Sc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Tc(t){return(Tc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ac=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ec(t,i)}(r,ks);var t,i,n,e=Oc(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).ready=!0,i.boundHandleImageChange_=i.handleImageChange_.bind(Sc(i)),i.layer_=t,i.declutterExecutorGroup=null,i}return t=r,(i=[{key:"getFeatures",value:function(t){return Ue()}},{key:"getData",value:function(t){return null}},{key:"prepareFrame",value:function(t){return Ue()}},{key:"renderFrame",value:function(t,i){return Ue()}},{key:"loadedTileCallback",value:function(t,i,n){t[i]||(t[i]={}),t[i][n.tileCoord.toString()]=n}},{key:"createLoadedTileFinder",value:function(e,r,s){return function(t,i){var n=this.loadedTileCallback.bind(this,s,t);return e.forEachLoadedTile(r,t,i,n)}.bind(this)}},{key:"forEachFeatureAtCoordinate",value:function(t,i,n,e,r){}},{key:"getDataAtPixel",value:function(t,i,n){return null}},{key:"getLayer",value:function(){return this.layer_}},{key:"handleFontsChanged",value:function(){}},{key:"handleImageChange_",value:function(t){t.target.getState()===Yh.LOADED&&this.renderIfReadyAndVisible()}},{key:"loadImage",value:function(t){var i=t.getState();return i!=Yh.LOADED&&i!=Yh.ERROR&&t.addEventListener(cs,this.boundHandleImageChange_),i==Yh.IDLE&&(t.load(),i=t.getState()),i==Yh.LOADED}},{key:"renderIfReadyAndVisible",value:function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Ys.READY&&t.changed()}},{key:"disposeInternal",value:function(){delete this.layer_,Rc(Tc(r.prototype),"disposeInternal",this).call(this)}}])&&kc(t.prototype,i),n&&kc(t,n),r}();function jc(t){return(jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xc(t,i){return(xc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Cc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ic(n);return t=e?(t=Ic(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==jc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ic(t){return(Ic=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Lc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&xc(t,i)}(s,$r);var r=Cc(s);function s(t,i,n,e){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),(t=r.call(this,t)).inversePixelTransform=i,t.frameState=n,t.context=e,t}return s}();function Pc(t){return(Pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _c(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Bc(t,i,n){return(Bc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Dc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Fc(t,i){return(Fc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Nc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Dc(n);return t=e?(t=Dc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Pc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Dc(t){return(Dc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vc=null;var Zc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Fc(t,i)}(r,Ac);var t,i,n,e=Nc(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).container=null,t.renderedResolution,t.tempTransform=sr(),t.pixelTransform=sr(),t.inversePixelTransform=sr(),t.context=null,t.containerReused=!1,t.pixelContext_=null,t.frameState=null,t}return t=r,(i=[{key:"getImageData",value:function(t,i,n){var e,r;Vc||((e=document.createElement("canvas")).width=1,e.height=1,Vc=e.getContext("2d")),Vc.clearRect(0,0,1,1);try{Vc.drawImage(t,i,n,1,1,0,0,1,1),r=Vc.getImageData(0,0,1,1).data}catch(t){return null}return r}},{key:"getBackground",value:function(t){var i=this.getLayer().getBackground();return(i="function"==typeof i?i(t.viewState.resolution):i)||void 0}},{key:"useContainer",value:function(t,i,n,e){var r,s,o,u,h,a=this.getLayer().getClassName();t&&t.className===a&&""===t.style.opacity&&1===n&&(!e||t.style.backgroundColor&&Ve(Xr(t.style.backgroundColor),Xr(e)))&&((n=t.firstElementChild)instanceof HTMLCanvasElement&&(r=n.getContext("2d"))),r&&r.canvas.style.transform===i?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),this.container||((t=document.createElement("div")).className=a,(a=t.style).position="absolute",a.width="100%",a.height="100%",e&&(a.backgroundColor=e),u=u&&u.length?u.shift():qe?new OffscreenCanvas(s||300,o||300):document.createElement("canvas"),s&&(u.width=s),o&&(u.height=o),h=(r=u.getContext("2d",h)).canvas,t.appendChild(h),(a=h.style).position="absolute",a.left="0",a.transformOrigin="top left",this.container=t,this.context=r)}},{key:"clipUnrotated",value:function(t,i,n){var e=Sr(n),r=Tr(n),s=Mr(n),n=gr(n);or(i.coordinateToPixelTransform,e),or(i.coordinateToPixelTransform,r),or(i.coordinateToPixelTransform,s),or(i.coordinateToPixelTransform,n);i=this.inversePixelTransform;or(i,e),or(i,r),or(i,s),or(i,n),t.save(),t.beginPath(),t.moveTo(Math.round(e[0]),Math.round(e[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.clip()}},{key:"dispatchRenderEvent_",value:function(t,i,n){var e=this.getLayer();e.hasListener(t)&&(i=new Lc(t,this.inversePixelTransform,n,i),e.dispatchEvent(i))}},{key:"preRender",value:function(t,i){this.frameState=i,this.dispatchRenderEvent_(Zs,t,i)}},{key:"postRender",value:function(t,i){this.dispatchRenderEvent_(zs,t,i)}},{key:"getRenderTransform",value:function(t,i,n,e,r,s,o){i=e/i,o=-t[0]+o,t=-t[1];return ur(this.tempTransform,r/2,s/2,i,-i,-n,o,t)}},{key:"getDataAtPixel",value:function(t,i,n){var e=or(this.inversePixelTransform,t.slice()),r=this.context,s=this.getLayer().getExtent();if(s&&!lr(s,or(i.pixelToCoordinateTransform,t.slice())))return null;var o,s=Math.round(e[0]),i=Math.round(e[1]),t=this.pixelContext_;t||((e=document.createElement("canvas")).width=1,e.height=1,t=e.getContext("2d"),this.pixelContext_=t),t.clearRect(0,0,1,1);try{t.drawImage(r.canvas,s,i,1,1,0,0,1,1),o=t.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?(this.pixelContext_=null,new Uint8Array):o}return 0===o[3]?null:o}},{key:"disposeInternal",value:function(){delete this.frameState,Bc(Dc(r.prototype),"disposeInternal",this).call(this)}}])&&_c(t.prototype,i),n&&_c(t,n),r}();function zc(t){return(zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Uc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Gc(t,i,n){return(Gc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Xc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Yc(t,i){return(Yc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Hc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Xc(n);return t=e?(t=Xc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==zc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Xc(t){return(Xc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Yc(t,i)}(r,Zc);var t,i,n,e=Hc(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,t)).extentChanged=!0,i.renderedExtent_=null,i.renderedPixelRatio,i.renderedProjection=null,i.renderedRevision,i.renderedTiles=[],i.newTiles_=!1,i.tmpExtent=dr(),i.tmpTileRange_=new Ra(0,0,0,0),i.thirdMap_=t.thirdMap_,i.layercount_=t.layercount_,i}return t=r,(i=[{key:"isDrawableTile",value:function(t){var i=this.getLayer(),t=t.getState(),i=i.getUseInterimTilesOnError();return t==Jo||t==tu||t==$o&&!i}},{key:"getTile",value:function(t,i,n,e){var r=e.pixelRatio,s=e.viewState.projection,e=this.getLayer(),s=e.getSource().getTile(t,i,n,r,s);return s.getState()==$o&&(e.getUseInterimTilesOnError()?0<e.getPreload()&&(this.newTiles_=!0):s.setState(Jo)),s=!this.isDrawableTile(s)?s.getInterimTile():s}},{key:"getData",value:function(t){var i=this.frameState;if(!i)return null;var n=this.getLayer(),e=or(i.pixelToCoordinateTransform,t.slice()),t=n.getExtent();if(t&&!lr(t,e))return null;for(var r=i.pixelRatio,s=i.viewState.projection,t=i.viewState,o=n.getRenderSource(),u=o.getTileGridForProjection(t.projection),h=o.getTilePixelRatio(i.pixelRatio),a=u.getZForResolution(t.resolution);a>=u.getMinZoom();--a){var c=u.getTileCoordForCoordAndZ(e,a),f=o.getTile(a,c[1],c[2],r,s);if(!(f instanceof Jh))return null;if(f.getState()===Jo){var l=u.getOrigin(a),v=Rh(u.getTileSize(a)),y=u.getResolution(a),d=Math.floor(h*((e[0]-l[0])/y-c[1]*v[0])),v=Math.floor(h*((l[1]-e[1])/y-c[2]*v[1]));return this.getImageData(f.getImage(),d,v)}}return null}},{key:"loadedTileCallback",value:function(t,i,n){return!!this.isDrawableTile(n)&&Gc(Xc(r.prototype),"loadedTileCallback",this).call(this,t,i,n)}},{key:"prepareFrame",value:function(t){return!!this.getLayer().getSource()}},{key:"renderFrame",value:function(t,i){var n=t.layerStatesArray[t.layerIndex],e=t.viewState,r=e.projection,s=e.resolution,o=e.center,u=e.rotation,h=t.pixelRatio,a=this.getLayer(),c=a.getSource(),f=c.getRevision(),l=c.getTileGridForProjection(r),v=l.getZForResolution(s,c.zDirection),y=l.getResolution(v),d=t.extent;n.extent&&oh(n.extent,r)&&(d=Or(d,oh(n.extent,r)));var p=c.getTilePixelRatio(h),b=Math.round(t.size[0]*p),m=Math.round(t.size[1]*p);u&&(m=b=Math.round(Math.sqrt(b*b+m*m)));var w=y*b/2/p,e=y*m/2/p,g=[o[0]-w,o[1]-e,o[0]+w,o[1]+e],M=l.getTileRangeForExtentAndZ(d,v),k={};k[v]={};var R=this.createLoadedTileFinder(c,r,k),E=this.tmpExtent,O=this.tmpTileRange_;this.newTiles_=!1;for(var S=M.minX;S<=M.maxX;++S)for(var T=M.minY;T<=M.maxY;++T){var A=this.getTile(v,S,T,t);if(this.isDrawableTile(A)){var j=Ye(this);if(A.getState()==Jo&&(x=(k[v][A.tileCoord.toString()]=A).inTransition(j),this.newTiles_||!x&&-1!==this.renderedTiles.indexOf(A)||(this.newTiles_=!0)),1===A.getAlpha(j,t.time))continue}var x=l.getTileCoordChildTileRange(A.tileCoord,O,E),j=!1;(j=x?R(v+1,x):j)||l.forEachTileCoordParentTileRange(A.tileCoord,R,O,E)}var C=y/s;ur(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/p,1/p,u,-b/2,-m/2),hr(this.inversePixelTransform,this.pixelTransform),ur(this.tempTransform,b/2,m/2,C,C,0,-b/2,-m/2),this.renderedTiles.length=0;var I,L=Object.keys(k).map(Number);L.sort(Fe),1!==n.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?I=[]:L=L.reverse();for(var P=[],_=L.length-1;0<=_;--_){var B,F=L[_],N=c.getTilePixelSize(F,h,r),D=l.getResolution(F)/y,V=N[0]*D*C,Z=N[1]*D*C,z=l.getTileCoordForCoordAndZ(Sr(g),F),D=l.getTileCoordExtent(z),U=or(this.tempTransform,[p*(D[0]-g[0])/y,p*(g[3]-D[3])/y]),G=p*c.getGutterForProjection(r),Y=k[F];for(B in Y){var H=Y[B],X=H.tileCoord,q=z[1]-X[1],Q=Math.round(U[0]-(q-1)*V),W=z[2]-X[2],K=Math.round(U[1]-(W-1)*Z),J=Math.round(U[0]-q*V),X=Math.round(U[1]-W*Z),q=Q-J,W=K-X,Q=v===F,K=Q&&1!==H.getAlpha(Ye(this),t.time);this.drawTileImage(H,t,J,X,q,W,G,Q,P),I&&!K?this.renderedTiles.unshift(H):this.renderedTiles.push(H),this.updateUsedTiles(t.usedTiles,c,H)}}return this.renderedRevision=f,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!mr(this.renderedExtent_,g),this.renderedExtent_=g,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,c,l,h,r,d,v,a.getPreload()),this.scheduleExpireCache(t,c),this.thirdMap_&&(1===this.layercount_?this.thirdMap_.Oe&&this.thirdMap_.Oe(P):this.thirdMap_.Se&&this.thirdMap_.Se(P)),this.container}},{key:"drawTileImage",value:function(t,i,n,e,r,s,o,u,h){var a,c,f=this.getTileImage(t);f&&(a=Ye(this),c=u?t.getAlpha(a,i.time):1,h.push({image:f,x:n,y:e,w:r,h:s,frameState:i}),1!==c?i.animate=!0:u&&t.endTransition(a))}},{key:"getTileImage",value:function(t){return t.getImage()}},{key:"scheduleExpireCache",value:function(t,i){i.canExpireCache()&&(i=function(t,i,n){var e=Ye(t);e in n.usedTiles&&t.expireCache(n.viewState.projection,n.usedTiles[e])}.bind(null,i),t.postRenderFunctions.push(i))}},{key:"updateUsedTiles",value:function(t,i,n){i=Ye(i);i in t||(t[i]={}),t[i][n.getKey()]=!0}},{key:"manageTilePyramid",value:function(t,i,n,e,r,s,o,u,h){var a=Ye(i);a in t.wantedTiles||(t.wantedTiles[a]={});for(var c,f,l,v,y,d=t.wantedTiles[a],p=t.tileQueue,b=0,m=n.getMinZoom();m<=o;++m)for(f=n.getTileRangeForExtentAndZ(s,m,f),l=n.getResolution(m),v=f.minX;v<=f.maxX;++v)for(y=f.minY;y<=f.maxY;++y)o-m<=u?(++b,(c=i.getTile(m,v,y,e,r)).getState()==Wo&&(d[c.getKey()]=!0,p.isKeyQueued(c.getKey())||p.enqueue([c,a,n.getTileCoordCenter(c.tileCoord),l])),void 0!==h&&h(c)):i.useTile(m,v,y,r);i.updateCacheSize(b,r)}}])&&Uc(t.prototype,i),n&&Uc(t,n),r}();function Qc(t){return(Qc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Kc(t,i){return(Kc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Jc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=$c(n);return t=e?(t=$c(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Qc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function $c(t){return($c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Kc(t,i)}(r,gc);var t,i,n,e=Jc(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,t)).layercount_=t.layercount,i.thirdMap_=t.thirdMap,i}return t=r,(i=[{key:"createRenderer",value:function(){return new qc(this)}}])&&Wc(t.prototype,i),n&&Wc(t,n),r}(),nf={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function ef(t,i,n,e,r,s){for(var o=s||[],u=0,h=i;h<n;h+=e){var a=t[h],c=t[h+1];o[u++]=r[0]*a+r[2]*c+r[4],o[u++]=r[1]*a+r[3]*c+r[5]}return s&&o.length!=u&&(o.length=u),o}function rf(t){return(rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function of(t,i){return(of=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function uf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=hf(n);return t=e?(t=hf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==rf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function hf(t){return(hf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var af=sr(),cf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&of(t,i)}(u,Is);var t,i,n,o=uf(u);function u(){var t,i,n,e,r,s;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(t=o.call(this)).extent_=dr(),t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=(s=!(i=function(t,i,n){if(!n)return this.getSimplifiedGeometry(i);var e=this.clone();return e.applyTransform(n),e.getSimplifiedGeometry(i)}),function(){var t=Array.prototype.slice.call(arguments);return s&&this===r&&Ve(t,e)||(s=!0,r=this,e=t,n=i.apply(this,arguments)),n}),t}return t=u,(i=[{key:"simplifyTransformed",value:function(t,i){return this.simplifyTransformedInternal(this.getRevision(),t,i)}},{key:"clone",value:function(){return Ue()}},{key:"closestPointXY",value:function(t,i,n,e){return Ue()}},{key:"containsXY",value:function(t,i){var n=this.getClosestPoint([t,i]);return n[0]===t&&n[1]===i}},{key:"getClosestPoint",value:function(t,i){i=i||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i}},{key:"intersectsCoordinate",value:function(t){return this.containsXY(t[0],t[1])}},{key:"computeExtent",value:function(t){return Ue()}},{key:"getExtent",value:function(t){var i;return this.extentRevision_!=this.getRevision()&&(i=this.computeExtent(this.extent_),(isNaN(i[0])||isNaN(i[1]))&&br(i),this.extentRevision_=this.getRevision()),i=this.extent_,(t=t)?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}},{key:"rotate",value:function(t,i){Ue()}},{key:"scale",value:function(t,i,n){Ue()}},{key:"simplify",value:function(t){return this.getSimplifiedGeometry(t*t)}},{key:"getSimplifiedGeometry",value:function(t){return Ue()}},{key:"getType",value:function(){return Ue()}},{key:"applyTransform",value:function(t){Ue()}},{key:"intersectsExtent",value:function(t){return Ue()}},{key:"translate",value:function(t,i){Ue()}},{key:"transform",value:function(t,s){var o=Hu(t),t=o.getUnits()==cu.TILE_PIXELS?function(t,i,n){var e=o.getExtent(),r=o.getWorldExtent(),e=Er(r)/Er(e);return ur(af,r[0],r[3],e,-e,0,0,0),ef(t,0,t.length,n,af,i),Ku(o,s)(t,i,n)}:Ku(o,s);return this.applyTransform(t),this}}])&&sf(t.prototype,i),n&&sf(t,n),u}();function ff(t){return(ff="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function vf(t,i){return(vf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function yf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=df(n);return t=e?(t=df(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ff(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function df(t){return(df=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pf(t){var i;return t==nf.XY?i=2:t==nf.XYZ||t==nf.XYM?i=3:t==nf.XYZM&&(i=4),i}var bf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&vf(t,i)}(r,cf);var t,i,n,e=yf(r);function r(){var t;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this)).layout=nf.XY,t.stride=2,t.flatCoordinates=null,t}return t=r,(i=[{key:"computeExtent",value:function(t){return i=this.flatCoordinates,n=0,e=this.flatCoordinates.length,r=this.stride,wr(br(t),i,n,e,r);var i,n,e,r}},{key:"getCoordinates",value:function(){return Ue()}},{key:"getFirstCoordinate",value:function(){return this.flatCoordinates.slice(0,this.stride)}},{key:"getFlatCoordinates",value:function(){return this.flatCoordinates}},{key:"getLastCoordinate",value:function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}},{key:"getLayout",value:function(){return this.layout}},{key:"getSimplifiedGeometry",value:function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var i=this.getSimplifiedGeometryInternal(t);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}},{key:"getSimplifiedGeometryInternal",value:function(t){return this}},{key:"getStride",value:function(){return this.stride}},{key:"setFlatCoordinates",value:function(t,i){this.stride=pf(t),this.layout=t,this.flatCoordinates=i}},{key:"setCoordinates",value:function(t,i){Ue()}},{key:"setLayout",value:function(t,i,n){var e;if(t)e=pf(t);else{for(var r=0;r<n;++r){if(0===i.length)return this.layout=nf.XY,void(this.stride=2);i=i[0]}t=function(t){var i;2==t?i=nf.XY:3==t?i=nf.XYZ:4==t&&(i=nf.XYZM);return i}(e=i.length)}this.layout=t,this.stride=e}},{key:"applyTransform",value:function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}},{key:"rotate",value:function(t,i){var n,e=this.getFlatCoordinates();e&&(n=this.getStride(),function(t,i,n,e,r,s,o){for(var u=o||[],h=Math.cos(r),a=Math.sin(r),c=s[0],f=s[1],l=0,v=i;v<n;v+=e){var y=t[v]-c,d=t[v+1]-f;u[l++]=c+y*h-d*a,u[l++]=f+y*a+d*h;for(var p=v+2;p<v+e;++p)u[l++]=t[p]}o&&u.length!=l&&(u.length=l)}(e,0,e.length,n,t,i,e),this.changed())}},{key:"scale",value:function(t,i,n){var e=i;void 0===e&&(e=t);var r=(r=n)||kr(this.getExtent()),i=this.getFlatCoordinates();i&&(n=this.getStride(),function(t,i,n,e,r,s,o,u){for(var h=u||[],a=o[0],c=o[1],f=0,l=i;l<n;l+=e){var v=t[l]-a,y=t[l+1]-c;h[f++]=a+r*v,h[f++]=c+s*y;for(var d=l+2;d<l+e;++d)h[f++]=t[d]}u&&h.length!=f&&(h.length=f)}(i,0,i.length,n,t,e,r,i),this.changed())}},{key:"translate",value:function(t,i){var n,e=this.getFlatCoordinates();e&&(n=this.getStride(),function(t,i,n,e,r,s,o){for(var u=o||[],h=0,a=i;a<n;a+=e){u[h++]=t[a]+r,u[h++]=t[a+1]+s;for(var c=a+2;c<a+e;++c)u[h++]=t[c]}o&&u.length!=h&&(u.length=h)}(e,0,e.length,n,t,i,e),this.changed())}}])&&lf(t.prototype,i),n&&lf(t,n),r}();function mf(t,i,n,e,r,s,o){var u,h,a,c=t[i],f=t[i+1],l=t[n]-c,v=t[n+1]-f;if(0==l&&0==v)u=i;else{var y=((r-c)*l+(s-f)*v)/(l*l+v*v);if(1<y)u=n;else{if(0<y){for(var d=0;d<e;++d)o[d]=(h=t[i+d],a=t[n+d],h+y*(a-h));return void(o.length=e)}u=i}}for(var p=0;p<e;++p)o[p]=t[u+p];o.length=e}function wf(t,i,n,e,r){var s=t[i],o=t[i+1];for(i+=e;i<n;i+=e){var u=t[i],h=t[i+1],a=Pr(s,o,u,h);r<a&&(r=a),s=u,o=h}return r}function gf(t,i,n,e,r){for(var s=0,o=n.length;s<o;++s){var u=n[s];r=wf(t,i,u,e,r),i=u}return r}function Mf(t,i,n,e,r,s,o,u,h,a,c){if(i==n)return a;var f,l;if(0===r){if((l=Pr(o,u,t[i],t[i+1]))<a){for(f=0;f<e;++f)h[f]=t[i+f];return h.length=e,l}return a}for(var v=c||[NaN,NaN],y=i+e;y<n;)if(mf(t,y-e,y,e,o,u,v),(l=Pr(o,u,v[0],v[1]))<a){for(a=l,f=0;f<e;++f)h[f]=v[f];y+=h.length=e}else y+=e*Math.max((Math.sqrt(l)-Math.sqrt(a))/r|0,1);if(s&&(mf(t,n-e,i,e,o,u,v),(l=Pr(o,u,v[0],v[1]))<a)){for(a=l,f=0;f<e;++f)h[f]=v[f];h.length=e}return a}function kf(t,i,n,e,r,s,o,u,h,a,c){for(var f=c||[NaN,NaN],l=0,v=n.length;l<v;++l){var y=n[l];a=Mf(t,i,y,e,r,s,o,u,h,a,f),i=y}return a}function Rf(t,i,n,e){for(var r=0,s=n.length;r<s;++r)for(var o=n[r],u=0;u<e;++u)t[i++]=o[u];return i}function Ef(t,i,n,e,r){for(var s=r||[],o=0,u=0,h=n.length;u<h;++u){var a=Rf(t,i,n[u],e);i=s[o++]=a}return s.length=o,s}function Of(t,i,n,e,r,s,o){var u=(n-i)/e;if(u<3){for(;i<n;i+=e)s[o++]=t[i],s[o++]=t[i+1];return o}var h=new Array(u);h[0]=1,h[u-1]=1;for(var a,c,f,l,v,y,d=[i,n-e],p=0;0<d.length;){for(var b=d.pop(),m=d.pop(),w=0,g=t[m],M=t[m+1],k=t[b],R=t[b+1],E=m+e;E<b;E+=e){var O=t[E],S=t[E+1],T=(a=O,c=S,y=v=l=void 0,y=(f=R)-(T=M),0==(v=(O=k)-(S=g))&&0==y||(1<(l=((a-S)*v+(c-T)*y)/(v*v+y*y))?(S=O,T=f):0<l&&(S+=v*l,T+=y*l)),Pr(a,c,S,T));w<T&&(p=E,w=T)}r<w&&(h[(p-i)/e]=1,m+e<p&&d.push(m,p),p+e<b&&d.push(p,b))}for(var A=0;A<u;++A)h[A]&&(s[o++]=t[i+A*e],s[o++]=t[i+A*e+1]);return o}function Sf(t,i){return i*Math.round(t/i)}function Tf(t,i,n,e,r,s,o,u){for(var h=0,a=n.length;h<a;++h){var c=n[h];o=function(t,i,n,e,r,s,o){if(i==n)return o;var u,h=Sf(t[i],r),a=Sf(t[i+1],r);i+=e,s[o++]=h,s[o++]=a;do{if(u=Sf(t[i],r),y=Sf(t[i+1],r),(i+=e)==n)return s[o++]=u,s[o++]=y,o}while(u==h&&y==a);for(;i<n;){var c,f,l,v,y,d=Sf(t[i],r),p=Sf(t[i+1],r);i+=e,d==u&&p==y||(u=((c=u-h)*(v=p-a)==(f=y-a)*(l=d-h)&&(c<0&&l<c||c==l||0<c&&c<l)&&(f<0&&v<f||f==v||0<f&&f<v)||(h=s[o++]=u,a=s[o++]=y),d),y=p)}return s[o++]=u,s[o++]=y,o}(t,i,c,e,r,s,o),u.push(o),i=c}return o}function Af(t,i,n,e,r){for(var s=void 0!==r?r:[],o=0,u=i;u<n;u+=e)s[o++]=t.slice(u,u+e);return s.length=o,s}function jf(t,i,n,e,r){for(var s=void 0!==r?r:[],o=0,u=0,h=n.length;u<h;++u){var a=n[u];s[o++]=Af(t,i,a,e,s[o]),i=a}return s.length=o,s}function xf(t,i,n,e){for(var r=0,s=t[n-e],o=t[n-e+1];i<n;i+=e){var u=t[i],h=t[i+1];r+=o*u-s*h,s=u,o=h}return r/2}function Cf(t,i,n,e){for(var r=0,s=0,o=n.length;s<o;++s){var u=n[s];r+=xf(t,i,u,e),i=u}return r}function If(t){return(If="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Pf(t,i){return(Pf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function _f(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Bf(n);return t=e?(t=Bf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==If(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Bf(t){return(Bf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ff=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Pf(t,i)}(r,bf);var t,i,n,e=_f(r);function r(t,i){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this)).maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(t[0])?n.setCoordinates(t,i):n.setFlatCoordinates(i,t),n}return t=r,(i=[{key:"clone",value:function(){return new r(this.flatCoordinates.slice(),this.layout)}},{key:"closestPointXY",value:function(t,i,n,e){return e<fr(this.getExtent(),t,i)?e:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(wf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Mf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,i,n,e))}},{key:"getArea",value:function(){return xf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getCoordinates",value:function(){return Af(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getSimplifiedGeometryInternal",value:function(t){var i=[];return i.length=Of(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new r(i,nf.XY)}},{key:"getType",value:function(){return Vu.LINEAR_RING}},{key:"intersectsExtent",value:function(t){return!1}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Rf(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&Lf(t.prototype,i),n&&Lf(t,n),r}();function Nf(t){return(Nf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Df(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Vf(t,i){return(Vf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Zf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=zf(n);return t=e?(t=zf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Nf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function zf(t){return(zf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Uf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Vf(t,i)}(r,bf);var t,i,n,e=Zf(r);function r(t,i){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this)).setCoordinates(t,i),n}return t=r,(i=[{key:"clone",value:function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,i,n,e){var r=this.flatCoordinates,i=Pr(t,i,r[0],r[1]);if(i<e){for(var s=this.stride,o=0;o<s;++o)n[o]=r[o];return n.length=s,i}return e}},{key:"getCoordinates",value:function(){return this.flatCoordinates?this.flatCoordinates.slice():[]}},{key:"computeExtent",value:function(t){return i=this.flatCoordinates,n=t,t=i[0],i=i[1],pr(t,i,t,i,n);var i,n}},{key:"getType",value:function(){return Vu.POINT}},{key:"intersectsExtent",value:function(t){return vr(t,this.flatCoordinates[0],this.flatCoordinates[1])}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,i,n){for(var e=0,r=n.length;e<r;++e)t[i++]=n[e];return i}(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&Df(t.prototype,i),n&&Df(t,n),r}();function Gf(i,n,e,r,t){var s,o;return!((t=(o=function(t){return!Yf(i,n,e,r,t[0],t[1])})(gr(s=t)))||((t=o(Mr(s)))||(t=o(Tr(s)))||!!(t=o(Sr(s))))&&t)}function Yf(t,i,n,e,r,s){for(var o=0,u=t[n-e],h=t[n-e+1];i<n;i+=e){var a=t[i],c=t[i+1];h<=s?s<c&&0<(a-u)*(s-h)-(r-u)*(c-h)&&o++:c<=s&&(a-u)*(s-h)-(r-u)*(c-h)<0&&o--,u=a,h=c}return 0!==o}function Hf(t,i,n,e,r,s){if(0===n.length)return!1;if(!Yf(t,i,n[0],e,r,s))return!1;for(var o=1,u=n.length;o<u;++o)if(Yf(t,n[o-1],n[o],e,r,s))return!1;return!0}function Xf(t,i,n,e,r,s,o){for(var u,h,a,c=r[s+1],f=[],l=0,v=n.length;l<v;++l)for(var y=n[l],d=t[y-e],p=t[y-e+1],b=i;b<y;b+=e)g=t[b],a=t[b+1],(c<=p&&a<=c||p<=c&&c<=a)&&f.push(h=(c-p)/(a-p)*(g-d)+d),d=g,p=a;var m=NaN,w=-1/0;for(f.sort(Fe),d=f[0],b=1,u=f.length;b<u;++b){var g=f[b],M=Math.abs(g-d);w<M&&Hf(t,i,n,e,h=(d+g)/2,c)&&(m=h,w=M),d=g}return isNaN(m)&&(m=r[s]),o?(o.push(m,c,w),o):[m,c,w]}function qf(t,i,n,e,v){var r,s,o=wr(dr(),t,i,n,e);return jr(v,o)&&(s=o,(r=v)[0]<=s[0]&&s[2]<=r[2]&&r[1]<=s[1]&&s[3]<=r[3]||(o[0]>=v[0]&&o[2]<=v[2]||(o[1]>=v[1]&&o[3]<=v[3]||function(t,i,n,e,r){var s;for(i+=e;i<n;i+=e)if(s=r(t.slice(i-e,i),t.slice(i,i+e)))return s;return}(t,i,n,e,function(t,i){return r=i,c=!1,f=yr(n=v,e=t),l=yr(n,r),f===cr.INTERSECTING||l===cr.INTERSECTING?c=!0:(s=n[0],o=n[1],u=n[2],i=n[3],t=e[0],n=e[1],e=r[0],t=((r=r[1])-n)/(e-t),(c=!(c=!(c=l&cr.ABOVE&&!(f&cr.ABOVE)?s<=(h=e-(r-i)/t)&&h<=u:c)&&l&cr.RIGHT&&!(f&cr.RIGHT)?o<=(a=r-(e-u)*t)&&a<=i:c)&&l&cr.BELOW&&!(f&cr.BELOW)?s<=(h=e-(r-o)/t)&&h<=u:c)||!(l&cr.LEFT)||f&cr.LEFT||(c=o<=(a=r-(e-s)*t)&&a<=i)),c;var n,e,r,s,o,u,h,a,c,f,l}))))}function Qf(t,i,n,e,r){if(s=t,o=i,u=n[0],!(qf(s,o,u,h=e,i=r)||(Yf(s,o,u,h,i[0],i[1])||(Yf(s,o,u,h,i[0],i[3])||(Yf(s,o,u,h,i[2],i[1])||!!Yf(s,o,u,h,i[2],i[3]))))))return!1;var s,o,u,h;if(1===n.length)return!0;for(var a=1,c=n.length;a<c;++a)if(Gf(t,n[a-1],n[a],e,r)&&!qf(t,n[a-1],n[a],e,r))return!1;return!0}function Wf(t,i,n,e){for(var r=0,s=t[n-e],o=t[n-e+1];i<n;i+=e){var u=t[i],h=t[i+1];r+=(u-s)*(h+o),s=u,o=h}return 0===r?void 0:0<r}function Kf(t,i,n,e,r){for(var s=void 0!==r&&r,o=0,u=n.length;o<u;++o){var h=n[o],a=Wf(t,i,h,e);if(0===o){if(s&&a||!s&&!a)return}else if(s&&!a||!s&&a)return;i=h}return 1}function Jf(t,i,n,e,r){for(var s=void 0!==r&&r,o=0,u=n.length;o<u;++o){var h=n[o],a=Wf(t,i,h,e);(0===o?s&&a||!s&&!a:s&&!a||!s&&a)&&function(t,i,n,e){for(;i<n-e;){for(var r=0;r<e;++r){var s=t[i+r];t[i+r]=t[n-e+r],t[n-e+r]=s}i+=e,n-=e}}(t,i,h,e),i=h}return i}function $f(t){return($f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function il(t,i){return(il=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function nl(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=el(n);return t=e?(t=el(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==$f(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function el(t){return(el=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var rl=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&il(t,i)}(s,bf);var t,i,n,r=nl(s);function s(t,i,n){var e;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),(e=r.call(this)).ends_=[],e.flatInteriorPointRevision_=-1,e.flatInteriorPoint_=null,e.maxDelta_=-1,e.maxDeltaRevision_=-1,e.orientedRevision_=-1,e.orientedFlatCoordinates_=null,void 0!==i&&n?(e.setFlatCoordinates(i,t),e.ends_=n):e.setCoordinates(t,i),e}return t=s,(i=[{key:"appendLinearRing",value:function(t){this.flatCoordinates?De(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}},{key:"clone",value:function(){var t=new s(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,i,n,e){return e<fr(this.getExtent(),t,i)?e:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gf(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),kf(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,i,n,e))}},{key:"containsXY",value:function(t,i){return Hf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,i)}},{key:"getArea",value:function(){return Cf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}},{key:"getCoordinates",value:function(t){var i;return void 0!==t?Jf(i=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):i=this.flatCoordinates,jf(i,0,this.ends_,this.stride)}},{key:"getEnds",value:function(){return this.ends_}},{key:"getFlatInteriorPoint",value:function(){var t;return this.flatInteriorPointRevision_!=this.getRevision()&&(t=kr(this.getExtent()),this.flatInteriorPoint_=Xf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()),this.flatInteriorPoint_}},{key:"getInteriorPoint",value:function(){return new Uf(this.getFlatInteriorPoint(),nf.XYM)}},{key:"getLinearRingCount",value:function(){return this.ends_.length}},{key:"getLinearRing",value:function(t){return t<0||this.ends_.length<=t?null:new Ff(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}},{key:"getLinearRings",value:function(){for(var t=this.layout,i=this.flatCoordinates,n=this.ends_,e=[],r=0,s=0,o=n.length;s<o;++s){var u=n[s],h=new Ff(i.slice(r,u),t);e.push(h),r=u}return e}},{key:"getOrientedFlatCoordinates",value:function(){var t;return this.orientedRevision_!=this.getRevision()&&(Kf(t=this.flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Jf(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()),this.orientedFlatCoordinates_}},{key:"getSimplifiedGeometryInternal",value:function(t){var i=[],n=[];return i.length=Tf(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new s(i,nf.XY,n)}},{key:"getType",value:function(){return Vu.POLYGON}},{key:"intersectsExtent",value:function(t){return Qf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);t=Ef(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===t.length?0:t[t.length-1],this.changed()}}])&&tl(t.prototype,i),n&&tl(t,n),s}();function sl(t){var i=t[0],n=t[1],e=t[2],t=t[3],n=[i,n,i,t,e,t,e,n,i,n];return new rl(n,nf.XY,[n.length])}function ol(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.Te=void 0!==(t=t||{}).width?t.width:2500,this.Ae=void 0!==t.length?t.length:2500,this.je=void 0!==t.offset?t.offset:1,this.xe=void 0===t.visible||t.visible,this.Di=void 0!==t.mode?t.mode:Ie.AMAP_VECTOR,this.Ce=.4*this.Te,this.Ie=.9*this.Te,this.Le=null,this.Pe=new wi,this.Pe.background=new Ri(13426943),this.Pe.fog=new Ti(13426943,this.Ce,this.Ie),this._e=new Pe,this.Pe.add(this._e),this.Be=new je,this.Fe=null,this.Ne=this.je,this.De=null,this.Ve=new zn(new Gt(0,1,0),0),this.Ze=!1,this.ze=this.ze.bind(this),this.Ue=this.Ue.bind(this),this.Ge=[]}var t,n,e;return t=i,(n=[{key:"visible",get:function(){return this.xe},set:function(t){this.xe=t,this.Pe.visible=this.xe,this.Fe.enableUpdateRender()}},{key:"addTo",value:function(t){this.Fe=t,this.Fe.getRenderManager().setTileLayScene(this.Pe),this.Ne=this.Fe.getFloor(this.Fe.getVisibleLevels()[0]).height-this.je,this.R(),t.enableUpdateRender()}},{key:"remove",value:function(){this.dispose(),this.Fe.off("resize",this.ze),this.Fe.off("viewChanged",this.ze),this.Fe.off("viewModeChanged",this.Ue),this.Fe.off("visibleLevelsLoaded",this.ze),this.Fe.off("zoom",this.ze),this.Fe=null,this.Ze=!1}},{key:"dispose",value:function(){this.De&&this.De.dispose(),this.De=null;for(var t=0;t<this.Ge.length;t++)this.Ge[t].parent&&this.Ge[t].parent.remove(this.Ge[t]);this._e.parent&&this._e.parent.remove(this._e),this.Ge.length=0,this.Fe.getRenderManager().setTileLayScene(void 0),this.Fe.enableUpdateRender()}}])&&ol(t.prototype,n),e&&ol(t,e),i}();Object.assign(e.prototype,{R:function(){var t;this.Ze||(this.Le=this.Fe.getContainer(),this.De=this.Ye(),this.He(),this.Fe.camera.far=1e3*Le.CAMERA_FAR,this.Fe.camera.updateProjectionMatrix(),(t=this.Fe.getZoomRange())[0]<5&&(t=[5,t[1]],this.Fe.setZoomRange(t)),this.Fe.on("resize",this.ze),this.Fe.on("viewChanged",this.ze),this.Fe.on("viewModeChanged",this.Ue),this.Fe.on("visibleLevelsLoaded",this.ze),this.Fe.on("zoom",this.ze),this.Ze=!0)},ze:function(t){"viewChanged"===t.type?this.He(t):"visibleLevelsLoaded"===t.type?this.Xe():"zoom"===t.type&&this.He()},Se:function(t){if(0!==this.Ge.length)for(var r=this,i=0;i<t.length;i++){var n,e=function(t){for(var i=null,n=0;n<r.Ge.length;n++){var e=r.Ge[n].imageinfo;if(t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h&&!r.Ge[n].isCovered){i=r.Ge[n];break}}return i}(t[i]);null!==e&&((n=new _n({map:new Nn(function(t,i){var n=document.createElement("canvas");n.width=256,n.height=256;var e=n.getContext("2d");return e.drawImage(t,0,0,256,256),e.drawImage(i,0,0,256,256),n}(e.imageinfo.image,t[i].image))})).polygonOffset=!0,n.polygonOffsetFactor=1,n.polygonOffsetUnits=4,n.map.minFilter=nn,n.needsUpdate=!0,e.material=n,e.isCovered=!0)}},Oe:function(t){var i,n,e;this.Fe&&(this.qe(t),e=1,i=this.Fe.getContainer().clientWidth,n=this.Fe.getContainer().clientHeight,t=Math.max(i,n)/Math.min(i,n),"OrthographicCamera"===(i=this.Fe.camera).type?(e=1/i.zoom*t,this.Pe.fog.near=1e4*this.Ce,this.Pe.fog.far=1e4*this.Ie):(e=(n=this.Be.ray.distanceToPlane(this.Ve))*Math.tan(i.fov*Le.DEG2RAD/2)*2*t/(this.Te/2),t<1.5&&(t=1.5),t=n*Math.tan(i.fov*Le.DEG2RAD/2)*2*t/(this.Te/2),this.Pe.fog.near=this.Ce*t,this.Pe.fog.far=this.Ie*t),this._e.scale.set(e,e,e),this.Fe.getRenderManager().render())},qe:function(t){for(var i=0;i<this.Ge.length;i++)this.Ge[i].visible=!1;if(0===this.Ge.length)for(var n=0;n<t.length;n++){var e=new In(256,256),r=new _n({map:new Nn(m(t[n].image))});r.polygonOffset=!0,r.polygonOffsetFactor=1,r.polygonOffsetUnits=4;r=new Se(e,r);r.material.map.minFilter=nn,r.material.needsUpdate=!0,r.src=t[n].image.src,r.imageinfo=t[n],r.scale.set(t[n].w/256,t[n].h/256,1),r.position.x=t[n].x+t[n].w/2-this.Te/2,r.position.z=t[n].y+t[n].h/2-this.Ae/2,r.rotation.x=-Math.PI/2,this._e.add(r),this.Ge.push(r)}else{for(var s=[],o=[],u=0;u<t.length;u++){var h,a=function(t,i){for(var n=null,e=0;e<t.length;e++)if(t[e].src===i){n=e;break}return n}(this.Ge,t[u].image.src);null!==a&&((h=this.Ge[a]).scale.set(t[u].w/256,t[u].h/256,1),h.imageinfo=t[u],h.position.x=t[u].x+t[u].w/2-this.Te/2,h.position.z=t[u].y+t[u].h/2-this.Ae/2,h.visible=!0,s.push(h),this.Ge.splice(a,1),o.push(u))}t=b(o,t);for(var c=o.length=0;c<t.length&&0!==this.Ge.length;c++){var f=this.Ge.splice(0,1)[0];f.material.map.dispose(),f.material.dispose();var l=new _n({map:new Nn(m(t[c].image))});l.polygonOffset=!0,l.polygonOffsetFactor=1,l.polygonOffsetUnits=4,l.map.minFilter=nn,l.needsUpdate=!0,f.material=l,f.scale.set(t[c].w/256,t[c].h/256,1),f.position.x=t[c].x+t[c].w/2-this.Te/2,f.position.z=t[c].y+t[c].h/2-this.Ae/2,f.src=t[c].image.src,f.imageinfo=t[c],f.visible=!0,s.push(f),o.push(c)}t=b(o,t);for(var v=0;v<t.length;v++){var y=new In(256,256),d=new _n({map:new Nn(m(t[v].image))});d.polygonOffset=!0,d.polygonOffsetFactor=1,d.polygonOffsetUnits=4;d=new Se(y,d);d.material.map.minFilter=nn,d.material.needsUpdate=!0,d.src=t[v].image.src,d.scale.set(t[v].w/256,t[v].h/256,1),d.position.x=t[v].x+t[v].w/2-this.Te/2,d.position.z=t[v].y+t[v].h/2-this.Ae/2,d.rotation.x=-Math.PI/2,d.imageinfo=t[v],this._e.add(d),s.push(d)}if(0<this.Ge.length){for(var p=0;p<this.Ge.length;p++)this.Ge[p].parent&&this.Ge[p].parent.remove(this.Ge[p]);this.Ge.length=0}this.Ge=s}function b(t,i){for(var n=[],e=0;e<i.length;e++)!function(t,i){for(var n=!0,e=0;e<t.length;e++)if(t[e]===i){n=!1;break}return n}(t,e)||n.push(i[e]);return n}function m(t){var i=document.createElement("canvas");return i.width=256,i.height=256,i.getContext("2d").drawImage(t,0,0,256,256),i}this._e.position.y=this.Ne},Ye:function(){var e=this,t=Hu("EPSG:3857");if(this.Di===Ie.AMAP_SATELLITE||this.Di===Ie.AMAP_VECTOR){var i={url:this.Qe(),crossOrigin:"anonymous",maxZoom:19,thirdMap:this};this.Di===Ie.AMAP_SATELLITE&&(i.maxZoom=18),s=new sc(i)}else if(this.Di===Ie.BAIDU_VECTOR||this.Di===Ie.BAIDU_SATELLITE){for(var n=[],r=0;r<19;r++)n[r]=Math.pow(2,18-r);var i=new Sa({origin:[0,0],resolutions:n}),s=new tc({projection:t,crossOrigin:"anonymous",tileGrid:i,tileUrlFunction:function(t){if(!t)return"";var i=t[0],n=t[1],t=-t[2]-1;return e.We(n=n<0?"M"+-n:n,t=t<0?"M"+-t:t,i)}})}else this.Di===Ie.OSM?s=new fc:(s=new sc({url:this.Ke()[0],crossOrigin:"anonymous",tileSize:[512,512],maxZoom:18}),o=new sc({url:this.Ke()[1],crossOrigin:"anonymous",tileSize:[512,512],maxZoom:18}));s=new Nh({size:[this.Te,this.Ae],view:new kh({projection:t}),layers:[new tf({layercount:1,source:s,thirdMap:this}),new tf({layercount:2,source:o,thirdMap:this})]});s.setTarget(this.Le);var o=sl([this.Fe.x-this.Te/4,(this.Fe.y-this.Ne)/4,this.Fe.x+this.Te/4,this.Fe.y+this.Ne/4]);return s.getView().fit(o),s},Qe:function(){var t;switch(this.Di){case Ie.AMAP_SATELLITE:t="http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=6&x={x}&y={y}&z={z}";break;case Ie.AMAP_VECTOR:default:t="https://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=2&style=7&x={x}&y={y}&z={z}"}return t},We:function(t,i,n){var e;switch(this.Di){case Ie.BAIDU_SATELLITE:e="https://gss0.bdstatic.com/5bwHcj7lABFY8t_jkk_Z1zRvfdw6buu/it/u=x="+t+";y="+i+";z="+n+";v=009;type=sate&fm=46&udt=20210415&scaler=2";break;case Ie.BAIDU_VECTOR:default:e="https://maponline"+parseInt(4*Math.random())+".bdimg.com/tile/?qt=vtile&x="+t+"&y="+i+"&z="+n+"&styles=pl&scaler=2&udt=20210415&from=jsapi2_0&scaler=2"}return e},Ke:function(){var t;switch(this.Di){case Ie.TD_SATELLITE:(t=[]).push("http://t{0-7}.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&Layer=img&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=9a8b557e9db74e442bd9544001392255"),t.push("https://t{0-7}.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=9a8b557e9db74e442bd9544001392255");break;case Ie.TD_VECTOR:default:(t=[]).push("http://t{0-7}.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&Layer=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=9a8b557e9db74e442bd9544001392255"),t.push("https://t{0-7}.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=9a8b557e9db74e442bd9544001392255")}return t},Je:function(){this.$e.setSize(this.Fe.getContainer().clientWidth,this.Fe.getContainer().clientHeight)},Ue:function(){var t=this.Fe.camera,i=this.Fe.getContainer().clientWidth,n=this.Fe.getContainer().clientHeight,n=Math.max(i,n)/Math.min(i,n);t.far===Le.CAMERA_FAR&&(t.far=1e3*Le.CAMERA_FAR,t.updateProjectionMatrix()),"OrthographicCamera"===t.type?(this.Pe.fog.near=1e4*this.Ce,this.Pe.fog.far=1e4*this.Ie):(n<1.5&&(n=1.5),n=this.Be.ray.distanceToPlane(this.Ve)*Math.tan(t.fov*Le.DEG2RAD/2)*2*n/(this.Te/2),this.Pe.fog.near=this.Ce*n,this.Pe.fog.far=this.Ie*n)},He:function(t){var i,n,e,r;this.tr&&t&&t.target&&t.target.target&&t.target.target.x===this.tr.x&&t.target.target.z===this.tr.z||(t&&t.target&&t.target.target&&(this.tr={x:t.target.target.x,y:t.target.target.y,z:t.target.target.z}),e=new Gt(0,0,.5),n=this.Fe.camera,this.Be.setFromCamera(e,n),i=new Gt,this.Be.ray.intersectPlane(this.Ve,i),r=1,t=this.Fe.getContainer().clientWidth,e=this.Fe.getContainer().clientHeight,e=Math.max(t,e)/Math.min(t,e),r="OrthographicCamera"===n.type?1/n.zoom*e:this.Be.ray.distanceToPlane(this.Ve)*Math.tan(n.fov*Le.DEG2RAD/2)*2*e/(this.Te/2),n=i.x+this.Fe.x,e=-i.z+this.Fe.y,r=this.Te/2*r,this._e.position.x=i.x,this._e.position.z=i.z,r=sl([n-r,e-r,n+r,e+r]),this.De.getView().fit(r))},Xe:function(){this.Ne=this.Fe.getFloor(this.Fe.getVisibleLevels()[0]).height-this.je,this._e.position.y=this.Ne}});var z=e,ul={Default:1,Legacy:2,Classic:4,Custom:8};function hl(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function al(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}n=function(){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);this.ir=t,this.nr=i,this.er=(hl(i={},ul.Default,{FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]}),hl(i,ul.Legacy,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}),hl(i,ul.Classic,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:.9,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.33,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}),i)}var t,i,e;return t=n,(i=[{key:"getConfig",value:function(){return this.ir==ul.Custom?this.nr:this.er[this.ir]}}])&&al(t.prototype,i),e&&al(t,e),n}();function cl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.rr=t=t||{},this.sr=40,void 0!==t.maxWidth&&(this.sr=t.minWidth),this.or=100,void 0!==t.maxWidth&&(this.or=t.maxWidth),(this.Ne=void 0)!==t.height&&(this.Ne=t.height),(this.ur=void 0)!==t.fontSize&&(this.ur=t.fontSize),(this.hr=void 0)!==t.position&&(this.hr=t.position),this.u=null,this.T=null,this.ar=[1e7,5e6,2e6,1e6,5e5,2e5,1e5,5e4,25e3,2e4,1e4,5e3,2e3,1e3,500,200,100,50,20,10,5,2,1,.5,.2,.1,.05,.02,.01],this.cr=this.cr.bind(this)}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.R()}},{key:"remove",value:function(){this.u.off("zoom",this.cr),this.u.getContainer().removeChild(this.T)}}])&&cl(t.prototype,n),e&&cl(t,e),i}();Object.assign(e.prototype,{R:function(){this.T=document.createElement("div"),this.T.classList.add("fm-control-scale-bar-contain"),this.T.style.width=this.sr+"px",void 0!==this.Ne&&(this.T.style.height=this.Ne+"px"),this.T.style.zIndex=20,void 0===this.hr&&void 0===this.rr.offset||this.fr(this.hr,this.rr.offset,this.T),this.u.getContainer().appendChild(this.T);var t=document.createElement("div");t.setAttribute("id","ruleWord"),t.classList.add("fm-control-scale-bar-text"),void 0!==this.ur&&(t.style.fontSize=this.ur+"px"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-left1"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-left2"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-right1"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-right2"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-bottom1"),this.T.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-bottom2"),this.T.appendChild(t),this.cr(),this.u.on("zoom",this.cr)},fr:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px";break;case l.RIGHT_TOP:n.style.right=-(i=i||{x:-10,y:10}).x+"px",n.style.top=i.y+"px";break;case l.LEFT_BOTTOM:n.style.left=(i=i||{x:10,y:-10}).x+"px",n.style.bottom=-i.y+"px";break;case l.RIGHT_BOTTOM:n.style.right=-(i=i||{x:-10,y:-10}).x+"px",n.style.bottom=-i.y+"px";break;default:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px"}},cr:function(t){var i={x:document.body.clientWidth/2,y:document.body.clientHeight/2},n={x:i.x+100,y:i.y},i=fengmap.FMUtil.coordsScreenToMap(this.u,i),n=fengmap.FMUtil.coordsScreenToMap(this.u,n),i=Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y))/100,n=this.ar[Math.floor(this.u.getZoom())-1];this.T.style.width=n/i+"px";i="",i=n<1e3&&1<=n?n+"米":n<1?1e3*n+"毫米":n/1e3+"公里";document.getElementById("ruleWord").innerHTML=i}});var fl,e=e,ll=window.fengmap||{},vl={FMCompass:s,FMControlPosition:l,FMZoomControl:f,FMToolbar:k};for(fl in vl)ll[fl]=vl[fl];var yl,dl={FMNaviMode:R,FMNaviPriority:E,FMLanguageType:O,FMNavigation:v,FMNavigationDrive:S,FMNavigationWalk:B};for(yl in dl)ll[yl]=dl[yl];ll.FMTileLayer=z,ll.FMTileProvider=Ie,ll.FMLight=n,ll.FMLightMode=ul,ll.FMScaleBar=e,window.fengmap=ll;i.default=ll}],r.c=e,r.d=function(t,i,n){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"lr",{value:!0})},r.t=function(i,t){if(1&t&&(i=r(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.lr)return i;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var e in i)r.d(n,e,function(t){return i[t]}.bind(null,e));return n},r.n=function(t){var i=t&&t.lr?function(){return t.default}:function(){return t};return r.d(i,"a",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p="",r(r.s=0).default;function r(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return n[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}var n,e});