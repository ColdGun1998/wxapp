!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.fftUtil=e():t.fftUtil=e()}(this,(function(){return function(){"use strict";var t={899:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(694),i=s(a(639)),r=s(a(339)),l=s(a(302)),o=s(a(29));function s(t){return t&&t.__esModule?t:{default:t}}function u(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function f(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var m=a(924),g=[],v=null,p=[],d=[[],[],[],[],[],[],[]],y=[[],[],[],[],[]],b=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,"SAMPLE_RATE_INHZ",48e3),c(this,"vMaxTh",0),c(this,"vRatioTh",.3),c(this,"pMaxTh",2e3),c(this,"maxRatioTh",0),c(this,"totalLength",9.85),c(this,"timeIntervals",[.15]),c(this,"soundSpeed",340),c(this,"frequencyStart",17e3),c(this,"frequencyEnd",19e3),c(this,"durationTime",.03),c(this,"timeInterval",.15),c(this,"signalMax",-100),c(this,"allTdoaInfos",[]),c(this,"preSoundInputBean",null),c(this,"dataQueue",[]),c(this,"lastFrame",null),c(this,"frameSequence",0),c(this,"signalRef",null),c(this,"singalRefFFt",null),c(this,"lngStart",120.0006),c(this,"lngEnd",120.0007),c(this,"latStart",30.0006),c(this,"latEnd",30.0007),c(this,"timeInterval",.15),c(this,"height",5),c(this,"clusterId",null),this.clusterId=e}var e,a,s;return e=t,s=[{key:"getSingleLeftFromArrayStatic",value:function(t){for(var e=new DataView(t),a=[],n=Math.floor(t.byteLength/4),i=0;i<n;i++){var r=e.getInt16(4*i,!0)/32768;a.push(r)}return a}},{key:"getSingleLeftFromList",value:function(t){for(var e=new Int8Array(t).buffer,a=new DataView(e),n=[],i=Math.floor(e.byteLength/4),r=0;r<i;r++){var l=a.getInt16(4*r,!0)/32768;n.push(l)}return n}},{key:"getSingleFromList",value:function(t){for(var e=new Int8Array(t).buffer,a=new DataView(e),n=[],i=Math.floor(e.byteLength/2),r=0;r<i;r++){var l=a.getInt16(2*r,!0)/32768;n.push(l)}return n}},{key:"calculateDistanceThreeBeaconOrigin",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.145,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.145,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8,l=[],o=[];return t.forEach((function(t){t.tdoa&&t.tdoa>0&&g.push(t.tdoa)})),e.forEach((function(t){t.tdoa&&t.tdoa>0&&g.forEach((function(e){if(e<t.tdoa&&t.tdoa-e<.35){console.log("第一组基站间隔",t.tdoa,e,t.tdoa-e);var s=i+340*(a-(t.tdoa-e))/2;console.log("第一组基站测距",0+s),l.push(s)}if(e>t.tdoa&&e-t.tdoa<.35){console.log("第二组基站间隔",e,t.tdoa,e-t.tdoa);var u=r+340*(n-(e-t.tdoa))/2;console.log("时间${startTime + x.tdoa * 1000}, 第二组基站测距 ${8 + distance2}"),o.push(u)}}))})),p&&p.forEach((function(t){t.tdoa&&t.tdoa>0&&g.forEach((function(e){if(e>t.tdoa&&e-t.tdoa<.35){console.log("第二组基站间隔",e,t.tdoa,e-t.tdoa);var a=r+340*(n-(e-t.tdoa))/2;console.log("时间${startTime + x.tdoa * 1000}, 第二组基站测距 ${8 + distance2}"),o.push(a)}}))})),p.push.apply(p,e.filter((function(t){return t.tdoa&&t.tdoa>0}))),p.length>=2&&p.splice(0,p.length-1),g.length>100&&g.splice(0,g.length/2),{distances1:l,distances2:o}}},{key:"calculateDistanceThreeBeacon",value:function(e,a,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=n.timeInterval,o=i.timeInterval,s=n.totalLength,u=i.totalLength,h=[],f=[];e.forEach((function(t){t.tdoa&&t.tdoa>0&&g.push(t.tdoa)})),a.forEach((function(e){e.tdoa&&e.tdoa>0&&g.forEach((function(a){if(a<e.tdoa&&e.tdoa-a<.28){console.log("第一组基站间隔",e.tdoa,a,e.tdoa-a);var c=null;0==r?c=(s+340*(l-(e.tdoa-a)))/2:1==r&&(c=t.getDistanceWithHeight(e.tdoa-a,n.height?n.height:5,s||15,l,.1)),h.push(c)}if(.04<a-e.tdoa&&a-e.tdoa<.28){console.log("第二组基站间隔",a,e.tdoa,a-e.tdoa);var m=null;0==r?m=(u+340*(o-(a-e.tdoa)))/2:1==r&&(m=t.getDistanceWithHeight(a-e.tdoa,i.height?i.height:5,u||15,o,.1)),f.push(m)}}))}));var c=!1;return p&&p.forEach((function(e){e.tdoa&&e.tdoa>0&&g.forEach((function(a){if((a-e.tdoa>.28||.04>a-e.tdoa)&&(c=!0),.04<a-e.tdoa&&a-e.tdoa<.28){c=!0,console.log("第二组基站间隔",a,e.tdoa,a-e.tdoa);var n=null;0==r?n=(u+340*(o-(a-e.tdoa)))/2:1==r&&(n=t.getDistanceWithHeight(a-e.tdoa,i.height?i.height:5,u||15,o,.1)),f.push(n)}}))})),c&&(p=[]),p.push.apply(p,a.filter((function(t){return t.tdoa&&t.tdoa>0}))),g.length>100&&g.splice(0,g.length/2),{distances1:h,distances2:f}}},{key:"getDistanceWithHeight",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.15,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,r=340*n-340*t,l=null,o=1e6,s=0;s<=a;s+=i){var u=Math.sqrt(s*s+e*e)-Math.sqrt((a-s)*(a-s)+e*e);Math.abs(u-r)<o&&(l=s,o=Math.abs(u-r))}return l}},{key:"calculateLocation",value:function(e,a){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=e&&0!=e.length){var r=null;(n=d[i]).push.apply(n,u(e));for(var l=d[i][d[i].length-1];l-d[i][0]>a.period;)d[i].splice(0,1);if(!(d[i].length<a.beaconsLocation.length)){for(var o=!0,s=new Array(a.beaconsLocation.length).fill(0),h=0;h<a.beaconsLocation.length;h++){var f=l-d[i][d[i].length-1-h]-h*a.interval;if(!(Math.abs(f)<30/340)){o=!1;break}s[s.length-1-h]=340*-f}return o&&(d[i]=[],r=t.locate(s,a)),r}}}},{key:"calculateLocationYanjiuyuan",value:function(e,a){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=e&&0!=e.length){var r=null;(n=d[i]).push.apply(n,u(e));for(var l=d[i][d[i].length-1];l-d[i][0]>a.period;)d[i].splice(0,1);if(!(d[i].length<a.beaconsLocation.length)){for(var o=!0,s=new Array(a.beaconsLocation.length).fill(0),h=0;h<a.beaconsLocation.length;h++){var f=l-d[i][d[i].length-1-h]-h*(null==a?void 0:a.timeIntervals[h]);if(!(Math.abs(f)<30/340)){o=!1;break}s[s.length-1-h]=340*-f}var c=d[i];return o&&(d[i]=[],r=t.locate(s,a)),{mleResult:r,tdoas:c}}}}},{key:"locate",value:function(e,a){return t.MLE(e,a)}},{key:"calculateLocationC64",value:function(e,a){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=e&&0!=e.length){var r=null;(n=d[i]).push.apply(n,u(e));for(var l=d[i][d[i].length-1];l-d[i][0]>a.period;)d[i].splice(0,1);if(!(d[i].length<a.beaconsLocation.length)){for(var o=!0,s=new Array(a.beaconsLocation.length).fill(0),h=0;h<a.beaconsLocation.length;h++){var f=l-d[i][d[i].length-1-h]-h*a.interval;if(console.log("Time Difference: ",l,d[i][d[i].length-1-h],f),!(Math.abs(f)<30/340)){o=!1;break}s[s.length-1-h]=340*-f}if(o){var c=d[i];d[i]=[],(r=t.locateC64(s,a,c)).push(c)}return r}}}},{key:"calculateLocationC64New",value:function(e,a){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=e&&0!=e.length){var r=null;(n=d[i]).push.apply(n,u(e));for(var l=d[i][d[i].length-1];l-d[i][0]>a.period;)d[i].splice(0,1);if(!(d[i].length<a.beaconsLocation.length)){for(var o=!0,s=new Array(a.beaconsLocation.length).fill(0),h=0;h<a.beaconsLocation.length;h++){var f=l-d[i][d[i].length-1-h]-h*a.interval;if(!(Math.abs(f)<30/340)){o=!1;break}s[s.length-1-h]=340*-f}if(o){var c=d[i];d[i]=[],(r=t.locateC64New(s,a,c)).push(c)}return r}}}},{key:"calculateLocationWithOneDimension",value:function(e,a){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!=e&&0!=e.length){var r=null;(n=d[i]).push.apply(n,u(e));for(var l=d[i][d[i].length-1];l-d[i][0]>a.period;)d[i].splice(0,1);if(!(d[i].length<a.beaconsLocation.length)){for(var o=!0,s=new Array(a.beaconsLocation.length).fill(0),h=0;h<a.beaconsLocation.length;h++){var f=l-d[i][d[i].length-1-h]-h*a.interval;if(console.log("Time Difference: ",l,d[i][d[i].length-1-h],f),!(Math.abs(f)<30/340)){o=!1;break}s[s.length-1-h]=340*-f}if(o&&(d[i]=[],r=t.locate(s,a),a.lastCoordinate&&t.calculateTwoPointDistance(r,a.lastCoordinate)>2.25)){for(var c=null,m=t.cmn(s,3),g=t.cmn(a.locations,3),v=0;v<m.length;v++){var p=m[v],y=JSON.parse(JSON.stringify(a));y.locations=g[v],y.precision=.3;var b=t.MLE(p,y);c?c[3]>b[3]&&(c=b):c=b}console.log("三基站定位mleResultMin",c),r=c}return r}}}},{key:"calculateLocationCangKu",value:function(t,e){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;console.log(n,inedex,t),(a=y[n]).push.apply(a,u(t));var i=[];if(y[n].length<2)console.log("timeQueueList_cangku[index] 长度小于2， 直接返回");else for(var r=1;r<y[n].length;r++)y[n][r].tdoa-y[n][r-1].tdoa<=this.timeInterval+.1&&y[n][r].tdoa-y[n][r-1].tdoa>=.05&&(i.push(y[n][r].tdoa-y[n][r-1].tdoa),y[n].splice(r-1,2),r-=1)}},{key:"calcualteLocationWithPoints",value:function(t,e){}},{key:"cmn",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=e.length;if(!(n+a>l)){for(var o=n;o<l;o++){if(1===a){r.push([].concat(u(i),[e[o]])),o+1<l&&t.cmn(e,a,o+1,i,r);break}t.cmn(e,a-1,o+1,[].concat(u(i),[e[o]]),r)}return r}}},{key:"locateC64",value:function(e,a){var n=null,i=null,r=null,l=t.cmn(e,4),o=t.cmn(a.locations,4);if(l.length!=o.length)return console.log("基站个数与信号数量不符合"),null;for(var s=0;s<l.length;s++){var u=l[s],h=JSON.parse(JSON.stringify(a));h.locations=o[s],h.precision=.3;var f=t.MLE(u,h);n?n[3]>f[3]&&(n=f,i=u,r=h):(n=f,i=u,r=h)}return console.log("settingsindex",r),null!=i&&(r.precision=a.precision,n=t.MLE(i,r)),console.log("mleResultMin",n),n}},{key:"getTDOAInfoWithListlocateC64New",value:function(e,a,n){var i=null,r=null,l=null,o=Math.max(a.locations.length-1,4),s=t.cmn(a.locations,o),u=t.cmn(n,o),h=new Array(a.locations.length).fill(0).map((function(t,e){return e})),f=t.cmn(h,o);if(f.length!=s.length)return console.log("基站个数与信号数量不符合"),null;for(var c=0;c<s.length;c++){var m=new Array(s[c].length).fill(0),g=JSON.parse(JSON.stringify(a));g.locations=s[c],g.beaconsLocation=s[c];for(var v=u[c],p=v[v.length-1],d=f[c],y=0;y<g.beaconsLocation.length;y++){var b=p-v[y]-(d[d.length-1]-d[y])*a.interval;if(!(Math.abs(b)<30/340))break;m[y]=340*-b}g.precision=.3;var _=t.MLE(m,g);i?i[3]>_[3]&&(i=_,r=m,l=g):(i=_,r=m,l=g)}return console.log("settingsindex",l),null!=r&&(l.precision=a.precision,i=t.MLE(r,l)),console.log("mleResultMin",i),i}},{key:"getTwoPointDistance",value:function(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}},{key:"MLE",value:function(e,a){var n,i,r,l=1e100,o=0,s=0,u=0,h=new Array(3),f=new Array(3);f[0]=a.xRange[1]-a.xRange[0],f[1]=a.yRange[1]-a.yRange[0],f[2]=a.zRange[1]-a.zRange[0],1==a.acousticMapLimitFlag&&(f[0]=0,f[1]=0,f[2]=0);for(var c=a.xRange[0]-f[0];c<=a.xRange[1]+f[0];c+=a.precision)for(var m=a.yRange[0]-f[1];m<=a.yRange[1]+f[1];m+=a.precision)for(var g=a.zRange[0]-f[2];g<=a.zRange[1]+f[2];g+=a.precision)if(!(a.lastCoordinate&&(c-a.lastCoordinate[0])*(c-a.lastCoordinate[0])+(m-a.lastCoordinate[1])*(m-a.lastCoordinate[1])+(g-a.lastCoordinate[2])*(g-a.lastCoordinate[2])>a.radius*a.radius)&&(null==a.limitPoly||0==a.limitPoly.length||t.PointInPoly([c,m],a.limitPoly))){h[0]=a.locations[0][0]-c,h[0]*=h[0],h[1]=a.locations[0][1]-m,h[1]*=h[1],h[2]=a.locations[0][2]-1.2,h[2]*=h[2],i=Math.sqrt(h[0]+h[1]+h[2]),n=0;for(var v=0;v<e.length-1;v++)h[0]=a.locations[v+1][0]-c,h[0]*=h[0],h[1]=a.locations[v+1][1]-m,h[1]*=h[1],h[2]=a.locations[v+1][2]-1.2,h[2]*=h[2],r=Math.sqrt(h[0]+h[1]+h[2])-i-(e[v+1]-e[0]),n+=r*=r;n<l&&(o=c,s=m,u=g,l=n)}return[o,s,u,l/e.length]}},{key:"calculateCoordinate",value:function(t,e,a,n,i){var r={lng:-1,lat:-1},l=t+(e-t)*i,o=a+(n-a)*i;return r.lng=l,r.lat=o,r}},{key:"distanceOfPointAndLine",value:function(t,e,a,n,i,r){var l=Math.abs(Math.sqrt(Math.pow(t-a,2)+Math.pow(e-n,2))),o=Math.abs(Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))),s=Math.abs(Math.sqrt(Math.pow(a-i,2)+Math.pow(n-r,2))),u=(l+o+s)/2;return 2*Math.abs(Math.sqrt(u*(u-l)*(u-o)*(u-s)))/s}},{key:"getTwoNearPointInPoly",value:function(e,a){for(var n=1e6,i=null,r=-1,l=a.length,o=l-1;++r<l;o=r){var s=t.distanceOfPointAndLine(e[0],e[1],a[r][0],a[r][1],a[o][0],a[o][1]);n>s&&(e[0]<=Math.max(a[r][0],a[o][0])&&e[0]>Math.min(a[r][0],a[o][0])||e[1]<=Math.max(a[r][1],a[o][1])&&e[1]>Math.min(a[r][1],a[o][1]))&&(n=s,i=[r,o,s])}return i}},{key:"FIRFilter",value:function(t,e){if(null==t||0==t.length)return console.log("filter signal为空"),t.slice(0);if(null==e||0==e.length)return console.log("filterParams为空"),t.slice(0);for(var a=new Array(e.length).fill(0),n=new Array(t.length).fill(0),i=0;i<t.length;i++){for(var r=a.length-1;r>0;r--)a[r]=a[r-1];a[0]=t[i];for(var l=0,o=0;o<e.length;o++)l+=e[o]*a[o];n[i]=l}return n}},{key:"createBandPassFilter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:48e3,e=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=(n+a)/2,l=Math.abs(n-a),o=new r.default;return o.bandPass(e,t,i,l,1),o}},{key:"PointInPoly",value:function(t,e){for(var a=!1,n=-1,i=e.length,r=i-1;++n<i;r=n)(e[n][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[r][0]-e[n][0])*(t[1]-e[n][1])/(e[r][1]-e[n][1])+e[n][0]&&(a=!a);return a}},{key:"calculateTwoPointDistance",value:function(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}},{key:"getPdr",value:function(){return l.default}},{key:"getFuse",value:function(){return o.default}},{key:"getKalmanFilter",value:function(){return o.default.makeKalmanFilter()}}],(a=[{key:"clear",value:function(){this.preSoundInputBean=null,this.signalMax=-100,this.dataQueue=[],this.lastFrame=null,this.frameSequence=0,this.signalRef=null,this.allTdoaInfos=[],g=[],v=null,p=[],i.default.clear(),d=[[],[],[],[],[]]}},{key:"generateSignalRef",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:17e3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:19e3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048/48e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48e3,r=(e-t)/a/2,l=[],o=1/i,s=0;s<a*i&&s<n.SIGNAL_LENGTH/2;s++)l.push(Math.cos(2*Math.PI*(t+r*o*s)*o*s));for(var u=n.SIGNAL_LENGTH-l.length,h=0;h<u;h++)l.push(0);return this.signalRef=l,l}},{key:"getInt16FromArray",value:function(t){for(var e=new DataView(t),a=[],n=Math.floor(t.byteLength/4),i=0;i<n;i=i++){var r=e.getInt16(4*i,!0),l=e.getInt16(4*i+2,!0),o=Math.floor((r+l)/2);a.push(o)}return a}},{key:"getDoubleFromArray",value:function(t){for(var e=new DataView(t),a=[],n=Math.floor(t.byteLength/4),i=0;i<n;i++){var r=(e.getInt16(4*i,!0)+e.getInt16(4*i+2,!0))/2/32768;a.push(r)}return a}},{key:"getSingleLeftFromArray",value:function(t){for(var e=new DataView(t),a=[],n=Math.floor(t.byteLength/4),i=0;i<n;i++){var r=e.getInt16(4*i,!0)/32768;a.push(r)}return a}},{key:"getSingleFromArray",value:function(t){for(var e=new DataView(t),a=[],n=Math.floor(t.byteLength/2),i=0;i<n;i++){var r=e.getInt16(2*i,!0)/32768;a.push(r)}return a}},{key:"getvTemp",value:function(t,e){var a=[];return a.push.apply(a,u(t.slice(n.SIGNAL_LENGTH/2,n.SIGNAL_LENGTH))),a.push.apply(a,u(e.slice(0,n.SIGNAL_LENGTH/2))),a}},{key:"fillDataWithZero",value:function(t){if(t.length>=4096)return t;for(var e=t.slice(0),a=4096-e.length,n=0;n<a;n++)e.push(0);return e}},{key:"calculateConvolve",value:function(t,e){var a;a=e==this.signalRef?this.singalRefFFt:m.fft(this.fillDataWithZero(e));var n=m.fft(this.fillDataWithZero(t)),i={real:[],imag:[]};return n.real.map((function(t,e){var r=-a.imag[e];i.real.push(t*a.real[e]-n.imag[e]*r),i.imag.push(t*r+a.real[e]*n.imag[e])})),m.ifft(i).real.map((function(t){return Math.abs(t)}))}},{key:"abs",value:function(t,e){if(Math.abs(t)<Math.abs(e)){if(e<1e-7)return Math.abs(t);var a=t/e;return Math.abs(e)*Math.sqrt(1+a*a)}if(t<1e-6)return Math.abs(e);var n=e/t;return Math.abs(t)*Math.sqrt(1+n*n)}},{key:"getMaxAndIndex",value:function(t){if(!t||0==t.length)return{index:-1,max:-1};for(var e=0,a=t[0],n=0;n<t.length;n++)t[n]>a&&(a=t[n],e=n);return{index:e,max:a}}},{key:"handleInputBean",value:function(t){var e;return e=this.getTDOA(this.preSoundInputBean,t),this.preSoundInputBean=t,e}},{key:"getTDOA",value:function(t,e){if(null==t)return this.signalMax=Math.max(this.signalMax,e.signalMax),-1;this.signalMax=Math.max(t.signalMax,e.signalMax);var a=e.corrHalfArray,i=e.prevCorrHalfArray,r=t.corrHalfArray,l=t.prevCorrHalfArray,o=[],s=[],u=[];o.push(l),o.push(r),o.push(i),o.push(a),s.push(t.prevCorrHalfArrayMax),s.push(t.corrHalfArrayMax),s.push(e.prevCorrHalfArrayMax),s.push(e.corrHalfArrayMax),u.push(t.prevCorrHalfArrayMaxIndex),u.push(t.corrHalfArrayMaxIndex),u.push(e.prevCorrHalfArrayMaxIndex),u.push(e.corrHalfArrayMaxIndex);for(var h=2;h>0;h--){var f=o[h],c=o[h-1];if(null==c||0==c.length||-1==u[h-1])return-1;var m=s[h],g=u[h];if(m>this.vMaxTh&&m/this.signalMax>this.maxRatioTh&&m>s[h+1]&&m>s[h-1])for(var v=this.pMaxTh;v>=0;v--){var p=g-v<0?c[n.SIGNAL_LENGTH/2+g-v]:f[g-v],d=g-v-1<0?c[n.SIGNAL_LENGTH/2+g-v-1]:f[g-v-1],y=g-v+1<0?c[n.SIGNAL_LENGTH/2+g-v+1]:f[g-v+1];if(p>m*this.vRatioTh&&p>d&&p>y){var b=g-v-n.SIGNAL_LENGTH/2*(2-h);try{return(b+e.sequenceId*n.SIGNAL_LENGTH)/this.SAMPLE_RATE_INHZ}catch(t){return console.log(t),-1}}}}return 0}},{key:"getTDOAInfoWithList",value:function(t){t&&0!=t.length||console.log("inputList为空");var e=[];v||(v=(new Date).getTime()-200),Array.prototype.push.apply(this.dataQueue,t);var a=Math.floor(this.dataQueue.length/n.SIGNAL_LENGTH),i=this.dataQueue.slice(0,a*n.SIGNAL_LENGTH);this.dataQueue=this.dataQueue.slice(a*n.SIGNAL_LENGTH);var r=this.lastFrame;if(null==this.signalRef&&(this.signalRef=this.generateSignalRef(this.frequencyStart,this.frequencyEnd,this.durationTime,this.SAMPLE_RATE_INHZ),this.singalRefFFt=m.fft(this.fillDataWithZero(this.signalRef)),console.log("no signalref, generate",this.frequencyStart,this.frequencyEnd,this.durationTime,this.SAMPLE_RATE_INHZ)),0==a)return[];for(var l=0;l<a;l++){var o,s=i.slice(n.SIGNAL_LENGTH*l,n.SIGNAL_LENGTH*(l+1)),u=[],h=[];if(null!=r&&r.length>0){var f=this.getvTemp(r,s);u=(h=this.calculateConvolve(f,this.signalRef)).slice(0,h.length/2)}var c=this.calculateConvolve(s,this.signalRef);o=c.slice(0,c.length/2);var g=this.getMaxAndIndex(u),p=this.getMaxAndIndex(o),d=this.getMaxAndIndex(s),y=this.handleInputBean({version:"1",sequenceId:this.frameSequence,timeStamp:""+(new Date).getTime(),signalFrameArray:s,prevCorrHalfArray:u,corrHalfArray:o,signalMax:null==d?null:d.max,prevCorrHalfArrayMax:null==g?null:g.max,prevCorrHalfArrayMaxIndex:null==g?null:g.index,corrHalfArrayMax:null==p?null:p.max,corrHalfArrayMaxIndex:null==p?null:p.index});e.push({sequenceId:this.frameSequence,timeStamp:""+(new Date).getTime(),beaconId:"",scenceId:"",tdoa:y}),this.frameSequence++,r=s}return this.lastFrame=r,e}},{key:"getTimeDelta",value:function(t){var e=this;if(null!=t){var a=[];if(t.filter((function(t){return t.tdoa>0})).forEach((function(t){e.allTdoaInfos.push(t)})),!(this.allTdoaInfos.length<2)){for(var n=1;n<this.allTdoaInfos.length;n++)this.allTdoaInfos[n].tdoa-this.allTdoaInfos[n-1].tdoa<=this.timeInterval+.1&&this.allTdoaInfos[n].tdoa-this.allTdoaInfos[n-1].tdoa>=.05&&(a.push(this.allTdoaInfos[n].tdoa-this.allTdoaInfos[n-1].tdoa),this.allTdoaInfos.splice(n-1,2),n-=1);return a}console.log("this.allTdoaInfos 长度小于2， 直接返回")}else console.log("getTimeDelta tdoaInfos为空,  直接返回")}},{key:"getDistance",value:function(t){var e=this,a=[];return t?(t.forEach((function(t){console.log("timeDelta",t),a.push((e.totalLength+e.soundSpeed*(e.timeInterval-t))/2)})),a):(console.log("没有timeDelta"),a)}},{key:"clearTimeQueue",value:function(){d=[[],[],[],[],[],[],[]]}},{key:"detectSingleFrequencyWithList",value:function(t){return i.default.detectSingleFrequence(t)}},{key:"updateSettings",value:function(t){this.clear(),t?(console.log(this.clusterId+"使用的配置",JSON.stringify(t)),this.SAMPLE_RATE_INHZ=t.SAMPLE_RATE_INHZ?t.SAMPLE_RATE_INHZ:this.SAMPLE_RATE_INHZ,this.vMaxTh=t.vMaxTh?t.vMaxTh:this.vMaxTh,this.vRatioTh=t.vRatioTh?t.vRatioTh:this.vRatioTh,this.pMaxTh=t.pMaxTh?t.pMaxTh:this.pMaxTh,this.maxRatioTh=t.maxRatioTh?t.maxRatioTh:this.maxRatioTh,this.frequencyStart=t.frequencyStart?t.frequencyStart:this.frequencyStart,this.frequencyEnd=t.frequencyEnd?t.frequencyEnd:this.frequencyEnd,this.durationTime=t.durationTime?t.durationTime:this.durationTime,this.totalLength=t.totalLength?t.totalLength:this.totalLength,this.timeIntervals=t.timeIntervals?t.timeIntervals:this.timeIntervals,this.soundSpeed=t.soundSpeed?t.soundSpeed:this.soundSpeed,this.lngStart=null!=t.lngStart?t.lngStart:this.lngStart,this.lngEnd=null!=t.lngEnd?t.lngEnd:this.lngEnd,this.latStart=null!=t.latStart?t.latStart:this.latStart,this.latEnd=null!=t.latEnd?t.latEnd:this.latEnd,this.timeInterval=t.timeInterval?t.timeInterval:this.timeInterval,this.height=t.height?t.height:this.height):console.log("FFTUtilsSettings updateSettings settings 为空")}}])&&f(e.prototype,a),s&&f(e,s),t}();e.default=b,t.exports=e.default},351:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=l(a(726)),i=l(a(544)),r=l(a(166));function l(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var u=function(){function t(e,a,n,i){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"wc2",0),s(this,"wc",0),s(this,"a",0),s(this,"b",0),s(this,"a2",0),s(this,"b2",0),s(this,"ab",0),s(this,"ab_2",0),n.reset(),e<0)throw new Error("Cutoff frequency cannot be negative.");if(!(e<.5))throw new Error("Cutoff frequency must be less than the Nyquist frequency.");var r=6.283185307179586*a;this.wc2=6.283185307179586*e-r/2,this.wc=this.wc2+r,this.wc2<1e-8&&(this.wc2=1e-8),this.wc>3.141592643589793&&(this.wc=3.141592643589793),this.a=Math.cos(.5*(this.wc+this.wc2))/Math.cos(.5*(this.wc-this.wc2)),this.b=1/Math.tan(.5*(this.wc-this.wc2)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.ab=this.a*this.b,this.ab_2=2*this.ab;for(var l=i.getNumPoles(),o=l/2,u=0;u<o;++u){var h=i.getPair(u),f=this.transform(h.poles.first),c=this.transform(h.zeros.first);n.addPoleZeroConjugatePairs(f.first,c.first),n.addPoleZeroConjugatePairs(f.second,c.second)}if(1==(1&l)){var m=this.transform(i.getPair(o).poles.first),g=this.transform(i.getPair(o).zeros.first);n.add(m,g)}var v=i.getNormalW();n.setNormal(2*Math.atan(Math.sqrt(Math.tan(.5*(this.wc+v))*Math.tan(.5*(this.wc2+v)))),i.getNormalGain())}var e,a;return e=t,(a=[{key:"transform",value:function(t){if(t.isInfinite())return new r.default(new n.default(-1),new n.default(1));t=new n.default(1).add(t).divide(new n.default(1).subtract(t));var e=new n.default(0),a=(e=(e=(e=(e=(e=i.default.addmul(e,4*(this.b2*(this.a2-1)+1),t)).add(8*(this.b2*(this.a2-1)-1))).multiply(t)).add(4*(this.b2*(this.a2-1)+1))).sqrt()).multiply(-1);a=(a=i.default.addmul(a,this.ab_2,t)).add(this.ab_2),e=(e=i.default.addmul(e,this.ab_2,t)).add(this.ab_2);var l=new n.default(0);return l=i.default.addmul(l,2*(this.b-1),t).add(2*(1+this.b)),new r.default(a.divide(l),e.divide(l))}}])&&o(e.prototype,a),t}();e.default=u,t.exports=e.default},528:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(a(726)),i=r(a(582));function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"m_a0",void 0),o(this,"m_a1",void 0),o(this,"m_a2",void 0),o(this,"m_b1",void 0),o(this,"m_b2",void 0),o(this,"m_b0",void 0)}var e,a;return e=t,(a=[{key:"getA0",value:function(){return this.m_a0}},{key:"getA1",value:function(){return this.m_a1*this.m_a0}},{key:"getA2",value:function(){return this.m_a2*this.m_a0}},{key:"getB0",value:function(){return this.m_b0*this.m_a0}},{key:"getB1",value:function(){return this.m_b1*this.m_a0}},{key:"getB2",value:function(){return this.m_b2*this.m_a0}},{key:"response",value:function(t){var e=this.getA0(),a=this.getA1(),r=this.getA2(),l=this.getB0(),o=this.getB1(),s=this.getB2(),u=6.283185307179586*t,h=i.default.polar2Complex(1,-u),f=i.default.polar2Complex(1,-2*u),c=new n.default(1),m=new n.default(1),g=new n.default(l/e),v=new n.default(1);return g=MathSupplement.addmul(g,o/e,h),g=MathSupplement.addmul(g,s/e,f),v=MathSupplement.addmul(v,a/e,h),v=MathSupplement.addmul(v,r/e,f),c=c.multiply(g),m=m.multiply(v),c.divide(m)}},{key:"setCoefficients",value:function(t,e,a,n,i,r){this.m_a0=t,this.m_a1=e/t,this.m_a2=a/t,this.m_b0=n/t,this.m_b1=i/t,this.m_b2=r/t}},{key:"setOnePole",value:function(t,e){var a=-t.getReal(),n=-e.getReal();this.setCoefficients(1,a,0,n,1,0)}},{key:"setTwoPole",value:function(t,e,a,n){var i,r,l,o;Math.abs(t.getImaginary())>1e-9?(i=-2*t.getReal(),r=t.abs()*t.abs()):(i=-(t.getReal()+a.getReal()),r=t.getReal()*a.getReal()),Math.abs(e.getImaginary())>1e-9?(l=-2*e.getReal(),o=e.abs()*e.abs()):(l=-(e.getReal()+n.getReal()),o=e.getReal()*n.getReal()),this.setCoefficients(1,i,r,1,l,o)}},{key:"setPoleZeroForm",value:function(t){this.setPoleZeroPair(t),this.applyScale(t.gain)}},{key:"setIdentity",value:function(){this.setCoefficients(1,0,0,1,0,0)}},{key:"applyScale",value:function(t){this.m_b0*=t,this.m_b1*=t,this.m_b2*=t}},{key:"setPoleZeroPair",value:function(t){t.isSinglePole()?this.setOnePole(t.poles.first,t.zeros.first):this.setTwoPole(t.poles.first,t.zeros.first,t.poles.second,t.zeros.second)}}])&&l(e.prototype,a),t}();e.default=s,t.exports=e.default},818:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a(726)),i=s(a(544)),r=s(a(582)),l=s(a(528)),o=s(a(284));function s(t){return t&&t.__esModule?t:{default:t}}function u(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,"m_biquads",null),h(this,"m_states",null),h(this,"m_numBiquads",0),h(this,"numPoles",0)}var e,a;return e=t,(a=[{key:"getNumBiquads",value:function(){return this.m_numBiquads}},{key:"getBiquad",value:function(t){return this.m_biquads[t]}},{key:"reset",value:function(){for(var t=0;t<this.m_numBiquads;++t)this.m_states[t].reset()}},{key:"filter",value:function(t){for(var e=t,a=0;a<this.m_numBiquads;a++)null!=this.m_states[a]&&(e=this.m_states[a].process1(e,this.m_biquads[a]));return e}},{key:"response",value:function(t){for(var e=6.283185307179586*t,a=r.default.polar2Complex(1,-e),l=r.default.polar2Complex(1,-2*e),o=new n.default(1),s=new n.default(1),u=0;u<this.m_numBiquads;++u){var h=this.m_biquads[u],f=new n.default(1),c=new n.default(h.getB0()/h.getA0());c=i.default.addmul(c,h.getB1()/h.getA0(),a),c=i.default.addmul(c,h.getB2()/h.getA0(),l),f=i.default.addmul(f,h.getA1()/h.getA0(),a),f=i.default.addmul(f,h.getA2()/h.getA0(),l),o=o.multiply(c),s=s.multiply(f)}return o.divide(s)}},{key:"applyScale",value:function(t){this.m_biquads.length>0&&this.m_biquads[0].applyScale(t)}},{key:"setLayout",value:function(t,e){var a;switch(this.numPoles=t.getNumPoles(),this.m_numBiquads=Math.floor((this.numPoles+1)/2),this.m_biquads=new Array(this.m_numBiquads),e){case 0:for(this.m_states=new Array(this.m_numBiquads),a=0;!(a>=this.m_numBiquads);)this.m_states[a]=new DirectFormI,++a;break;case 1:default:for(this.m_states=new Array(this.m_numBiquads),a=0;a<this.m_numBiquads;++a)this.m_states[a]=new o.default}for(a=0;a<this.m_numBiquads;++a){var n=t.getPair(a);this.m_biquads[a]=new l.default,this.m_biquads[a].setPoleZeroPair(n)}this.applyScale(t.getNormalGain()/this.response(t.getNormalW()/6.283185307179586).abs())}}])&&u(e.prototype,a),t}();e.default=f,t.exports=e.default},339:function(t,e,a){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=u(a(992)),r=u(a(818)),l=u(a(544)),o=u(a(726)),s=u(a(351));function u(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,a){return e&&f(t.prototype,e),a&&f(t,a),t}function m(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=y(t);if(e){var i=y(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return p(this,a)}}function p(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?d(t):e}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){m(a,t);var e=v(a);function a(){return h(this,a),e.apply(this,arguments)}return c(a,[{key:"setupBandPass",value:function(t,e,a,n,r,l){var o=new _(t);o.design(r);var u=new i.default(2*t);new s.default(a/e,n/e,u,o),this.setLayout(u,l)}},{key:"bandPass",value:function(t,e,a,n,i){this.setupBandPass(t,e,a,n,i,1)}}]),a}(r.default),_=function(t){m(a,t);var e=v(a);function a(t){var n,i,r;return h(this,a),0,(r="nPoles")in(i=d(n=e.call(this,t)))?Object.defineProperty(i,r,{value:0,enumerable:!0,configurable:!0,writable:!0}):i[r]=0,n.nPoles=t,n}return c(a,[{key:"design",value:function(t){this.reset();for(var e=Math.sqrt(1/Math.exp(.1*-t*l.default.doubleLn10)-1),a=l.default.asinh(1/e)/this.nPoles,n=-Math.sinh(a),i=Math.cosh(a),r=2*this.nPoles,s=this.nPoles/2,u=0;u<s;++u){var h=2*u+1-this.nPoles,f=n*Math.cos(3.141592653589793*h/r),c=i*Math.sin(3.141592653589793*h/r);this.addPoleZeroConjugatePairs(new o.default(f,c),new o.default(1/0))}1==(1&this.nPoles)?(this.add(new o.default(n,0),new o.default(1/0)),this.setNormal(0,1)):this.setNormal(0,Math.pow(10,-t/20))}}]),a}(i.default),M=b;e.default=M,t.exports=e.default},726:function(t,e){function a(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"imaginary",0),n(this,"real",0),this.real=e||1e-11,this.imaginary=a||1e-11}var e,i;return e=t,(i=[{key:"multiply",value:function(t){if(null==t)throw new Error("Complex multiply factor null");return"number"==typeof t?this.createComplex(this.real*t,this.imaginary*t):this.createComplex(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)}},{key:"createComplex",value:function(e,a){return new t(e,a)}},{key:"getReal",value:function(){return this.real}},{key:"getImaginary",value:function(){return this.imaginary}},{key:"abs",value:function(){if(Math.abs(this.real)<Math.abs(this.imaginary)){if(Math.abs(this.imaginary)<1e-9)return Math.abs(this.real);var t=this.real/this.imaginary;return Math.abs(this.imaginary)*Math.sqrt(1+t*t)}if(Math.abs(this.real)<1e-9)return Math.abs(this.imaginary);var e=this.imaginary/this.real;return Math.abs(this.real)*Math.sqrt(1+e*e)}},{key:"isInfinite",value:function(){return!isFinite(this.real)||!isFinite(this.imaginary)}},{key:"isNan",value:function(){return isNaN(this.real)&&isNaN(this.imaginary)}},{key:"add",value:function(e){if(null==e)throw new Error("complex append null");return"number"==typeof e?this.isNan()||isNaN(e)?new t(NaN,NaN):this.createComplex(this.real+e,this.imaginary):e.isNan()||this.isNan()?new t(NaN,NaN):this.createComplex(this.real+e.getReal(),this.imaginary+e.getImaginary())}},{key:"sqrt",value:function(){if(this.isNan())return new t(NaN,NaN);if(Math.abs(this.real)<1e-9&&Math.abs(this.imaginary)<1e-9)return this.createComplex(0,0);var e,a=Math.sqrt((Math.abs(this.real)+this.abs())/2);return this.real>=1e-16?this.createComplex(a,this.imaginary/(2*a)):this.createComplex(Math.abs(this.imaginary)/(2*a),(1,e=this.imaginary,(Math.sign(1)===Math.sign(e)?1:-1)*a))}},{key:"divide",value:function(e){if(null==e)throw new Error("complex divisor null");if("number"==typeof e)return this.createComplex(this.real/e,this.imaginary/e);if(this.isNan()||e.isNan())return NaN;var a,n,i=e.getReal(),r=e.getImaginary();return 0==i&&0==r?new t(NaN,NaN):e.isInfinite()&&!this.isInfinite()?new t(0,0):Math.abs(i)<Math.abs(r)?(n=i*(a=i/r)+r,this.createComplex((this.real*a+this.imaginary)/n,(this.imaginary*a-this.real)/n)):(n=r*(a=r/i)+i,this.createComplex((this.imaginary*a+this.real)/n,(this.imaginary-this.real*a)/n))}},{key:"subtract",value:function(t){if(null==t)throw new Error("complex subtrahend null");return this.isNan()||t.isNan()?NaN:this.createComplex(this.real-t.getReal(),this.imaginary-t.getImaginary())}},{key:"conjugate",value:function(){return this.isNan()?this.createComplex(NaN,NaN):this.createComplex(this.real,-this.imaginary)}}])&&a(e.prototype,i),t}();e.default=i,t.exports=e.default},166:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,i=(n=a(726))&&n.__esModule?n:{default:n};function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}e.default=function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"first",null),r(this,"second",null),this.first=e,this.second=a||new i.default(0,0)},t.exports=e.default},582:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,i=(n=a(726))&&n.__esModule?n:{default:n};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a;return e=t,a=[{key:"polar2Complex",value:function(t,e){if(t<0)throw new Error("polar2Complex r < 0");return new i.default(t*Math.cos(e),t*Math.sin(e))}}],null&&r(e.prototype,null),a&&r(e,a),t}();e.default=l,t.exports=e.default},284:function(t,e){function a(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"m_v1",void 0),n(this,"m_v2",void 0),this.reset()}var e,i;return e=t,(i=[{key:"reset",value:function(){this.m_v1=0,this.m_v2=0}},{key:"process1",value:function(t,e){if(null!=e){var a=t-e.m_a1*this.m_v1-e.m_a2*this.m_v2,n=e.m_b0*a+e.m_b1*this.m_v1+e.m_b2*this.m_v2;return this.m_v2=this.m_v1,this.m_v1=a,n}return t}}])&&a(e.prototype,i),t}();e.default=i,t.exports=e.default},992:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,i=(n=a(645))&&n.__esModule?n:{default:n};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var o=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"m_numPoles",null),l(this,"m_pair",null),l(this,"m_normalW",0),l(this,"m_normalGain",0),"number"!=typeof e)this.m_numPoles=2*e.length,this.m_pair=e;else{var a=e;this.m_numPoles=0,this.m_pair=new Array(a%2==1?a/2+1:a/2)}}var e,a;return e=t,(a=[{key:"reset",value:function(){this.m_numPoles=0}},{key:"getNumPoles",value:function(){return this.m_numPoles}},{key:"addComplex",value:function(t,e){this.m_pair[this.m_numPoles/2]=new i.default(t,e),this.m_numPoles++}},{key:"addPoleZeroConjugatePairs",value:function(t,e){null==t&&console.log("LayoutBase addConj() pole == null"),null==e&&console.log("LayoutBase addConj() zero == null"),null==this.m_pair&&console.log("LayoutBase addConj() m_pair == null"),this.m_pair[this.m_numPoles/2]=new i.default(t,e,t.conjugate(),e.conjugate()),this.m_numPoles+=2}},{key:"addComplexPair",value:function(t,e){this.m_pair[this.m_numPoles/2]=new i.default(t.first,e.first,t.second,e.second),this.m_numPoles+=2}},{key:"getPair",value:function(t){return this.m_pair[t]}},{key:"getNormalW",value:function(){return this.m_normalW}},{key:"getNormalGain",value:function(){return this.m_normalGain}},{key:"setNormal",value:function(t,e){this.m_normalW=t,this.m_normalGain=e}}])&&r(e.prototype,a),t}();e.default=o,t.exports=e.default},544:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,i=(n=a(726))&&n.__esModule?n:{default:n};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a;return e=t,a=[{key:"asinh",value:function(t){return Math.log(t+Math.sqrt(t*t+1))}},{key:"addmul",value:function(t,e,a){return new i.default(t.getReal()+e*a.getReal(),t.getImaginary()+e*a.getImaginary())}}],null&&r(e.prototype,null),a&&r(e,a),t}();!function(t,e,a){e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a}(l,"doubleLn10",2.302585092994046);var o=l;e.default=o,t.exports=e.default},645:function(t,e,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,i=(n=a(166))&&n.__esModule?n:{default:n};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var o=function(){function t(e,a,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"poles",void 0),l(this,"zeros",void 0),this.poles=new i.default(e,n),this.zeros=new i.default(a,r)}var e,a;return e=t,(a=[{key:"isSinglePole",value:function(){return Math.abs(this.poles.second.getReal())<1e-9&&Math.abs(this.poles.second.getImaginary())<1e-9&&Math.abs(this.zeros.second.getReal())<1e-9&&Math.abs(this.zeros.second.getImaginary())<1e-9}}])&&r(e.prototype,a),t}();e.default=o,t.exports=e.default},639:function(t,e,a){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(924),l=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"freqStart",19e3),i(this,"freqEnd",21500),i(this,"sampleRate",48e3),i(this,"f1",19400),i(this,"f2",19700),i(this,"f3",2e4),i(this,"f4",20300),i(this,"f5",20600),i(this,"fCom",[this.f1,this.f2,this.f3,this.f4,this.f5]),i(this,"frameLength",65536),i(this,"dataQueue",[])}var e,a;return e=t,(a=[{key:"detectSingleFrequence",value:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:19100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20900,i=[];if(null==t||0==t.length)return console.log("信号为空"),[];Array.prototype.push.apply(this.dataQueue,t);var l=Math.floor(this.dataQueue.length/this.frameLength);if(0==l)return console.log("单频检测不够一帧的长度,直接返回"),[];var o=this.dataQueue.slice(0,l*this.frameLength);this.dataQueue=this.dataQueue.slice(l*this.frameLength);for(var s=function(t){var l=o.slice(t*e.frameLength,(t+1)*e.frameLength),s={real:l,imag:new Array(l.length).fill(0)},u=r.fft(s).real.map((function(t){return Math.abs(t)})),h=a*e.frameLength/e.sampleRate,f=n*e.frameLength/e.sampleRate,c=e.getMaxAndIndexWithRange(u,Math.floor(h),Math.floor(f));console.log("maxAndIndex",c);var m=c.index*e.sampleRate/e.frameLength;if(console.log("frenquency",m),m<e.freqStart-2e3||m>e.freqEnd+2e3)i.push(null);else{var g=1e6,v=-1;e.fCom.forEach((function(t,e){Math.abs(m-t)<g&&(v=e,g=Math.abs(m-t))})),i.push({freq:m,index:v})}},u=0;u<l;u++)s(u);return i}},{key:"getMaxAndIndex",value:function(t){if(!t||0==t.length)return{index:-1,max:-1};for(var e=0,a=t[0],n=0;n<t.length;n++)t[n]>a&&(a=t[n],e=n);return{index:e,max:a}}},{key:"getMaxAndIndexWithRange",value:function(t,e,a){if(!t||0==t.length)return{index:-1,max:-1};for(var n=e,i=t[e],r=e;r<a;r++)t[r]>i&&(i=t[r],n=r);return{index:n,max:i}}},{key:"clear",value:function(){this.dataQueue=[]}}])&&n(e.prototype,a),t}());e.default=l,t.exports=e.default},694:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SIGNAL_LENGTH=void 0,e.SIGNAL_LENGTH=4096},924:function(t,e,a){var n=a(648),i=function(t){var e={};void 0===t.real||void 0===t.imag?e=n.constructComplexArray(t):(e.real=t.real.slice(),e.imag=t.imag.slice());var a=e.real.length,i=Math.log2(a);if(Math.round(i)!=i)throw new Error("Input size must be a power of 2.");if(e.real.length!=e.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var r=n.bitReverseArray(a),l={real:[],imag:[]},o=0;o<a;o++)l.real[r[o]]=e.real[o],l.imag[r[o]]=e.imag[o];for(var s=0;s<a;s++)e.real[s]=l.real[s],e.imag[s]=l.imag[s];for(var u=1;u<=i;u++)for(var h=Math.pow(2,u),f=0;f<h/2;f++)for(var c=n.euler(f,h),m=0;m<a/h;m++){var g=h*m+f,v=h*m+f+h/2,p={real:e.real[g],imag:e.imag[g]},d={real:e.real[v],imag:e.imag[v]},y=n.multiply(c,d),b=n.subtract(p,y);e.real[v]=b.real,e.imag[v]=b.imag;var _=n.add(y,p);e.real[g]=_.real,e.imag[g]=_.imag}return e};t.exports={fft:i,ifft:function(t){if(void 0===t.real||void 0===t.imag)throw new Error("IFFT only accepts a complex input.");for(var e=t.real.length,a={real:[],imag:[]},r=0;r<e;r++){var l={real:t.real[r],imag:t.imag[r]},o=n.conj(l);a.real[r]=o.real,a.imag[r]=o.imag}var s=i(a);return a.real=s.real.map((function(t){return t/e})),a.imag=s.imag.map((function(t){return t/e})),a}}},29:function(t,e){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function t(e){a(this,t),this.values=Array(e.length).fill(0).map((function(t){return Array(e[0].length).fill(0)}));for(var n=0;n<e.length;n++)for(var i=0;i<e[0].length;i++)this.values[n][i]=e[n][i]}return i(t,[{key:"getValue",value:function(t,e){return this.values[t][e]}},{key:"get_value",value:function(t,e){return this.values[t][e]}},{key:"getString",value:function(){var t=0,e=0,a="[";for(t=0;t<this.values.length;t++){for(a+="[",e=0;e<this.values[t].length;e++)a+=this.values[t][e],e<this.values[t].length-1&&(a+=",");a+="]",t<this.values.length-1&&(a+=",")}return a+"]"}},{key:"getColumnNum",value:function(){return this.values[0].length}},{key:"getRowNum",value:function(){return this.values.length}},{key:"plus",value:function(e){for(var a=this,n=Array(this.values.length).fill(0).map((function(t){return Array(a.values[0].length).fill(0)})),i=0;i<this.values.length;i++)for(var r=0;r<this.values[0].length;r++)n[i][r]=this.values[i][r]+e.getValue(i,r);return new t(n)}},{key:"subtract",value:function(e){for(var a=this,n=Array(this.values.length).fill(0).map((function(t){return Array(a.values[0].length).fill(0)})),i=0;i<this.values.length;i++)for(var r=0;r<this.values[0].length;r++)n[i][r]=this.values[i][r]-e.getValue(i,r);return new t(n)}},{key:"multiply",value:function(e){for(var a=Array(this.getRowNum()).fill(0).map((function(t){return Array(e.getColumnNum()).fill(0)})),n=0;n<a.length;n++)for(var i=0;i<a[0].length;i++){a[n][i]=0;for(var r=0;r<this.getColumnNum();r++)a[n][i]+=this.getValue(n,r)*e.getValue(r,i)}return new t(a)}},{key:"multiply_scalar",value:function(e){for(var a=this,n=Array(this.getRowNum()).fill(0).map((function(t){return Array(a.getColumnNum()).fill(0)})),i=0;i<this.getRowNum();i++)for(var r=0;r<this.getColumnNum();r++)n[i][r]=this.getValue(i,r)*e;return new t(n)}},{key:"divide",value:function(e){for(var a=this,n=Array(this.getRowNum()).fill(0).map((function(t){return Array(a.getColumnNum()).fill(0)})),i=0;i<this.getRowNum();i++)for(var r=0;r<this.getColumnNum();r++)n[i][r]=this.getValue(i,r)/e;return new t(n)}},{key:"getDeterminant",value:function(){var t=0;if(1===this.getRowNum())return this.getValue(0,0);var e=0;for(t=0;t<this.getRowNum();t++)e+=this.getValue(t,0)*this.getCofactor(t,0);return e}},{key:"getMinor",value:function(e,a){for(var n=this,i=Array(this.getRowNum()-1).fill(0).map((function(t){return Array(n.getColumnNum()-1).fill(0)})),r=0,l=0;l<this.getRowNum();l++){var o=0;if(l!==e){for(var s=0;s<this.getColumnNum();s++)s!==a&&(i[r][o]=this.getValue(l,s),o++);r++}}return new t(i)}},{key:"getCofactor",value:function(t,e){var a=this.getMinor(t,e);return Math.pow(-1,t+e)*a.getDeterminant()}},{key:"getAdjugate",value:function(){for(var e=this,a=Array(this.getRowNum()).fill(0).map((function(t){return Array(e.getColumnNum()).fill(0)})),n=0;n<this.getRowNum();n++)for(var i=0;i<this.getColumnNum();i++)a[n][i]=this.getCofactor(i,n);return new t(a)}},{key:"get_inverse",value:function(){var t=this.getAdjugate(),e=this.getDeterminant();return t.divide(e)}},{key:"get_transpose",value:function(){for(var e=this,a=Array(this.getRowNum()).fill(0).map((function(t){return Array(e.getColumnNum()).fill(0)})),n=0;n<this.getColumnNum();n++)for(var i=0;i<this.getRowNum();i++)a[n][i]=this.getValue(i,n);return new t(a)}}]),t}(),l=function(){function t(e){a(this,t),this.pdr_result=[],this.acloc_result=[]}return i(t,[{key:"exkalmandme",value:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{timestamp:0,x:0,y:0},l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3,o=[],s=0,u=0,h={timestamp:i.timestamp,x:i.x,y:i.y},f=[[Math.cos(-a*Math.PI/180),-Math.sin(-a*Math.PI/180)],[Math.sin(-a*Math.PI/180),Math.cos(-a*Math.PI/180)]];if(s>=e.length&&u>=t.length)return o;for(;u<t.length&&(s>=e.length||t[u].timestamp<e[s].timestamp-1e3);)h={timestamp:t[u].timestamp,x:t[u].x,y:t[u].y},o.push({timestamp:h.timestamp,x:h.x,y:h.y}),u+=1;for(;s<e.length&&(u>=t.length||e[s].timestamp<t[u].timestamp-1e3);){var c=e[s].step_length*Math.cos(e[s].angle_cos*Math.PI/180),m=e[s].step_length*Math.sin(e[s].angle_sin*Math.PI/180),g=m*f[0][0]+c*f[1][0],v=m*f[0][1]+c*f[1][1];h.timestamp=e[s].timestamp,h.x+=g,h.y+=v,o.push({timestamp:h.timestamp,x:h.x,y:h.y}),s+=1}for(var p=u;p<t.length;p++)t[p].conf=Math.min(t[p].conf/n,1);var d=new r([[0,0],[0,0]]),y=new r([[0,0],[0,0]]),b=new r([[0,0],[0,0]]),_=new r([[.001,.001],[.001,.001]]),M=new r([[.5,0],[0,1]]),w=new r([[h.x],[h.y]]);for(f=new r(f),console.log(w);s<e.length&&!(u>=t.length);s++){var x=new r([[Math.sin(e[s].angle_sin*Math.PI/180)],[Math.cos(e[s].angle_cos*Math.PI/180)]]),k=x.multiply(f).multiply_scalar(e[s].step_length);if(w=w.plus(k),d=d.plus(_),s+1<e.length&&e[s].timestamp<t[u].timestamp+500&&e[s+1].timestamp>t[u].timestamp)if(e[s+1].timestamp-e[s].timestamp<=900){if(Math.sqrt(Math.pow(w.get_value(0,0)-t[u].x)+Math.pow(w.get_value(1,0)-t[u].x))>=l){h={timestamp:e[s].timestamp,x:w.get_value(0,0),y:w.get_value(1,0)},console.log("position:"+JSON.stringify(h)),o.push({timestamp:h.timestamp,x:h.x,y:h.y}),u+=1;continue}var P=w.multiply_scalar(t[u].conf),A=new r([[t[u].x],[t[u].y]]).multiply_scalar(1-t[u].conf),I=P.plus(A);b=new r([[t[u].conf,0],[0,t[u].conf]]),y=d.multiply(b.get_transpose()).multiply(b.multiply(d).multiply(b.get_transpose()).plus(M).get_inverse()),w=P.plus(A).plus(y.multiply(I.subtract(w)));var N=new r([[1,0],[0,1]]);d=N.subtract(y.multiply(b)).multiply(d).multiply(N.subtract(y.multiply(b)).get_transpose()).plus(y.multiply(M).multiply(y.get_transpose())),h={timestamp:t[u].timestamp,x:w.get_value(0,0),y:w.get_value(1,0)},o.push({timestamp:h.timestamp,x:h.x,y:h.y}),u+=1}else e[s+1].timestamp-e[s].timestamp>900?(w=new r([[t[u].x],[t[u].y]]),h={timestamp:t[u].timestamp,x:w.get_value(0,0),y:w.get_value(1,0)},o.push({timestamp:h.timestamp,x:h.x,y:h.y}),u+=1):(h={timestamp:e[s].timestamp,x:w.get_value(0,0),y:w.get_value(1,0)},o.push({timestamp:h.timestamp,x:h.x,y:h.y}));else h={timestamp:e[s].timestamp,x:w.get_value(0,0),y:w.get_value(1,0)},o.push({timestamp:h.timestamp,x:h.x,y:h.y})}return o}},{key:"weightedMean",value:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{timestamp:0,x:0,y:0},l=.8,o=.2,s=[],u=0,h=0,f={timestamp:i.timestamp,x:i.x,y:i.y},c=[[Math.cos(-a*Math.PI/180),-Math.sin(-a*Math.PI/180)],[Math.sin(-a*Math.PI/180),Math.cos(-a*Math.PI/180)]];if(u>=e.length&&h>=t.length)return s;for(;h<t.length&&(u>=e.length||t[h].timestamp<e[u].timestamp-1e3);)f={timestamp:t[h].timestamp,x:t[h].x,y:t[h].y},s.push({timestamp:f.timestamp,x:f.x,y:f.y}),h+=1;for(;u<e.length&&(h>=t.length||e[u].timestamp<t[h].timestamp-1e3);){var m=e[u].step_length*Math.cos(e[u].angle_cos*Math.PI/180),g=e[u].step_length*Math.sin(e[u].angle_sin*Math.PI/180),v=g*c[0][0]+m*c[1][0],p=g*c[0][1]+m*c[1][1];f.timestamp=e[u].timestamp,f.x+=v,f.y+=p,s.push({timestamp:f.timestamp,x:f.x,y:f.y}),u+=1}for(var d=h;d<t.length;d++)t[d].conf=Math.min(t[d].conf/n,1);var y=new r([[f.x],[f.y]]);for(c=new r(c);u<e.length&&!(h>=t.length);u++){var b=new r([[Math.sin(e[u].angle_sin*Math.PI/180)],[Math.cos(e[u].angle_cos*Math.PI/180)]]),_=b.multiply(c).multiply_scalar(e[u].step_length);if(y=y.plus(_),u+1<e.length&&e[u].timestamp<t[h].timestamp+500&&e[u+1].timestamp>t[h].timestamp)if(e[u+1].timestamp-e[u].timestamp<=900){var M=y.multiply_scalar(o),w=new r([[t[h].x],[t[h].y]]).multiply_scalar(l);M.plus(w),H=new r([[t[h].conf,0],[0,t[h].conf]]),y=M.plus(w),f={timestamp:t[h].timestamp,x:y.get_value(0,0),y:y.get_value(1,0)},s.push({timestamp:f.timestamp,x:f.x,y:f.y}),h+=1}else e[u+1].timestamp-e[u].timestamp>900?(y=new r([[t[h].x],[t[h].y]]),f={timestamp:t[h].timestamp,x:y.get_value(0,0),y:y.get_value(1,0)},s.push({timestamp:f.timestamp,x:f.x,y:f.y}),h+=1):(f={timestamp:e[u].timestamp,x:y.get_value(0,0),y:y.get_value(1,0)},s.push({timestamp:f.timestamp,x:f.x,y:f.y}));else f={timestamp:e[u].timestamp,x:y.get_value(0,0),y:y.get_value(1,0)},s.push({timestamp:f.timestamp,x:f.x,y:f.y})}return s}},{key:"makeKalmanFilter",value:function(){return new o}}]),t}(),o=function(){function t(e){a(this,t),this.latest_point=null,this.A=new r([[1,0],[0,1]]),this.H=new r([[1,0],[0,1]]),this.Q=new r([[.1,0],[0,.1]]),this.R=new r([[1,0],[0,1]]),this.P=new r([[1,0],[0,1]])}return i(t,[{key:"next",value:function(t,e){null==this.latest_point&&(this.latest_point=new r([[t],[e]])),console.log(this.latest_point);var a=new r([[t],[e]]);console.log(a);var n=this.A.multiply(this.latest_point),i=this.A.multiply(this.P).multiply(this.A.get_transpose()).plus(this.Q),l=i.multiply(this.H.get_transpose()).multiply(this.H.multiply(i).multiply(this.H.get_transpose()).plus(this.R).get_inverse());this.latest_point=n.plus(l.multiply(a.subtract(this.H.multiply(n))));var o=new r([[1,0],[0,1]]);return this.P=o.subtract(l.multiply(this.H)).multiply(i),{x:this.latest_point.get_value(0,0),y:this.latest_point.get_value(1,0)}}}]),t}(),s=new l;e.default=s,t.exports=e.default},352:function(t,e,a){var n;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=((n=a(899))&&n.__esModule?n:{default:n}).default;e.default=i,t.exports=e.default},302:function(t,e){function a(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function i(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=[],n=1;n<t.length-1;n++)t[n]>t[n-1]&&t[n]>t[n+1]&&t[n]>=e&&a.push({index:n,value:t[n]});return a}function l(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=0,n=0,i=[],r=0;r<t.length;r++){var l=t[r];a+=l,(n+=1)>e&&(a-=t[r-e],n-=1),i.push(a/n)}return i}function o(t){if(0===t.length)return 0;for(var e=0,a=0;a<t.length;a++)e+=t[a];return e/t.length}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position={},this.position.x=0,this.position.y=0,this.orientation_list=[],this.acceleration_list=[]}var e,n;return e=t,(n=[{key:"debugLog",value:function(t){}},{key:"move",value:function(t,e){this.position.x+=t,this.position.y+=e}},{key:"next",value:function(t,e){return(0==this.orientation_list.length||t.t>this.orientation_list[this.orientation_list.length-1].t)&&this.orientation_list.push({x:t.alpha,y:t.beta,z:t.gamma,t:t.t}),(0==this.acceleration_list.length||e.t>this.acceleration_list[this.acceleration_list.length-1].t)&&this.acceleration_list.push({x:9.8*e.x,y:9.8*e.y,z:9.8*e.z,t:e.t}),get_position(this.orientation_list,this.acceleration_list,.5,this.orientation_list[0].x)}},{key:"getSteps",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:9.8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.7;this.debugLog("start getSteps with imuData-length="+t.length);for(var s=[],u=[],h=0;h<t.length;h++){for(var f=t[h].alpha;f>=180;)f-=360;for(;f<-180;)f+=360;0<=f&&f<90?(s.push(f),u.push(f)):90<=f&&f<180?(s.push(180-f),u.push(f)):-180<=f&&f<-90?(s.push(-180-f),u.push(-f)):-90<=f&&f<0?(s.push(f),u.push(-f)):console.log("-180<=yaw<180 is required, got "+f)}for(var c=[],m=0;m<t.length;m++){var g=t[m];c.push(Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z)*n-n)}for(var v=l(c),p=r(v,0,i),d=[],y=0;y<p.length-1;y++){var b=p[y].index,_=p[y+1].index,M=Math.max.apply(Math,a(v.slice(b,_)))-Math.min.apply(Math,a(v.slice(b,_)));d.push({timestamp:t[b].timestamp,angle_sin:o(s.slice(b,_)),angle_cos:o(u.slice(b,_)),step_length:e*Math.pow(M,.25)})}return d}},{key:"getTrack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timestamp:0,x:0,y:0},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.debugLog("start getTrack with stepsList-length="+t.length+", alpha="+a);for(var n=[[Math.cos(-a*Math.PI/180),-Math.sin(-a*Math.PI/180)],[Math.sin(-a*Math.PI/180),Math.cos(-a*Math.PI/180)]],i=e.x,r=e.y,l=[e],o=0;o<t.length;o++)if(!(t[o].timestamp<=e.timestamp)){var s=t[o].step_length*Math.cos(t[o].angle_cos*Math.PI/180),u=t[o].step_length*Math.sin(t[o].angle_sin*Math.PI/180),h=u*n[0][0]+s*n[1][0],f=u*n[0][1]+s*n[1][1];i+=h,r+=f,l.push({timestamp:t[o].timestamp,x:i,y:r})}return l}},{key:"getTrack1D",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timestamp:0,x:0,y:0},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.x,i=e.y,r=[e],l=0;l<t.length;l++)if(!(t[l].timestamp<=e.timestamp)){var o=t[l].angle_sin;o=(o=(o-a+720)%360)>0&&o<=180?90:270;var s=t[l].step_length*Math.sin(o*Math.PI/180);n+=s,r.push({timestamp:t[l].timestamp,x:n,y:i})}return r}},{key:"isStatic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;if(0==t.length)return!1;for(var n=[],i=Math.max(0,t.length-e);i<t.length;i++){var r=t[i];n.push(Math.abs(Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z)-1))}return Math.max.apply(Math,n)<a}}])&&i(e.prototype,n),t}());e.default=s,t.exports=e.default},648:function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var a={},n={};t.exports={bitReverseArray:function(t){if(void 0===a[t]){for(var n=(t-1).toString(2).length,i="0".repeat(n),r={},l=0;l<t;l++){var o=l.toString(2);o=(s=o=i.substr(o.length)+o,function(t){if(Array.isArray(t))return e(t)}(s)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(s)||function(t,a){if(t){if("string"==typeof t)return e(t,a);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,a):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).reverse().join(""),r[l]=parseInt(o,2)}a[t]=r}var s;return a[t]},multiply:function(t,e){return{real:t.real*e.real-t.imag*e.imag,imag:t.real*e.imag+t.imag*e.real}},add:function(t,e){return{real:t.real+e.real,imag:t.imag+e.imag}},subtract:function(t,e){return{real:t.real-e.real,imag:t.imag-e.imag}},euler:function(t,e){var a=-2*Math.PI*t/e;return{real:Math.cos(a),imag:Math.sin(a)}},conj:function(t){return t.imag*=-1,t},constructComplexArray:function(t){var e={};e.real=void 0===t.real?t.slice():t.real.slice();var a=e.real.length;return void 0===n[a]&&(n[a]=Array.apply(null,Array(a)).map(Number.prototype.valueOf,0)),e.imag=n[a].slice(),e}}}},e={};return function a(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,a),r.exports}(352)}()}));